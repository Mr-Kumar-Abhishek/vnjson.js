{"version":3,"sources":["webpack:///webpack/bootstrap 533d4285987a31452607","webpack:///./src/vnjson.js","webpack:///./src/parse.js","webpack:///./src/memory-card.js"],"names":["catalog","event","handler","jump","Event","flag","_event","push","autorun","on","userEvent","add","game","init","scenes","ctx","scene","label","arr","obj","num","saveGame","title","data","gameTitle","save","loadGame","load","param","forEach","item","marmottajax","success","body","document","getElementById","innerHTML","entry","emitEvent","screen","addEventListener","pathname","isScene","test","console","info","pathArr","split","getScene","labels","warn","pathToScene","local","url","json","_SCENE","log","assets","characters","concat","parse","tokenize","key","hasOwnProperty","alias","reply","vnjs","localforage","setItem","err","getItem","then","catch","error"],"mappings":"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","file":"demo/js/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 533d4285987a31452607\n **/","\r\nimport parse            from './parse';\r\nimport memoryCard       from './memory-card';\r\n\r\n\r\n/**\r\n * Глобальное хранилище вызываемых методов из\r\n * пользовательского скрипта\r\n * \r\n */\r\nvar catalog = [\r\n      { \r\n        event: 'jump',\r\n        handler: jump\r\n      }\r\n];\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\nclass Event {\r\n  constructor(event, handler, flag){\r\n    this.event = event;\r\n    this.handler = handler;\r\n    this.flag = flag;\r\n  }\r\n  add(){\r\n    const _event = {\r\n      event: this.event,\r\n      handler: this.handler\r\n    };\r\n    catalog.push(_event);\r\n\r\n  }\r\n}; \r\nvar autorun = [];\r\nfunction on(event, handler){\r\n\r\n  if(event&&handler){\r\n     let userEvent = new Event(event, handler);\r\n     userEvent.add();\r\n  }else if(event){\r\n    autorun.push(event);\r\n  }\r\n};\r\n/*\r\n * game\r\n */\r\n\r\nvar game = {\r\n    init: {},\r\n    scenes: {}\r\n};\r\n\r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  scene:'scene',\r\n  label:'label',\r\n  arr: [],\r\n  obj: null,\r\n  num: 0,\r\n};\r\n/*\r\n * memory card\r\n * Набросал грубый вид сохраненок в игре\r\n */\r\nfunction saveGame(title){\r\n  let data = {\r\n    scene: ctx.scene,\r\n    label: ctx.label,\r\n    num: ctx.num,\r\n    title: title,\r\n    gameTitle: 'demo'\r\n  }\r\n  memoryCard.save(data);\r\n};\r\nfunction loadGame(title){\r\n\r\n  memoryCard.load(title);\r\n}\r\n\r\n\r\n\r\n/**\r\n * init\r\n */\r\nfunction init(param){\r\n  game.init = param;\r\n  autorun.forEach(function(item){\r\n    item();\r\n  });\r\nmarmottajax('/game/layers.html').success(function(body) {\r\n     document.getElementById('game').innerHTML = body;\r\n     jump(game.init.entry);\r\n\r\n});\r\n \r\n};\r\n/*\r\n * click handler\r\n */\r\nfunction emitEvent(){\r\n    let screen = document.getElementById(game.init.screen);\r\n        parse(ctx, catalog);\r\n    screen.addEventListener('mousedown',function(){\r\n        parse(ctx, catalog);\r\n    });\r\n};\r\n\r\n\r\n\r\nfunction jump(pathname){\r\n /*\r\n  * Если есть слэш в пути прыжка\r\n  * то это сцена, значит надо подружать\r\n  * ресурсы и т.д.\r\n  */\r\nlet isScene = /\\/\\w+/gi.test(pathname);\r\n\r\nif(isScene){\r\n   console.info(`[ ${pathname} ]`);\r\n  const pathArr = pathname.split('/');\r\n  ctx.num = 0;\r\n  ctx.scene = pathArr[0];\r\n  ctx.label  = pathArr[1];\r\n \r\n  getScene(ctx.scene);\r\n\r\n \r\n}\r\n  /*\r\n   * Если слэша нет, то это значит лабел.\r\n   * поэтому не надо делать лишних телодвижений\r\n   * а просто выполнить уже загруженный массив\r\n   */\r\nelse{\r\n \r\n   ctx.num = 0;\r\n   ctx.label = pathname;\r\n   ctx.arr = game.scenes[ctx.scene].labels[ctx.label];\r\n   console.warn('[ is label ]: '+pathname);\r\n   parse(ctx, catalog);\r\n};\r\n};\r\n\r\n/*\r\n * getScene\r\n */\r\n\r\nfunction getScene(scene){\r\n\r\nconst pathToScene = `game/${game.init.scenes}/${game.init.local}/${scene}.json`;\r\n\r\nmarmottajax({\r\n    url: pathToScene,\r\n    json: true\r\n}).success(function(data) {\r\n    // result\r\n\r\n\r\n   \r\n    game.scenes[ctx.scene] = data;\r\n\r\n    const _SCENE = game.scenes[ctx.scene];\r\n   \r\n    \r\n    ctx.arr = _SCENE.labels[ctx.label];\r\n    /*\r\n     * Логирую для удобства разработки\r\n     *\r\n     */\r\n    console.log('---------assets---------------');\r\n    console.log(_SCENE.assets);\r\n\r\n\r\n    console.log('---------characters-----------');\r\n    console.log(_SCENE.characters);\r\n\r\n\r\n    console.log('---------labels-----------');\r\n    console.log(_SCENE.labels);\r\n    /** \r\n     * Склеиваю персонажей из сцены в каталог\r\n     *\r\n     */\r\n    catalog = catalog.concat(_SCENE.characters);\r\n    /**\r\n      * click\r\n      */\r\n     emitEvent();\r\n });\r\n};\r\n\r\n\r\n/*\r\n * @api\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  init,\r\n  game,\r\n  catalog,\r\n  loadGame,\r\n  saveGame,\r\n  getScene,\r\n  parse,\r\n  autorun\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/","  /*\r\n   * Модуль отвечающий за смену состояния визуальной новеллы\r\n   * Отвечает за проход массива [ label ]  \r\n   * Так же делегирует выполнение параметров текущего объекта\r\n   * обработчикам [ event ]\r\n   *\r\n   */\r\n\r\n/*\r\n * @plugin\r\n * vnjs.alias\r\n */\r\n\r\nfunction tokenize(ctx, catalog){\r\n/*\r\n *  Фильтруем параметры текущего объекта и проверяем наличие их\r\n *  реестре событий [ catalog ], если есть совпадения то выполняем их.\r\n *\r\n */\r\n  for(let key in ctx.obj){\r\n    catalog.forEach((item)=>{\r\n      /*\r\n       * Если ключ объекта совподает с зарегистрированным \r\n       * алиасом персонажа, то выполняем модуль alias\r\n       * Т.е. определяем персонаж ли это.\r\n       */\r\n      if(item.hasOwnProperty('alias')){\r\n          if(item.alias===key){\r\n              let reply = ctx.obj[item.alias]; \r\n              vnjs.alias(item, reply);\r\n          }\r\n      }\r\n      /*\r\n       * Если это функция, то выполняем ее\r\n       */\r\n      else if(item.hasOwnProperty('event')){\r\n       \r\n            if(item.event===key){\r\n              item.handler(ctx.obj[key], key);\r\n            }\r\n\r\n      }\r\n      /*\r\n       * Элемент отсутсвует в реестре событий [catalog]\r\n       */\r\n      else{\r\n         console.log('неизвесный элемент: '+ key);\r\n      }   \r\n    });//catalog.forEach\r\n  }//for\r\n\r\n};\r\n\r\nfunction parse(ctx, catalog){\r\n  console.log(`${ctx.scene}/${ctx.label}/${ctx.num}`);\r\n  /** Текущий объект */\r\n  ctx.obj = ctx.arr[ctx.num];\r\n\r\n  tokenize(ctx, catalog);\r\n  ctx.num+=1;\r\n}\r\n\r\nexport default parse;\n\n\n/** WEBPACK FOOTER **\n ** ./src/parse.js\n **/","/*\r\n * Так же потом сделать удаленные сохраненки на\r\n * vnjson.online\r\n */\r\n\r\nexport function save(data){\r\n  localforage.setItem(data.title, data, (err)=>{\r\n    if(err){\r\n      console.log(err);\r\n    }\r\n    console.log('Игра сохранена');\r\n\r\n  });\r\n};\r\n\r\nexport function load(key){\r\n   localforage.getItem(key).then((data)=>{\r\n      console.log(data);\r\n   }).catch(function (err) {\r\n        console.error(err);\r\n   });\r\n}\r\n\r\nexport default {\r\n  save, load\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/memory-card.js\n **/"],"sourceRoot":""}