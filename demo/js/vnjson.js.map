{"version":3,"sources":["webpack:///webpack/bootstrap 355acac4306151e1d5f8","webpack:///./src/vnjson.js","webpack:///./src/parse.js","webpack:///./src/memory-card.js"],"names":["init","param","game","marmottajax","success","body","document","getElementById","innerHTML","jump","entry","catalog","event","handler","Event","flag","_event","push","autorun","on","userEvent","add","scenes","config","audio","ctx","scene","label","arr","obj","num","saveGame","title","data","gameTitle","save","loadGame","load","pathname","isScene","test","pathArr","split","getScene","labels","pathToScene","local","url","json","_SCENE","assets","concat","characters","forEach","item","call","vnjs","parse","tokenize","key","hasOwnProperty","alias","reply","console","log","localforage","setItem","err","getItem","then","catch","error"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;sjBCtCA;;;;AAIA;;;;AACA;;;;;;;;AAEA;;;AAGA,UAASA,IAAT,CAAcC,KAAd,EAAoB;;AAElBC,QAAKF,IAAL,GAAYC,KAAZ;;AAEFE,eAAY,mBAAZ,EAAiCC,OAAjC,CAAyC,UAASC,IAAT,EAAe;AACpDC,cAASC,cAAT,CAAwB,MAAxB,EAAgCC,SAAhC,GAA4CH,IAA5C;;AAEAI,UAAKP,KAAKF,IAAL,CAAUU,KAAf;AAEH,IALD;AAOC;;AAED;;;;;AAKA,KAAIC,UAAU,CACR;AACEC,UAAO,MADT;AAEEC,YAASJ;AAFX,EADQ,CAAd;AAMA;;;;;KAIMK,K;AACJ,kBAAYF,KAAZ,EAAmBC,OAAnB,EAA4BE,IAA5B,EAAiC;AAAA;;AAC/B,UAAKH,KAAL,GAAaA,KAAb;AACA,UAAKC,OAAL,GAAeA,OAAf;AACA,UAAKE,IAAL,GAAYA,IAAZ;AACD;;;;2BACI;AACH,WAAMC,SAAS;AACbJ,gBAAO,KAAKA,KADC;AAEbC,kBAAS,KAAKA;AAFD,QAAf;AAIAF,eAAQM,IAAR,CAAaD,MAAb;AAED;;;;;;AACF;AACD;;;;AAIA,KAAIE,UAAU,EAAd;;AAEA,UAASC,EAAT,CAAYP,KAAZ,EAAmBC,OAAnB,EAA2B;;AAEzB,OAAGD,SAAOC,OAAV,EAAkB;AACf,SAAIO,YAAY,IAAIN,KAAJ,CAAUF,KAAV,EAAiBC,OAAjB,CAAhB;AACAO,eAAUC,GAAV;AACF,IAHD,MAGM,IAAGT,KAAH,EAAS;AACbM,aAAQD,IAAR,CAAaL,KAAb;AACD;AACF;;AAED;;;;AAIA,KAAIV,OAAO;AACPF,SAAM,EADC;AAEPsB,WAAQ;AAFD,EAAX;AAIA,KAAIC,SAAS;AACPC,UAAO;AADA,EAAb;AAGA;;;;AAIA,KAAIC,MAAM;AACRC,UAAM,OADE;AAERC,UAAM,OAFE;AAGRC,QAAK,EAHG;AAIRC,QAAK,IAJG;AAKRC,QAAK;AALG,EAAV;AAOA;;;;AAIA,UAASC,QAAT,CAAkBC,KAAlB,EAAwB;AACtB,OAAIC,OAAO;AACTP,YAAOD,IAAIC,KADF;AAETC,YAAOF,IAAIE,KAFF;AAGTG,UAAKL,IAAIK,GAHA;AAITE,YAAOA,KAJE;AAKTE,gBAAW;AALF,IAAX;AAOA,wBAAWC,IAAX,CAAgBF,IAAhB;AACD;AACD,UAASG,QAAT,CAAkBJ,KAAlB,EAAwB;;AAEtB,wBAAWK,IAAX,CAAgBL,KAAhB;AACD;;AAOD;;;;;;;;AAQA,UAASvB,IAAT,CAAc6B,QAAd,EAAuB;AACtB;;;;;AAKD,OAAIC,UAAU,UAAUC,IAAV,CAAeF,QAAf,CAAd;;AAEA,OAAGC,OAAH,EAAW;;AAET,SAAME,UAAUH,SAASI,KAAT,CAAe,GAAf,CAAhB;AACAjB,SAAIK,GAAJ,GAAU,CAAV;AACAL,SAAIC,KAAJ,GAAYe,QAAQ,CAAR,CAAZ;AACAhB,SAAIE,KAAJ,GAAac,QAAQ,CAAR,CAAb;;AAEAE,cAASlB,IAAIC,KAAb;AAGD;AACC;;;;;AAXF,QAgBI;;AAEDD,WAAIK,GAAJ,GAAU,CAAV;AACAL,WAAIE,KAAJ,GAAYW,QAAZ;AACAb,WAAIG,GAAJ,GAAU1B,KAAKoB,MAAL,CAAYG,IAAIC,KAAhB,EAAuBkB,MAAvB,CAA8BnB,IAAIE,KAAlC,CAAV;AACA,4BAAMF,GAAN,EAAWd,OAAX;AACF;AACA;;AAED;;;;AAIA,UAASgC,QAAT,CAAkBjB,KAAlB,EAAwB;;AAExB,OAAMmB,wBAAsB3C,KAAKF,IAAL,CAAUsB,MAAhC,SAA0CpB,KAAKF,IAAL,CAAU8C,KAApD,SAA6DpB,KAA7D,UAAN;;AAEAvB,eAAY;AACR4C,UAAKF,WADG;AAERG,WAAM;AAFE,IAAZ,EAGG5C,OAHH,CAGW,UAAS6B,IAAT,EAAe;AACtB;;AAEA/B,UAAKoB,MAAL,CAAYG,IAAIC,KAAhB,IAAyBO,IAAzB;;AAEA,SAAMgB,SAAS/C,KAAKoB,MAAL,CAAYG,IAAIC,KAAhB,CAAf;;AAGAD,SAAIG,GAAJ,GAAUqB,OAAOL,MAAP,CAAcnB,IAAIE,KAAlB,CAAV;AACAF,SAAIyB,MAAJ,GAAahD,KAAKoB,MAAL,CAAYG,IAAIC,KAAhB,EAAuBwB,MAApC;;AAEA;;;;AAIA,aAoBFvC,OApBE,aAAUA,QAAQwC,MAAR,CAAeF,OAAOG,UAAtB,CAAV;AACA;;;AAGAlC,aAAQmC,OAAR,CAAgB,UAASC,IAAT,EAAc;AAC5BA,YAAKC,IAAL,CAAUC,IAAV;AACD,MAFD;AAGF,IAzBF;AA2BC;;AAGD;;;SAIErC,E,GAAAA,E;SACAM,G,GAAAA,G;SACAzB,I,GAAAA,I;SACAE,I,GAAAA,I;SACAS,O,GAAAA,O;SACAyB,Q,GAAAA,Q;SACAL,Q,GAAAA,Q;SACAY,Q,GAAAA,Q;SACAc,K;SACAvC,O,GAAAA,O;SACAK,M,GAAAA,M;SACAd,I,GAAAA,I;;;;;;;;;;;ACjNA;;;;;;;AAOF;;;;;;;;;;;;AAYA;;;;;AAKA,UAASiD,QAAT,CAAkBjC,GAAlB,EAAuBd,OAAvB,EAA+B;AAAA,8BAMrBgD,GANqB;AAO3BhD,aAAQ0C,OAAR,CAAgB,UAACC,IAAD,EAAQ;AACtB;;;;;AAKA,WAAGA,KAAKM,cAAL,CAAoB,OAApB,CAAH,EAAgC;AAC5B,aAAGN,KAAKO,KAAL,KAAaF,GAAhB,EAAoB;AAChB,eAAIG,QAAQrC,IAAII,GAAJ,CAAQyB,KAAKO,KAAb,CAAZ;AACAL,gBAAKK,KAAL,CAAWP,IAAX,EAAiBQ,KAAjB;AACH;AACJ;AACD;;;AANA,YASK,IAAGR,KAAKM,cAAL,CAAoB,OAApB,CAAH,EAAgC;;AAE/B,eAAGN,KAAK1C,KAAL,KAAa+C,GAAhB,EAAoB;AAClBL,kBAAKzC,OAAL,CAAaY,IAAII,GAAJ,CAAQ8B,GAAR,CAAb,EAA2BA,GAA3B;AACD;AAEN;AACD;;;AAPK,cAUD;AACDI,qBAAQC,GAAR,CAAY,yBAAwBL,GAApC;AACF;AACF,MA5BD,EAP2B,CAmCxB;AAnCwB;;AAC/B;;;;;AAKE,QAAI,IAAIA,GAAR,IAAelC,IAAII,GAAnB,EAAuB;AAAA,WAAf8B,GAAe;AA8BtB,IApC4B,CAoC5B;AAEF;;AAED,UAASF,KAAT,CAAehC,GAAf,EAAoBd,OAApB,EAA4B;AAC1BoD,WAAQC,GAAR,CAAevC,IAAIC,KAAnB,SAA4BD,IAAIE,KAAhC,SAAyCF,IAAIK,GAA7C;AACA;AACAL,OAAII,GAAJ,GAAUJ,IAAIG,GAAJ,CAAQH,IAAIK,GAAZ,CAAV;;AAEA4B,YAASjC,GAAT,EAAcd,OAAd;AACAc,OAAIK,GAAJ,IAAS,CAAT;AACD;;mBAEc2B,K;;;;;;;;;;;SCpECtB,I,GAAAA,I;SAUAE,I,GAAAA,I;AAfhB;;;;;AAKO,UAASF,IAAT,CAAcF,IAAd,EAAmB;AACxBgC,eAAYC,OAAZ,CAAoBjC,KAAKD,KAAzB,EAAgCC,IAAhC,EAAsC,UAACkC,GAAD,EAAO;AAC3C,SAAGA,GAAH,EAAO;AACLJ,eAAQC,GAAR,CAAYG,GAAZ;AACD;AACDJ,aAAQC,GAAR,CAAY,gBAAZ;AAED,IAND;AAOD;;AAEM,UAAS3B,IAAT,CAAcsB,GAAd,EAAkB;AACtBM,eAAYG,OAAZ,CAAoBT,GAApB,EAAyBU,IAAzB,CAA8B,UAACpC,IAAD,EAAQ;AACnC8B,aAAQC,GAAR,CAAY/B,IAAZ;AACF,IAFD,EAEGqC,KAFH,CAES,UAAUH,GAAV,EAAe;AACnBJ,aAAQQ,KAAR,CAAcJ,GAAd;AACJ,IAJD;AAKF;;mBAEc;AACbhC,aADa,EACPE;AADO,E","file":"demo/js/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 355acac4306151e1d5f8\n **/","/**\r\n * @deps [ marmottajax, localforge, howler]\r\n */\r\n\r\nimport parse            from './parse';\r\nimport memoryCard       from './memory-card';\r\n\r\n/**\r\n * init\r\n */\r\nfunction init(param){\r\n  \r\n  game.init = param;\r\n\r\nmarmottajax('/game/layers.html').success(function(body) {\r\n    document.getElementById('game').innerHTML = body;\r\n\r\n    jump(game.init.entry);\r\n\r\n});\r\n \r\n};\r\n\r\n/**\r\n * Глобальное хранилище вызываемых методов из\r\n * пользовательского скрипта\r\n * \r\n */\r\nvar catalog = [\r\n      { \r\n        event: 'jump',\r\n        handler: jump\r\n      }\r\n];\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\nclass Event {\r\n  constructor(event, handler, flag){\r\n    this.event = event;\r\n    this.handler = handler;\r\n    this.flag = flag;\r\n  }\r\n  add(){\r\n    const _event = {\r\n      event: this.event,\r\n      handler: this.handler\r\n    };\r\n    catalog.push(_event);\r\n\r\n  }\r\n}; \r\n/*\r\n * @autorun\r\n * vnjs.on(function(){});\r\n */\r\nvar autorun = [];\r\n\r\nfunction on(event, handler){\r\n\r\n  if(event&&handler){\r\n     let userEvent = new Event(event, handler);\r\n     userEvent.add();\r\n  }else if(event){\r\n    autorun.push(event);\r\n  }\r\n};\r\n\r\n/*\r\n * game\r\n */\r\n\r\nvar game = {\r\n    init: {},\r\n    scenes: {}\r\n};\r\nvar config = {\r\n      audio: true\r\n};\r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  scene:'scene',\r\n  label:'label',\r\n  arr: [],\r\n  obj: null,\r\n  num: 0,\r\n};\r\n/*\r\n * memory card\r\n * Набросал грубый вид сохраненок в игре\r\n */\r\nfunction saveGame(title){\r\n  let data = {\r\n    scene: ctx.scene,\r\n    label: ctx.label,\r\n    num: ctx.num,\r\n    title: title,\r\n    gameTitle: 'demo'\r\n  }\r\n  memoryCard.save(data);\r\n};\r\nfunction loadGame(title){\r\n\r\n  memoryCard.load(title);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @TODO Сделать разновидность jump'a\r\n * только что бы можно было переходить\r\n * на конкретную строку. jumpTo(\"start/chapter1/14\")\r\n * А так же разобраться с навигатором. Что б. можно было\r\n * скролить новелу назад и вперед.\r\n */\r\n\r\nfunction jump(pathname){\r\n /*\r\n  * Если есть слэш в пути прыжка\r\n  * то это сцена, значит надо подружать\r\n  * ресурсы и т.д.\r\n  */\r\nlet isScene = /\\/\\w+/gi.test(pathname);\r\n\r\nif(isScene){\r\n\r\n  const pathArr = pathname.split('/');\r\n  ctx.num = 0;\r\n  ctx.scene = pathArr[0];\r\n  ctx.label  = pathArr[1];\r\n \r\n  getScene(ctx.scene);\r\n\r\n \r\n}\r\n  /*\r\n   * Если слэша нет, то это значит лабел.\r\n   * поэтому не надо делать лишних телодвижений\r\n   * а просто выполнить уже загруженный массив\r\n   */\r\nelse{\r\n \r\n   ctx.num = 0;\r\n   ctx.label = pathname;\r\n   ctx.arr = game.scenes[ctx.scene].labels[ctx.label];\r\n   parse(ctx, catalog);\r\n};\r\n};\r\n\r\n/*\r\n * getScene\r\n */\r\n\r\nfunction getScene(scene){\r\n\r\nconst pathToScene = `game/${game.init.scenes}/${game.init.local}/${scene}.json`;\r\n\r\nmarmottajax({\r\n    url: pathToScene,\r\n    json: true\r\n}).success(function(data) {\r\n    // result\r\n\r\n    game.scenes[ctx.scene] = data;\r\n\r\n    const _SCENE = game.scenes[ctx.scene];\r\n   \r\n    \r\n    ctx.arr = _SCENE.labels[ctx.label];\r\n    ctx.assets = game.scenes[ctx.scene].assets;\r\n\r\n    /** \r\n     * Склеиваю персонажей из сцены в каталог\r\n     *\r\n     */\r\n    catalog = catalog.concat(_SCENE.characters);\r\n    /**\r\n      * autorun\r\n      */\r\n    autorun.forEach(function(item){\r\n      item.call(vnjs);\r\n    });\r\n });\r\n\r\n};\r\n\r\n\r\n/*\r\n * @api\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  init,\r\n  game,\r\n  catalog,\r\n  loadGame,\r\n  saveGame,\r\n  getScene,\r\n  parse,\r\n  autorun,\r\n  config,\r\n  jump\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/","  /*\r\n   * Модуль отвечающий за смену состояния визуальной новеллы\r\n   * Отвечает за проход массива [ label ]  \r\n   * Так же делегирует выполнение параметров текущего объекта\r\n   * обработчикам [ event ]\r\n   *\r\n   */\r\n/*\r\nswitch(param){\r\n  case 'prev':\r\n    this.i--;\r\n    break;\r\n  case 'current':\r\n    this.i = this.i;\r\n    break;\r\n  case 'next':\r\n    this.i++;\r\n}\r\n*/\r\n/*\r\n * @plugin\r\n * vnjs.alias\r\n */\r\n\r\nfunction tokenize(ctx, catalog){\r\n/*\r\n *  Фильтруем параметры текущего объекта и проверяем наличие их\r\n *  реестре событий [ catalog ], если есть совпадения то выполняем их.\r\n *\r\n */\r\n  for(let key in ctx.obj){\r\n    catalog.forEach((item)=>{\r\n      /*\r\n       * Если ключ объекта совподает с зарегистрированным \r\n       * алиасом персонажа, то выполняем модуль alias\r\n       * Т.е. определяем персонаж ли это.\r\n       */\r\n      if(item.hasOwnProperty('alias')){\r\n          if(item.alias===key){\r\n              let reply = ctx.obj[item.alias]; \r\n              vnjs.alias(item, reply);\r\n          }\r\n      }\r\n      /*\r\n       * Если это функция, то выполняем ее\r\n       */\r\n      else if(item.hasOwnProperty('event')){\r\n       \r\n            if(item.event===key){\r\n              item.handler(ctx.obj[key], key);\r\n            }\r\n\r\n      }\r\n      /*\r\n       * Элемент отсутсвует в реестре событий [catalog]\r\n       */\r\n      else{\r\n         console.log('неизвесный элемент: '+ key);\r\n      }   \r\n    });//catalog.forEach\r\n  }//for\r\n\r\n};\r\n\r\nfunction parse(ctx, catalog){\r\n  console.log(`${ctx.scene}/${ctx.label}/${ctx.num}`);\r\n  /** Текущий объект */\r\n  ctx.obj = ctx.arr[ctx.num];\r\n\r\n  tokenize(ctx, catalog);\r\n  ctx.num+=1;\r\n}\r\n\r\nexport default parse;\n\n\n/** WEBPACK FOOTER **\n ** ./src/parse.js\n **/","/*\r\n * Так же потом сделать удаленные сохраненки на\r\n * vnjson.online\r\n */\r\n\r\nexport function save(data){\r\n  localforage.setItem(data.title, data, (err)=>{\r\n    if(err){\r\n      console.log(err);\r\n    }\r\n    console.log('Игра сохранена');\r\n\r\n  });\r\n};\r\n\r\nexport function load(key){\r\n   localforage.getItem(key).then((data)=>{\r\n      console.log(data);\r\n   }).catch(function (err) {\r\n        console.error(err);\r\n   });\r\n}\r\n\r\nexport default {\r\n  save, load\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/memory-card.js\n **/"],"sourceRoot":""}