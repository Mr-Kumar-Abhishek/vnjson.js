{"version":3,"sources":["vnjson.js","plugins/get-scene.js","plugins/get-screens.js","plugins/jump.js","plugins/navigo.js","plugins/router.js","plugins/screen-show.js","plugins/vnjson-audio.js","plugins/vnjson-preload.js"],"names":["vnjs","plugins","TREE","DEBUG","audio","on","event","handler","push","emit","args","Array","isArray","map","call","off","state","scene","label","index","screens","current","object","setScene","name","body","characters","aliase","Object","keys","character","reply","param","assets","parse","obj","ctx","next","init","conf","data","sceneName","labelName","uri","gameDir","scenesDir","local","fetch","then","r","json","console","log","sceneBody","fetchCss","filename","l","document","createElement","rel","href","h","getElementsByTagName","appendChild","uriHtml","uriCss","gameRoot","querySelector","element","text","innerHTML","screensNodeList","querySelectorAll","screenClass","forEach","screen","styles","display","width","height","assign","style","setAttribute","pathname","pathArr","split","getName","isNum","num","test","isScene","length","pathObj","pathArr1","global","factory","exports","module","define","amd","Navigo","_typeof","Symbol","iterator","constructor","prototype","isPushStateAvailable","window","history","pushState","useHash","hash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_onLocationChange","bind","_genericHooks","_historyAPIUpdateMethod","replace","_cLoc","_listen","updatePageLinks","clean","s","RegExp","regExpResultToParams","match","names","slice","reduce","params","value","decodeURIComponent","replaceDynamicURLParts","route","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","getUrlDepth","url","compareUrlDepth","urlA","urlB","findMatchedRoutes","routes","arguments","undefined","_replaceDynamicURLPar","filter","m","matched","fallbackURL","result","isHashChangeAPIAvailable","extractGETParameters","join","getOnlyURL","onlyURL","cleanGETParam","str","manageHooks","hooks","before","shouldRoute","after","isHashedRoot","helpers","navigate","path","absolute","to","_getRoot","resolve","location","_this","_len","_key","func","uses","_add","orderedRoutes","sort","notFound","_this2","GETParameters","query","already","_callLeave","apply","destroy","clearTimeout","_listeningInterval","removeEventListener","self","_findLinks","link","hasListenerAttached","addEventListener","e","getLinkPath","preventDefault","generate","key","toString","pause","status","resume","historyAPIUpdateMethod","disableIfAPINotAvailable","lastRouteResolved","getAttribute","_hooks","encodeURI","as","_this3","cached","_check","check","setTimeout","__NAVIGO_WINDOW_LOCATION_MOCK__","leave","router","warn","getRealDisplay","elem","currentStyle","getComputedStyle","computedStyle","getPropertyValue","hide","el","displayCache","isHidden","offsetWidth","offsetHeight","tr","nodeName","toLowerCase","toggle","show","old","testElem","removeChild","id","prevScreen","getElementById","play","action","error","persent","PROGREESS","i","asset","position","progress","Math","round","type","img","Image","src","onload","Audio","info"],"mappings":"AACA,IAAIA,OAAO;AAELC,WAAS,EAFJ;AAGLC,QAAM,EAHD;AAILC,SAAO,KAJF;AAKLC,SAAO;AALF,CAAX;;AASAJ,KAAKK,EAAL,GAAU,UAASC,KAAT,EAAgBC,OAAhB,EAAwB;AACxB,MAAI,CAACP,KAAKC,OAAL,CAAaK,KAAb,CAAL,EAA0B;AACtBN,SAAKC,OAAL,CAAaK,KAAb,IAAsB,EAAtB;AACH;;AAAA;AACDN,OAAKC,OAAL,CAAaK,KAAb,EAAoBE,IAApB,CAAyBD,OAAzB;AACT,CALD;;AAOAP,KAAKS,IAAL,GAAY,UAAUH,KAAV,EAA0B;AAAA,oCAANI,IAAM;AAANA,QAAM;AAAA;;AAC7B,MAAIC,MAAMC,OAAN,CAAcZ,KAAKC,OAAL,CAAaK,KAAb,CAAd,CAAJ,EAAwC;AACrCN,SAAKC,OAAL,CAAaK,KAAb,EAAoBO,GAApB,CAAwB,UAASN,OAAT,EAAiB;AACjCA,cAAQO,IAAR,iBAAad,IAAb,SAAsBU,IAAtB;AACP,KAFD;AAGF;AACD;;;;;;;AAMR,CAZD;;AAaAV,KAAKe,GAAL,GAAW,UAAUT,KAAV,EAAiB;AACpB,SAAON,KAAKC,OAAL,CAAaK,KAAb,CAAP;AACP,CAFD;AAIA;;;;;;;;AAMAN,KAAKgB,KAAL,GAAa;AACXC,SAAO,OADI;AAEXC,SAAO,OAFI;AAGXC,SAAO,CAHI;AAIXC,WAAS;AAJE,CAAb;AAMA;;;;AAGApB,KAAKqB,OAAL,GAAe;AAETJ,SAAO,iBAAW;AAChB,WAAOjB,KAAKE,IAAL,CAAUF,KAAKgB,KAAL,CAAWC,KAArB,CAAP;AACD,GAJQ;AAKTC,SAAO,iBAAW;AAChB,WAAOlB,KAAKE,IAAL,CAAUF,KAAKgB,KAAL,CAAWC,KAArB,EAA4BjB,KAAKgB,KAAL,CAAWE,KAAvC,CAAP;AACD,GAPQ;AAQTI,UAAQ,kBAAW;AACjB,WAAOtB,KAAKE,IAAL,CAAUF,KAAKgB,KAAL,CAAWC,KAArB,EAA4BjB,KAAKgB,KAAL,CAAWE,KAAvC,EAA8ClB,KAAKgB,KAAL,CAAWG,KAAzD,CAAP;AACF;AAVS,CAAf;;AAcAnB,KAAKuB,QAAL,GAAgB,UAAUC,IAAV,EAAgBC,IAAhB,EAAqB;AACnC,OAAKvB,IAAL,CAAUsB,IAAV,IAAkBC,IAAlB;AACA,OAAKT,KAAL,CAAWC,KAAX,GAAmBO,IAAnB;AAEAC,OAAKC,UAAL,CAAgBb,GAAhB,CAAoB,qBAAW;AAC7B,QAAIc,SAASC,OAAOC,IAAP,CAAYC,SAAZ,EAAuB,CAAvB,CAAb;AAEA9B,SAAKK,EAAL,CAAQsB,MAAR,EAAgB,UAASI,KAAT,EAAe;AACzB/B,WAAKS,IAAL,CAAU,WAAV,EAAuB;AAACkB,sBAAD;AAASK,eAAOF,UAAUH,MAAV,CAAhB;AAAmCI;AAAnC,OAAvB;AAEL,KAHD;AAKH,GARC;AASA,OAAKtB,IAAL,CAAU,MAAV,EAAkBgB,KAAKQ,MAAvB,EAbmC,CAcpC;AACA,CAfD;;AAoBAjC,KAAKkC,KAAL,GAAa,UAAUC,GAAV,EAAc;AACzB,MAAIC,MAAM,IAAV;;AACA,MAAGD,GAAH,EAAO;AACLC,UAAMD,GAAN;AACD,GAFD,MAEK;AACHC,UAAMpC,KAAKqB,OAAL,CAAaC,MAAb,EAAN;AACD;;AAAA;;AAED,OAAI,IAAIhB,KAAR,IAAiB8B,GAAjB,EAAqB;AAEfpC,SAAKS,IAAL,CAAUH,KAAV,EAAiB8B,IAAI9B,KAAJ,CAAjB;AAEL;;AAAA;AAEF,CAdD;;AAiBAN,KAAKqC,IAAL,GAAY,YAAW;AACrB,OAAKH,KAAL;AACA,OAAKlB,KAAL,CAAWG,KAAX;AACA,SAAO,2BAAP;AACD,CAJD;;AAMAnB,KAAKsC,IAAL,GAAY,UAAUC,IAAV,EAAe;AACzBvC,OAAKuC,IAAL,GAAYA,IAAZ,CADyB,CAE1B;;AACCvC,OAAKS,IAAL,CAAU,YAAV;AACA,SAAO,IAAP;AACD,CALD;AC1GA;;;AAIAT,KAAKK,EAAL,CAAQ,UAAR,EAAoB,UAASmC,IAAT,EAAc;AAAA,MACzBC,SADyB,GACOD,IADP,CACzBC,SADyB;AAAA,MACdC,SADc,GACOF,IADP,CACdE,SADc;AAAA,MACHvB,KADG,GACOqB,IADP,CACHrB,KADG;AAAA,MAEzBhB,KAFyB,GAEO,IAFP,CAEzBA,KAFyB;AAAA,MAElBoC,IAFkB,GAEO,IAFP,CAElBA,IAFkB;AAAA,MAEZhB,QAFY,GAEO,IAFP,CAEZA,QAFY;AAAA,MAEFd,IAFE,GAEO,IAFP,CAEFA,IAFE;AAGhC,MAAIkC,gBAASJ,KAAKK,OAAd,cAAyBL,KAAKM,SAA9B,cAA2CN,KAAKO,KAAhD,cAAyDL,SAAzD,UAAJ;AACAhC,OAAK,SAAL,EAAgB+B,IAAhB;AACAO,QAAMJ,GAAN,EACAK,IADA,CACK;AAAA,WAAGC,EAAEC,IAAF,EAAH;AAAA,GADL,EAEAF,IAFA,CAEK,qBAAW;AAEhB,QAAG7C,KAAH,EAAS;AACRgD,cAAQC,GAAR,CAAYX,SAAZ,EAAuBY,SAAvB,EADQ,CAET;AACC;;AAEDrD,SAAKuB,QAAL,CAAckB,SAAd,EAAyBY,SAAzB,EAAoCX,SAApC,EAA+CvB,KAA/C;AAEA,GAXA;AAYF;;;;;;;;AASC,CA1BD;ACJAnB,KAAKK,EAAL,CAAQ,YAAR,EAAsB,YAAU;AAAA,MAExBkC,IAFwB,GAEF,IAFE,CAExBA,IAFwB;AAAA,MAElBpC,KAFkB,GAEF,IAFE,CAElBA,KAFkB;AAAA,MAEXM,IAFW,GAEF,IAFE,CAEXA,IAFW;;AAIhC,WAAS6C,QAAT,CAAkBC,QAAlB,EAA4B;AACxB,QAAIC,IAAIC,SAASC,aAAT,CAAuB,MAAvB,CAAR;AACAF,MAAEG,GAAF,GAAQ,YAAR;AACAH,MAAEI,IAAF,GAASL,QAAT;AACA,QAAIM,IAAIJ,SAASK,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,CAAR;AACAD,MAAEE,WAAF,CAAcP,CAAd;AACH;;AAAA;AAKA,MAAIQ,oBAAazB,KAAKK,OAAlB,kBAAJ;AACA,MAAIqB,mBAAY1B,KAAKK,OAAjB,iBAAJ;AACA,MAAIsB,WAAWT,SAASU,aAAT,CAAuB5B,KAAK6B,OAA5B,CAAf;AACArB,QAAMiB,OAAN,EACEhB,IADF,CACO;AAAA,WAAGC,EAAEoB,IAAF,EAAH;AAAA,GADP,EAGErB,IAHF,CAGO,mBAAS;AACdM,aAASW,MAAT;AACAC,aAASI,SAAT,GAAqBlD,OAArB;AACA,GANF,EAOE4B,IAPF,CAOO,YAAI;AACT,QAAIuB,kBAAkBd,SAASe,gBAAT,CAA0BjC,KAAKkC,WAA/B,CAAtB;AACSF,oBAAgBG,OAAhB,CAAwB,UAACC,MAAD,EAAU;AAEjC,UAAIC,SAAS;AACNC,iBAAS,MADH;AAENC,eAAO,MAFD;AAGNC,gBAAQ;AAHF,OAAb;AAKAnD,aAAOoD,MAAP,CAAcL,OAAOM,KAArB,EAA4BL,MAA5B;AACA;;AACVD,aAAOO,YAAP,CAAoB,YAApB,EAAkCP,OAAOM,KAAP,CAAaJ,OAA/C;AAES1E,eAAOgD,QAAQC,GAAR,CAAYuB,MAAZ,CAAP;AAEC,KAbD;AAeFlE,SAAK,eAAL;AACP,GAzBF,EAlB+B,CA4C9B;AAED,CA9CD;ACAAT,KAAKK,EAAL,CAAQ,MAAR,EAAgB,UAAS8E,QAAT,EAAkB;AAAA,MAE1BjD,KAF0B,GAEI,IAFJ,CAE1BA,KAF0B;AAAA,MAEnBlB,KAFmB,GAEI,IAFJ,CAEnBA,KAFmB;AAAA,MAEZP,IAFY,GAEI,IAFJ,CAEZA,IAFY;AAAA,MAENN,KAFM,GAEI,IAFJ,CAENA,KAFM;AAIlC,MAAMiF,UAAUD,SAASE,KAAT,CAAe,GAAf,CAAhB;AACA;;;;;;;AAMA,WAASC,OAAT,GAAkB;AAChB,QAAI7C,YAAY2C,QAAQ,CAAR,CAAhB;AACA,QAAI1C,YAAY0C,QAAQ,CAAR,CAAhB;AACA,QAAIjE,QAAQiE,QAAQ,CAAR,KAAY,CAAxB;AACA,WAAO;AAAE1C,0BAAF;AAAaD,0BAAb;AAAwBtB,aAAQ,CAACA;AAAjC,KAAP;AACD;;AAAA;;AAED,WAASoE,KAAT,CAAeC,GAAf,EAAmB;AACjB,WAAO,QAAQC,IAAR,CAAa,CAACD,GAAd,CAAP;AACD;;AAAA;;AAED,WAASE,OAAT,CAAiBP,QAAjB,EAA0B;AAExB,QAAGC,QAAQO,MAAR,KAAiB,CAApB,EAAsB;AACpB,aAAO,IAAP;AACD,KAFD,MAEM,IAAGP,QAAQO,MAAR,KAAiB,CAApB,EAAsB;AAE1B,aAAO,CAACJ,MAAMH,QAAQ,CAAR,CAAN,CAAR;AACD;AACF;;AAAA;AAEA,MAAIQ,UAAUN,QAAQH,QAAR,CAAd;AAED;AACChF,aAAOgD,QAAQC,GAAR,CAAY,QAAZ,EAAsBwC,OAAtB,CAAP;AACA;AAAA;;AAMD,MAAGF,QAAQP,QAAR,CAAH,EAAqB;AACjB;AACAnF,SAAKgB,KAAL,CAAWC,KAAX,GAAmB2E,QAAQnD,SAA3B;AACAzC,SAAKgB,KAAL,CAAWE,KAAX,GAAmB0E,QAAQlD,SAA3B;AACA1C,SAAKgB,KAAL,CAAWG,KAAX,GAAmByE,QAAQzE,KAA3B;AACAV,SAAK,UAAL,EAAiBmF,OAAjB;AACH,GAND,MAMK;AACH,QAAMC,WAAWV,SAASE,KAAT,CAAe,GAAf,CAAjB,CADG,CAEH;;AACErF,SAAKgB,KAAL,CAAWC,KAAX,GAAmBjB,KAAKgB,KAAL,CAAWC,KAA9B;AACAjB,SAAKgB,KAAL,CAAWE,KAAX,GAAoB2E,SAAS,CAAT,CAApB;AACA7F,SAAKgB,KAAL,CAAWG,KAAX,GAAmByE,QAAQzE,KAA3B,CALC,CAOF;;AACAe;AACF;AAGA;;;;;;AAMA,CAlED;;;ACAC,WAAU4D,MAAV,EAAkBC,OAAlB,EAA2B;AAC3B,UAAOC,OAAP,0CAAOA,OAAP,OAAmB,QAAnB,IAA+B,OAAOC,MAAP,KAAkB,WAAjD,GAA+DA,OAAOD,OAAP,GAAiBD,SAAhF,GACA,OAAOG,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAAvC,GAA6CD,OAAOH,OAAP,CAA7C,GACCD,OAAOM,MAAP,GAAgBL,SAFjB;AAGA,CAJA,EAIC,IAJD,EAIQ,YAAY;AAAE;;AAEvB,MAAIM,UAAU,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,SAAOA,OAAOC,QAAd,MAA2B,QAA3D,GAAsE,UAAUpE,GAAV,EAAe;AAAE,oBAAcA,GAAd;AAAoB,GAA3G,GAA8G,UAAUA,GAAV,EAAe;AAAE,WAAOA,OAAO,OAAOmE,MAAP,KAAkB,UAAzB,IAAuCnE,IAAIqE,WAAJ,KAAoBF,MAA3D,IAAqEnE,QAAQmE,OAAOG,SAApF,GAAgG,QAAhG,YAAkHtE,GAAlH,CAAP;AAA+H,GAA5Q;;AAEA,WAASuE,oBAAT,GAAgC;AAC9B,WAAO,CAAC,EAAE,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,OAAOC,OAAxC,IAAmDD,OAAOC,OAAP,CAAeC,SAApE,CAAR;AACD;;AAED,WAAST,MAAT,CAAgBnD,CAAhB,EAAmB6D,OAAnB,EAA4BC,IAA5B,EAAkC;AAChC,SAAKC,IAAL,GAAY,IAAZ;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,QAAL,GAAgBJ,OAAhB;AACA,SAAKK,KAAL,GAAa,OAAOJ,IAAP,KAAgB,WAAhB,GAA8B,GAA9B,GAAoCA,IAAjD;AACA,SAAKK,OAAL,GAAe,KAAf;AACA,SAAKC,UAAL,GAAkB,KAAlB;AACA,SAAKC,kBAAL,GAA0B,IAA1B;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,eAAL,GAAuB,IAAvB;AACA,SAAKC,aAAL,GAAqB,CAACX,OAAD,IAAYJ,sBAAjC;AACA,SAAKgB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBC,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAKC,aAAL,GAAqB,IAArB;AACA,SAAKC,uBAAL,GAA+B,WAA/B;;AAEA,QAAI5E,CAAJ,EAAO;AACL,WAAK+D,IAAL,GAAYF,UAAU7D,EAAE6E,OAAF,CAAU,KAAV,EAAiB,MAAM,KAAKX,KAA5B,CAAV,GAA+ClE,EAAE6E,OAAF,CAAU,KAAV,EAAiB,EAAjB,CAA3D;AACD,KAFD,MAEO,IAAIhB,OAAJ,EAAa;AAClB,WAAKE,IAAL,GAAY,KAAKe,KAAL,GAAa1C,KAAb,CAAmB,KAAK8B,KAAxB,EAA+B,CAA/B,EAAkCW,OAAlC,CAA0C,KAA1C,EAAiD,MAAM,KAAKX,KAA5D,CAAZ;AACD;;AAED,SAAKa,OAAL;;AACA,SAAKC,eAAL;AACD;;AAED,WAASC,KAAT,CAAeC,CAAf,EAAkB;AAChB,QAAIA,aAAaC,MAAjB,EAAyB,OAAOD,CAAP;AACzB,WAAOA,EAAEL,OAAF,CAAU,MAAV,EAAkB,EAAlB,EAAsBA,OAAtB,CAA8B,MAA9B,EAAsC,IAAtC,CAAP;AACD;;AAED,WAASO,oBAAT,CAA8BC,KAA9B,EAAqCC,KAArC,EAA4C;AAC1C,QAAIA,MAAM5C,MAAN,KAAiB,CAArB,EAAwB,OAAO,IAAP;AACxB,QAAI,CAAC2C,KAAL,EAAY,OAAO,IAAP;AACZ,WAAOA,MAAME,KAAN,CAAY,CAAZ,EAAeF,MAAM3C,MAArB,EAA6B8C,MAA7B,CAAoC,UAAUC,MAAV,EAAkBC,KAAlB,EAAyBxH,KAAzB,EAAgC;AACzE,UAAIuH,WAAW,IAAf,EAAqBA,SAAS,EAAT;AACrBA,aAAOH,MAAMpH,KAAN,CAAP,IAAuByH,mBAAmBD,KAAnB,CAAvB;AACA,aAAOD,MAAP;AACD,KAJM,EAIJ,IAJI,CAAP;AAKD;;AAED,WAASG,sBAAT,CAAgCC,KAAhC,EAAuC;AACrC,QAAIC,aAAa,EAAjB;AAAA,QACIC,MADJ;;AAGA,QAAIF,iBAAiBV,MAArB,EAA6B;AAC3BY,eAASF,KAAT;AACD,KAFD,MAEO;AACLE,eAAS,IAAIZ,MAAJ,CAAWU,MAAMhB,OAAN,CAAc1B,OAAO6C,gBAArB,EAAuC,UAAUC,IAAV,EAAgBC,IAAhB,EAAsB3H,IAAtB,EAA4B;AACrFuH,mBAAWvI,IAAX,CAAgBgB,IAAhB;AACA,eAAO4E,OAAOgD,uBAAd;AACD,OAHmB,EAGjBtB,OAHiB,CAGT1B,OAAOiD,eAHE,EAGejD,OAAOkD,gBAHtB,IAG0ClD,OAAOmD,wBAH5D,EAGsFnD,OAAOoD,kBAH7F,CAAT;AAID;;AACD,WAAO;AAAER,cAAQA,MAAV;AAAkBD,kBAAYA;AAA9B,KAAP;AACD;;AAED,WAASU,WAAT,CAAqBC,GAArB,EAA0B;AACxB,WAAOA,IAAI5B,OAAJ,CAAY,KAAZ,EAAmB,EAAnB,EAAuBzC,KAAvB,CAA6B,GAA7B,EAAkCM,MAAzC;AACD;;AAED,WAASgE,eAAT,CAAyBC,IAAzB,EAA+BC,IAA/B,EAAqC;AACnC,WAAOJ,YAAYI,IAAZ,IAAoBJ,YAAYG,IAAZ,CAA3B;AACD;;AAED,WAASE,iBAAT,CAA2BJ,GAA3B,EAAgC;AAC9B,QAAIK,SAASC,UAAUrE,MAAV,GAAmB,CAAnB,IAAwBqE,UAAU,CAAV,MAAiBC,SAAzC,GAAqDD,UAAU,CAAV,CAArD,GAAoE,EAAjF;AAEA,WAAOD,OAAOlJ,GAAP,CAAW,UAAUiI,KAAV,EAAiB;AACjC,UAAIoB,wBAAwBrB,uBAAuBX,MAAMY,MAAMA,KAAZ,CAAvB,CAA5B;AAAA,UACIE,SAASkB,sBAAsBlB,MADnC;AAAA,UAEID,aAAamB,sBAAsBnB,UAFvC;;AAIA,UAAIT,QAAQoB,IAAI5B,OAAJ,CAAY,MAAZ,EAAoB,GAApB,EAAyBQ,KAAzB,CAA+BU,MAA/B,CAAZ;AACA,UAAIN,SAASL,qBAAqBC,KAArB,EAA4BS,UAA5B,CAAb;AAEA,aAAOT,QAAQ;AAAEA,eAAOA,KAAT;AAAgBQ,eAAOA,KAAvB;AAA8BJ,gBAAQA;AAAtC,OAAR,GAAyD,KAAhE;AACD,KATM,EASJyB,MATI,CASG,UAAUC,CAAV,EAAa;AACrB,aAAOA,CAAP;AACD,KAXM,CAAP;AAYD;;AAED,WAAS9B,KAAT,CAAeoB,GAAf,EAAoBK,MAApB,EAA4B;AAC1B,WAAOD,kBAAkBJ,GAAlB,EAAuBK,MAAvB,EAA+B,CAA/B,KAAqC,KAA5C;AACD;;AAED,WAAS/C,IAAT,CAAc0C,GAAd,EAAmBK,MAAnB,EAA2B;AACzB,QAAIM,UAAUN,OAAOlJ,GAAP,CAAW,UAAUiI,KAAV,EAAiB;AACxC,aAAOA,MAAMA,KAAN,KAAgB,EAAhB,IAAsBA,MAAMA,KAAN,KAAgB,GAAtC,GAA4CY,GAA5C,GAAkDA,IAAIrE,KAAJ,CAAU,IAAI+C,MAAJ,CAAWU,MAAMA,KAAN,GAAc,QAAzB,CAAV,EAA8C,CAA9C,CAAzD;AACD,KAFa,CAAd;AAGA,QAAIwB,cAAcpC,MAAMwB,GAAN,CAAlB;;AAEA,QAAIW,QAAQ1E,MAAR,GAAiB,CAArB,EAAwB;AACtB,aAAO0E,QAAQ5B,MAAR,CAAe,UAAU8B,MAAV,EAAkBb,GAAlB,EAAuB;AAC3C,YAAIa,OAAO5E,MAAP,GAAgB+D,IAAI/D,MAAxB,EAAgC4E,SAASb,GAAT;AAChC,eAAOa,MAAP;AACD,OAHM,EAGJF,QAAQ,CAAR,CAHI,CAAP;AAID,KALD,MAKO,IAAIA,QAAQ1E,MAAR,KAAmB,CAAvB,EAA0B;AAC/B,aAAO0E,QAAQ,CAAR,CAAP;AACD;;AACD,WAAOC,WAAP;AACD;;AAED,WAASE,wBAAT,GAAoC;AAClC,WAAO,OAAO7D,MAAP,KAAkB,WAAlB,IAAiC,kBAAkBA,MAA1D;AACD;;AAED,WAAS8D,oBAAT,CAA8Bf,GAA9B,EAAmC;AACjC,WAAOA,IAAIrE,KAAJ,CAAU,UAAV,EAAsBmD,KAAtB,CAA4B,CAA5B,EAA+BkC,IAA/B,CAAoC,EAApC,CAAP;AACD;;AAED,WAASC,UAAT,CAAoBjB,GAApB,EAAyB5C,OAAzB,EAAkCC,IAAlC,EAAwC;AACtC,QAAI6D,UAAUlB,GAAd;AAAA,QACIrE,KADJ;;AAEA,QAAIwF,gBAAgB,SAASA,aAAT,CAAuBC,GAAvB,EAA4B;AAC9C,aAAOA,IAAIzF,KAAJ,CAAU,UAAV,EAAsB,CAAtB,CAAP;AACD,KAFD;;AAIA,QAAI,OAAO0B,IAAP,KAAgB,WAApB,EAAiC;AAC/B;AACAA,aAAO,GAAP;AACD;;AAED,QAAIL,0BAA0B,CAACI,OAA/B,EAAwC;AACtC8D,gBAAUC,cAAcnB,GAAd,EAAmBrE,KAAnB,CAAyB0B,IAAzB,EAA+B,CAA/B,CAAV;AACD,KAFD,MAEO;AACL1B,cAAQqE,IAAIrE,KAAJ,CAAU0B,IAAV,CAAR;AACA6D,gBAAUvF,MAAMM,MAAN,GAAe,CAAf,GAAmBkF,cAAcxF,MAAM,CAAN,CAAd,CAAnB,GAA6CwF,cAAcxF,MAAM,CAAN,CAAd,CAAvD;AACD;;AAED,WAAOuF,OAAP;AACD;;AAED,WAASG,WAAT,CAAqBxK,OAArB,EAA8ByK,KAA9B,EAAqCtC,MAArC,EAA6C;AAC3C,QAAIsC,SAAS,CAAC,OAAOA,KAAP,KAAiB,WAAjB,GAA+B,WAA/B,GAA6C3E,QAAQ2E,KAAR,CAA9C,MAAkE,QAA/E,EAAyF;AACvF,UAAIA,MAAMC,MAAV,EAAkB;AAChBD,cAAMC,MAAN,CAAa,YAAY;AACvB,cAAIC,cAAclB,UAAUrE,MAAV,GAAmB,CAAnB,IAAwBqE,UAAU,CAAV,MAAiBC,SAAzC,GAAqDD,UAAU,CAAV,CAArD,GAAoE,IAAtF;AAEA,cAAI,CAACkB,WAAL,EAAkB;AAClB3K;AACAyK,gBAAMG,KAAN,IAAeH,MAAMG,KAAN,CAAYzC,MAAZ,CAAf;AACD,SAND,EAMGA,MANH;AAOA;AACD,OATD,MASO,IAAIsC,MAAMG,KAAV,EAAiB;AACtB5K;AACAyK,cAAMG,KAAN,IAAeH,MAAMG,KAAN,CAAYzC,MAAZ,CAAf;AACA;AACD;AACF;;AACDnI;AACD;;AAED,WAAS6K,YAAT,CAAsB1B,GAAtB,EAA2B5C,OAA3B,EAAoCC,IAApC,EAA0C;AACxC,QAAIL,0BAA0B,CAACI,OAA/B,EAAwC;AACtC,aAAO,KAAP;AACD;;AAED,QAAI,CAAC4C,IAAIpB,KAAJ,CAAUvB,IAAV,CAAL,EAAsB;AACpB,aAAO,KAAP;AACD;;AAED,QAAI1B,QAAQqE,IAAIrE,KAAJ,CAAU0B,IAAV,CAAZ;AAEA,WAAO1B,MAAMM,MAAN,GAAe,CAAf,IAAoBN,MAAM,CAAN,MAAa,EAAxC;AACD;;AAEDe,SAAOK,SAAP,GAAmB;AACjB4E,aAAS;AACP/C,aAAOA,KADA;AAEPtB,YAAMA,IAFC;AAGPkB,aAAOA,KAHA;AAIPyC,kBAAYA;AAJL,KADQ;AAOjBW,cAAU,SAASA,QAAT,CAAkBC,IAAlB,EAAwBC,QAAxB,EAAkC;AAC1C,UAAIC,EAAJ;AAEAF,aAAOA,QAAQ,EAAf;;AACA,UAAI,KAAK9D,aAAT,EAAwB;AACtBgE,aAAK,CAAC,CAACD,QAAD,GAAY,KAAKE,QAAL,KAAkB,GAA9B,GAAoC,EAArC,IAA2CH,KAAKzD,OAAL,CAAa,MAAb,EAAqB,GAArB,CAAhD;AACA2D,aAAKA,GAAG3D,OAAH,CAAW,iBAAX,EAA8B,KAA9B,CAAL;;AACAlB,gBAAQ,KAAKiB,uBAAb,EAAsC,EAAtC,EAA0C,EAA1C,EAA8C4D,EAA9C;;AACA,aAAKE,OAAL;AACD,OALD,MAKO,IAAI,OAAOhF,MAAP,KAAkB,WAAtB,EAAmC;AACxC4E,eAAOA,KAAKzD,OAAL,CAAa,IAAIM,MAAJ,CAAW,MAAM,KAAKjB,KAAtB,CAAb,EAA2C,EAA3C,CAAP;AACAR,eAAOiF,QAAP,CAAgBhI,IAAhB,GAAuB+C,OAAOiF,QAAP,CAAgBhI,IAAhB,CAAqBkE,OAArB,CAA6B,IAA7B,EAAmC,EAAnC,EAAuCA,OAAvC,CAA+C,IAAIM,MAAJ,CAAW,KAAKjB,KAAL,GAAa,KAAxB,CAA/C,EAA+E,EAA/E,IAAqF,KAAKA,KAA1F,GAAkGoE,IAAzH;AACD;;AACD,aAAO,IAAP;AACD,KArBgB;AAsBjBlL,QAAI,SAASA,EAAT,GAAc;AAChB,UAAIwL,QAAQ,IAAZ;;AAEA,WAAK,IAAIC,OAAO9B,UAAUrE,MAArB,EAA6BjF,OAAOC,MAAMmL,IAAN,CAApC,EAAiDC,OAAO,CAA7D,EAAgEA,OAAOD,IAAvE,EAA6EC,MAA7E,EAAqF;AACnFrL,aAAKqL,IAAL,IAAa/B,UAAU+B,IAAV,CAAb;AACD;;AAED,UAAI,OAAOrL,KAAK,CAAL,CAAP,KAAmB,UAAvB,EAAmC;AACjC,aAAK8G,eAAL,GAAuB;AAAEjH,mBAASG,KAAK,CAAL,CAAX;AAAoBsK,iBAAOtK,KAAK,CAAL;AAA3B,SAAvB;AACD,OAFD,MAEO,IAAIA,KAAKiF,MAAL,IAAe,CAAnB,EAAsB;AAC3B,YAAIjF,KAAK,CAAL,MAAY,GAAhB,EAAqB;AACnB,cAAIsL,OAAOtL,KAAK,CAAL,CAAX;;AAEA,cAAI2F,QAAQ3F,KAAK,CAAL,CAAR,MAAqB,QAAzB,EAAmC;AACjCsL,mBAAOtL,KAAK,CAAL,EAAQuL,IAAf;AACD;;AAED,eAAKzE,eAAL,GAAuB;AAAEjH,qBAASyL,IAAX;AAAiBhB,mBAAOtK,KAAK,CAAL;AAAxB,WAAvB;AACD,SARD,MAQO;AACL,eAAKwL,IAAL,CAAUxL,KAAK,CAAL,CAAV,EAAmBA,KAAK,CAAL,CAAnB,EAA4BA,KAAK,CAAL,CAA5B;AACD;AACF,OAZM,MAYA,IAAI2F,QAAQ3F,KAAK,CAAL,CAAR,MAAqB,QAAzB,EAAmC;AACxC,YAAIyL,gBAAgBvK,OAAOC,IAAP,CAAYnB,KAAK,CAAL,CAAZ,EAAqB0L,IAArB,CAA0BzC,eAA1B,CAApB;AAEAwC,sBAAczH,OAAd,CAAsB,UAAUoE,KAAV,EAAiB;AACrC+C,gBAAMxL,EAAN,CAASyI,KAAT,EAAgBpI,KAAK,CAAL,EAAQoI,KAAR,CAAhB;AACD,SAFD;AAGD;;AACD,aAAO,IAAP;AACD,KAnDgB;AAoDjB/H,SAAK,SAASA,GAAT,CAAaR,OAAb,EAAsB;AACzB,UAAI,KAAKiH,eAAL,KAAyB,IAAzB,IAAiCjH,YAAY,KAAKiH,eAAL,CAAqBjH,OAAtE,EAA+E;AAC7E,aAAKiH,eAAL,GAAuB,IAAvB;AACD,OAFD,MAEO,IAAI,KAAKD,gBAAL,KAA0B,IAA1B,IAAkChH,YAAY,KAAKgH,gBAAL,CAAsBhH,OAAxE,EAAiF;AACtF,aAAKgH,gBAAL,GAAwB,IAAxB;AACD;;AACD,WAAKN,OAAL,GAAe,KAAKA,OAAL,CAAawB,MAAb,CAAoB,UAAU8B,MAAV,EAAkBtH,CAAlB,EAAqB;AACtD,YAAIA,EAAE1C,OAAF,KAAcA,OAAlB,EAA2BgK,OAAO/J,IAAP,CAAYyC,CAAZ;AAC3B,eAAOsH,MAAP;AACD,OAHc,EAGZ,EAHY,CAAf;AAIA,aAAO,IAAP;AACD,KA/DgB;AAgEjB8B,cAAU,SAASA,QAAT,CAAkB9L,OAAlB,EAA2ByK,KAA3B,EAAkC;AAC1C,WAAKzD,gBAAL,GAAwB;AAAEhH,iBAASA,OAAX;AAAoByK,eAAOA;AAA3B,OAAxB;AACA,aAAO,IAAP;AACD,KAnEgB;AAoEjBW,aAAS,SAASA,OAAT,CAAiBtK,OAAjB,EAA0B;AACjC,UAAIiL,SAAS,IAAb;;AAEA,UAAI/L,OAAJ,EAAa6J,CAAb;;AACA,UAAIV,MAAM,CAACrI,WAAW,KAAK0G,KAAL,EAAZ,EAA0BD,OAA1B,CAAkC,KAAK4D,QAAL,EAAlC,EAAmD,EAAnD,CAAV;;AAEA,UAAI,KAAKxE,QAAT,EAAmB;AACjBwC,cAAMA,IAAI5B,OAAJ,CAAY,IAAIM,MAAJ,CAAW,QAAQ,KAAKjB,KAAxB,CAAZ,EAA4C,GAA5C,CAAN;AACD;;AAED,UAAIoF,gBAAgB9B,qBAAqBpJ,WAAW,KAAK0G,KAAL,EAAhC,CAApB;AACA,UAAI6C,UAAUD,WAAWjB,GAAX,EAAgB,KAAKxC,QAArB,EAA+B,KAAKC,KAApC,CAAd;AAEA,UAAI,KAAKC,OAAT,EAAkB,OAAO,KAAP;;AAElB,UAAI,KAAKE,kBAAL,IAA2BsD,YAAY,KAAKtD,kBAAL,CAAwBoC,GAA/D,IAAsE6C,kBAAkB,KAAKjF,kBAAL,CAAwBkF,KAApH,EAA2H;AACzH,YAAI,KAAKlF,kBAAL,CAAwB0D,KAAxB,IAAiC,KAAK1D,kBAAL,CAAwB0D,KAAxB,CAA8ByB,OAAnE,EAA4E;AAC1E,eAAKnF,kBAAL,CAAwB0D,KAAxB,CAA8ByB,OAA9B,CAAsC,KAAKnF,kBAAL,CAAwBoB,MAA9D;AACD;;AACD,eAAO,KAAP;AACD;;AAED0B,UAAI9B,MAAMsC,OAAN,EAAe,KAAK3D,OAApB,CAAJ;;AAEA,UAAImD,CAAJ,EAAO;AACL,aAAKsC,UAAL;;AACA,aAAKpF,kBAAL,GAA0B;AACxBoC,eAAKkB,OADmB;AAExB4B,iBAAOD,aAFiB;AAGxBvB,iBAAOZ,EAAEtB,KAAF,CAAQkC,KAHS;AAIxBtC,kBAAQ0B,EAAE1B,MAJc;AAKxBlH,gBAAM4I,EAAEtB,KAAF,CAAQtH;AALU,SAA1B;AAOAjB,kBAAU6J,EAAEtB,KAAF,CAAQvI,OAAlB;AACAwK,oBAAY,YAAY;AACtBA,sBAAY,YAAY;AACtBX,cAAEtB,KAAF,CAAQA,KAAR,YAAyBV,MAAzB,GAAkC7H,QAAQoM,KAAR,CAAc1C,SAAd,EAAyBG,EAAE9B,KAAF,CAAQE,KAAR,CAAc,CAAd,EAAiB4B,EAAE9B,KAAF,CAAQ3C,MAAzB,CAAzB,CAAlC,GAA+FpF,QAAQ6J,EAAE1B,MAAV,EAAkB6D,aAAlB,CAA/F;AACD,WAFD,EAEGnC,EAAEtB,KAAF,CAAQkC,KAFX,EAEkBZ,EAAE1B,MAFpB,EAE4B4D,OAAO1E,aAFnC;AAGD,SAJD,EAIG,KAAKA,aAJR,EAIuBwC,EAAE1B,MAJzB;AAKA,eAAO0B,CAAP;AACD,OAhBD,MAgBO,IAAI,KAAK5C,eAAL,KAAyBoD,YAAY,EAAZ,IAAkBA,YAAY,GAA9B,IAAqCA,YAAY,KAAKzD,KAAtD,IAA+DiE,aAAaR,OAAb,EAAsB,KAAK1D,QAA3B,EAAqC,KAAKC,KAA1C,CAAxF,CAAJ,EAA+I;AACpJ4D,oBAAY,YAAY;AACtBA,sBAAY,YAAY;AACtBuB,mBAAOI,UAAP;;AACAJ,mBAAOhF,kBAAP,GAA4B;AAAEoC,mBAAKkB,OAAP;AAAgB4B,qBAAOD,aAAvB;AAAsCvB,qBAAOsB,OAAO9E,eAAP,CAAuBwD;AAApE,aAA5B;;AACAsB,mBAAO9E,eAAP,CAAuBjH,OAAvB,CAA+BgM,aAA/B;AACD,WAJD,EAIGD,OAAO9E,eAAP,CAAuBwD,KAJ1B;AAKD,SAND,EAMG,KAAKpD,aANR;AAOA,eAAO,IAAP;AACD,OATM,MASA,IAAI,KAAKL,gBAAT,EAA2B;AAChCwD,oBAAY,YAAY;AACtBA,sBAAY,YAAY;AACtBuB,mBAAOI,UAAP;;AACAJ,mBAAOhF,kBAAP,GAA4B;AAAEoC,mBAAKkB,OAAP;AAAgB4B,qBAAOD,aAAvB;AAAsCvB,qBAAOsB,OAAO/E,gBAAP,CAAwByD;AAArE,aAA5B;;AACAsB,mBAAO/E,gBAAP,CAAwBhH,OAAxB,CAAgCgM,aAAhC;AACD,WAJD,EAIGD,OAAO/E,gBAAP,CAAwByD,KAJ3B;AAKD,SAND,EAMG,KAAKpD,aANR;AAOD;;AACD,aAAO,KAAP;AACD,KA/HgB;AAgIjBgF,aAAS,SAASA,OAAT,GAAmB;AAC1B,WAAK3F,OAAL,GAAe,EAAf;AACA,WAAKI,UAAL,GAAkB,IAAlB;AACA,WAAKC,kBAAL,GAA0B,IAA1B;AACA,WAAKM,aAAL,GAAqB,IAArB;AACAiF,mBAAa,KAAKC,kBAAlB;;AACA,UAAI,OAAOnG,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,eAAOoG,mBAAP,CAA2B,UAA3B,EAAuC,KAAKrF,iBAA5C;AACAf,eAAOoG,mBAAP,CAA2B,YAA3B,EAAyC,KAAKrF,iBAA9C;AACD;AACF,KA1IgB;AA2IjBO,qBAAiB,SAASA,eAAT,GAA2B;AAC1C,UAAI+E,OAAO,IAAX;AAEA,UAAI,OAAOvJ,QAAP,KAAoB,WAAxB,EAAqC;;AAErC,WAAKwJ,UAAL,GAAkBvI,OAAlB,CAA0B,UAAUwI,IAAV,EAAgB;AACxC,YAAI,CAACA,KAAKC,mBAAV,EAA+B;AAC7BD,eAAKE,gBAAL,CAAsB,OAAtB,EAA+B,UAAUC,CAAV,EAAa;AAC1C,gBAAIzB,WAAWoB,KAAKM,WAAL,CAAiBJ,IAAjB,CAAf;;AAEA,gBAAI,CAACF,KAAK3F,UAAV,EAAsB;AACpBgG,gBAAEE,cAAF;AACAP,mBAAK1B,QAAL,CAAcM,SAAS9D,OAAT,CAAiB,MAAjB,EAAyB,EAAzB,EAA6BA,OAA7B,CAAqC,MAArC,EAA6C,GAA7C,CAAd;AACD;AACF,WAPD;AAQAoF,eAAKC,mBAAL,GAA2B,IAA3B;AACD;AACF,OAZD;AAaD,KA7JgB;AA8JjBK,cAAU,SAASA,QAAT,CAAkBhM,IAAlB,EAAwB;AAChC,UAAIgB,OAAOwH,UAAUrE,MAAV,GAAmB,CAAnB,IAAwBqE,UAAU,CAAV,MAAiBC,SAAzC,GAAqDD,UAAU,CAAV,CAArD,GAAoE,EAA/E;;AAEA,UAAIO,SAAS,KAAKtD,OAAL,CAAawB,MAAb,CAAoB,UAAU8B,MAAV,EAAkBzB,KAAlB,EAAyB;AACxD,YAAI2E,GAAJ;;AAEA,YAAI3E,MAAMtH,IAAN,KAAeA,IAAnB,EAAyB;AACvB+I,mBAASzB,MAAMA,KAAf;;AACA,eAAK2E,GAAL,IAAYjL,IAAZ,EAAkB;AAChB+H,qBAASA,OAAOmD,QAAP,GAAkB5F,OAAlB,CAA0B,MAAM2F,GAAhC,EAAqCjL,KAAKiL,GAAL,CAArC,CAAT;AACD;AACF;;AACD,eAAOlD,MAAP;AACD,OAVY,EAUV,EAVU,CAAb;;AAYA,aAAO,KAAKrD,QAAL,GAAgB,KAAKC,KAAL,GAAaoD,MAA7B,GAAsCA,MAA7C;AACD,KA9KgB;AA+KjB2C,UAAM,SAASA,IAAT,CAAc3B,IAAd,EAAoB;AACxB,aAAO,KAAKG,QAAL,KAAkBH,IAAzB;AACD,KAjLgB;AAkLjBoC,WAAO,SAASA,KAAT,GAAiB;AACtB,UAAIC,SAAS5D,UAAUrE,MAAV,GAAmB,CAAnB,IAAwBqE,UAAU,CAAV,MAAiBC,SAAzC,GAAqDD,UAAU,CAAV,CAArD,GAAoE,IAAjF;AAEA,WAAK5C,OAAL,GAAewG,MAAf;;AACA,UAAIA,MAAJ,EAAY;AACV,aAAK/F,uBAAL,GAA+B,cAA/B;AACD,OAFD,MAEO;AACL,aAAKA,uBAAL,GAA+B,WAA/B;AACD;AACF,KA3LgB;AA4LjBgG,YAAQ,SAASA,MAAT,GAAkB;AACxB,WAAKF,KAAL,CAAW,KAAX;AACD,KA9LgB;AA+LjBG,4BAAwB,SAASA,sBAAT,CAAgCnF,KAAhC,EAAuC;AAC7D,UAAI,OAAOA,KAAP,KAAiB,WAArB,EAAkC,OAAO,KAAKd,uBAAZ;AAClC,WAAKA,uBAAL,GAA+Bc,KAA/B;AACA,aAAOA,KAAP;AACD,KAnMgB;AAoMjBoF,8BAA0B,SAASA,wBAAT,GAAoC;AAC5D,UAAI,CAACrH,sBAAL,EAA6B;AAC3B,aAAKkG,OAAL;AACD;AACF,KAxMgB;AAyMjBoB,uBAAmB,SAASA,iBAAT,GAA6B;AAC9C,aAAO,KAAK1G,kBAAZ;AACD,KA3MgB;AA4MjBgG,iBAAa,SAASA,WAAT,CAAqBJ,IAArB,EAA2B;AACtC,aAAOA,KAAKe,YAAL,CAAkB,MAAlB,CAAP;AACD,KA9MgB;AA+MjBjD,WAAO,SAASA,KAAT,CAAekD,MAAf,EAAuB;AAC5B,WAAKtG,aAAL,GAAqBsG,MAArB;AACD,KAjNgB;AAmNjBhC,UAAM,SAASA,IAAT,CAAcpD,KAAd,EAAqB;AACzB,UAAIvI,UAAUyJ,UAAUrE,MAAV,GAAmB,CAAnB,IAAwBqE,UAAU,CAAV,MAAiBC,SAAzC,GAAqDD,UAAU,CAAV,CAArD,GAAoE,IAAlF;AACA,UAAIgB,QAAQhB,UAAUrE,MAAV,GAAmB,CAAnB,IAAwBqE,UAAU,CAAV,MAAiBC,SAAzC,GAAqDD,UAAU,CAAV,CAArD,GAAoE,IAAhF;;AAEA,UAAI,OAAOlB,KAAP,KAAiB,QAArB,EAA+B;AAC7BA,gBAAQqF,UAAUrF,KAAV,CAAR;AACD;;AACD,WAAK7B,OAAL,CAAazG,IAAb,CAAkB,CAAC,OAAOD,OAAP,KAAmB,WAAnB,GAAiC,WAAjC,GAA+C8F,QAAQ9F,OAAR,CAAhD,MAAsE,QAAtE,GAAiF;AACjGuI,eAAOA,KAD0F;AAEjGvI,iBAASA,QAAQ0L,IAFgF;AAGjGzK,cAAMjB,QAAQ6N,EAHmF;AAIjGpD,eAAOA,SAASzK,QAAQyK;AAJyE,OAAjF,GAKd;AAAElC,eAAOA,KAAT;AAAgBvI,iBAASA,OAAzB;AAAkCyK,eAAOA;AAAzC,OALJ;;AAOA,aAAO,KAAKkB,IAAZ;AACD,KAlOgB;AAmOjBR,cAAU,SAASA,QAAT,GAAoB;AAC5B,UAAI,KAAK1E,IAAL,KAAc,IAAlB,EAAwB,OAAO,KAAKA,IAAZ;AACxB,WAAKA,IAAL,GAAYA,KAAK,KAAKe,KAAL,GAAa1C,KAAb,CAAmB,GAAnB,EAAwB,CAAxB,CAAL,EAAiC,KAAK4B,OAAtC,CAAZ;AACA,aAAO,KAAKD,IAAZ;AACD,KAvOgB;AAwOjBgB,aAAS,SAASA,OAAT,GAAmB;AAC1B,UAAIqG,SAAS,IAAb;;AAEA,UAAI,KAAK5G,aAAT,EAAwB;AACtBd,eAAOyG,gBAAP,CAAwB,UAAxB,EAAoC,KAAK1F,iBAAzC;AACD,OAFD,MAEO,IAAI8C,0BAAJ,EAAgC;AACrC7D,eAAOyG,gBAAP,CAAwB,YAAxB,EAAsC,KAAK1F,iBAA3C;AACD,OAFM,MAEA;AACL,YAAI4G,SAAS,KAAKvG,KAAL,EAAb;AAAA,YACI1G,UAAU,KAAK,CADnB;AAAA,YAEIkN,SAAS,KAAK,CAFlB;;AAIAA,iBAAS,SAASC,KAAT,GAAiB;AACxBnN,oBAAUgN,OAAOtG,KAAP,EAAV;;AACA,cAAIuG,WAAWjN,OAAf,EAAwB;AACtBiN,qBAASjN,OAAT;;AACAgN,mBAAO1C,OAAP;AACD;;AACD0C,iBAAOvB,kBAAP,GAA4B2B,WAAWF,MAAX,EAAmB,GAAnB,CAA5B;AACD,SAPD;;AAQAA;AACD;AACF,KA9PgB;AA+PjBxG,WAAO,SAASA,KAAT,GAAiB;AACtB,UAAI,OAAOpB,MAAP,KAAkB,WAAtB,EAAmC;AACjC,YAAI,OAAOA,OAAO+H,+BAAd,KAAkD,WAAtD,EAAmE;AACjE,iBAAO/H,OAAO+H,+BAAd;AACD;;AACD,eAAOxG,MAAMvB,OAAOiF,QAAP,CAAgBhI,IAAtB,CAAP;AACD;;AACD,aAAO,EAAP;AACD,KAvQgB;AAwQjBqJ,gBAAY,SAASA,UAAT,GAAsB;AAChC,aAAO,GAAGzE,KAAH,CAAS1H,IAAT,CAAc2C,SAASe,gBAAT,CAA0B,eAA1B,CAAd,CAAP;AACD,KA1QgB;AA2QjBkD,uBAAmB,SAASA,iBAAT,GAA6B;AAC9C,WAAKiE,OAAL;AACD,KA7QgB;AA8QjBe,gBAAY,SAASA,UAAT,GAAsB;AAChC,UAAIsB,oBAAoB,KAAK1G,kBAA7B;;AAEA,UAAI0G,qBAAqBA,kBAAkBhD,KAAvC,IAAgDgD,kBAAkBhD,KAAlB,CAAwB2D,KAA5E,EAAmF;AACjFX,0BAAkBhD,KAAlB,CAAwB2D,KAAxB,CAA8BX,kBAAkBtF,MAAhD;AACD;AACF;AApRgB,GAAnB;AAuRAtC,SAAO6C,gBAAP,GAA0B,cAA1B;AACA7C,SAAOiD,eAAP,GAAyB,KAAzB;AACAjD,SAAOgD,uBAAP,GAAiC,UAAjC;AACAhD,SAAOkD,gBAAP,GAA0B,QAA1B;AACAlD,SAAOmD,wBAAP,GAAkC,WAAlC;AACAnD,SAAOoD,kBAAP,GAA4B,EAA5B;AAEA,SAAOpD,MAAP;AAEC,CAjdA,CAAD;ACAA;AACC,MAAIY,OAAO,IAAX;AACAhH,OAAK4O,MAAL,GAAc,IAAIxI,MAAJ,CAAWY,IAAX,EAAiB,IAAjB,EAAuB,IAAvB,CAAd;AACA;AAAA;AAEDhH,KAAK4O,MAAL,CACGvO,EADH,CACM;AAAA,SAAI8C,QAAQC,GAAR,CAAY,sCAAZ,CAAJ;AAAA,CADN,EAGG/C,EAHH,CAGM,SAHN,EAGiB,UAASqI,MAAT,EAAgB;AAAA,MACxBzH,KADwB,GACdyH,MADc,CACxBzH,KADwB;AAE7BkC,UAAQ0L,IAAR,CAAa,CAAC5N,KAAD,EAAQyJ,IAAR,CAAa,GAAb,CAAb;AACD,CANH,EAOGrK,EAPH,CAOM,gBAPN,EAOwB,UAASqI,MAAT,EAAgB;AAAA,MAC/BzH,KAD+B,GACdyH,MADc,CAC/BzH,KAD+B;AAAA,MACxBC,KADwB,GACdwH,MADc,CACxBxH,KADwB;AAEpCiC,UAAQ0L,IAAR,CAAa,CAAC5N,KAAD,EAAOC,KAAP,EAAcwJ,IAAd,CAAmB,GAAnB,CAAb;AACD,CAVH,EAWGrK,EAXH,CAWM,uBAXN,EAW+B,UAAUqI,MAAV,EAAkB;AACjD;AADiD,MAEvCzH,KAFuC,GAEfyH,MAFe,CAEvCzH,KAFuC;AAAA,MAEhCC,KAFgC,GAEfwH,MAFe,CAEhCxH,KAFgC;AAAA,MAEzBC,KAFyB,GAEfuH,MAFe,CAEzBvH,KAFyB;AAG7CgC,UAAQ0L,IAAR,CAAa,CAAC5N,KAAD,EAAOC,KAAP,EAAcC,KAAd,EAAqBuJ,IAArB,CAA0B,GAA1B,CAAb;AACD,CAfH,EAgBG2B,QAhBH,CAgBY,YAAU;AACnBlJ,UAAQ0L,IAAR,CAAa,wBAAb;AACA,CAlBH,EAmBGlD,OAnBH;ACLA;;;;;;;;;;;;;AAaA,SAASmD,cAAT,CAAwBC,IAAxB,EAA8B;AAC7B,MAAIA,KAAKC,YAAT,EAAuB;AACtB,WAAOD,KAAKC,YAAL,CAAkBnK,OAAzB;AACA,GAFD,MAEO,IAAI8B,OAAOsI,gBAAX,EAA6B;AACnC,QAAIC,gBAAgBvI,OAAOsI,gBAAP,CAAwBF,IAAxB,EAA8B,IAA9B,CAApB;AAEA,WAAOG,cAAcC,gBAAd,CAA+B,SAA/B,CAAP;AACA;AACD;;AAED,SAASC,IAAT,CAAcC,EAAd,EAAkB;AACjB,MAAI,CAACA,GAAGpB,YAAH,CAAgB,YAAhB,CAAL,EAAoC;AACnCoB,OAAGnK,YAAH,CAAgB,YAAhB,EAA8BmK,GAAGpK,KAAH,CAASJ,OAAvC;AACA;;AAEDwK,KAAGpK,KAAH,CAASJ,OAAT,GAAmB,MAAnB;AACA;;AAEDyK,eAAe,EAAf;;AAEA,SAASC,QAAT,CAAkBF,EAAlB,EAAsB;AACrB,MAAIvK,QAAQuK,GAAGG,WAAf;AAAA,MAA4BzK,SAASsK,GAAGI,YAAxC;AAAA,MACCC,KAAKL,GAAGM,QAAH,CAAYC,WAAZ,OAA8B,IADpC;AAGA,SAAO9K,UAAU,CAAV,IAAeC,WAAW,CAA1B,IAA+B,CAAC2K,EAAhC,GACN,IADM,GACC5K,QAAQ,CAAR,IAAaC,SAAS,CAAtB,IAA2B,CAAC2K,EAA5B,GAAiC,KAAjC,GAAyCZ,eAAeO,EAAf,CADjD;AAEA;;AAED,SAASQ,MAAT,CAAgBR,EAAhB,EAAoB;AACnBE,WAASF,EAAT,IAAeS,KAAKT,EAAL,CAAf,GAA0BD,KAAKC,EAAL,CAA1B;AACA;;AAGD,SAASS,IAAT,CAAcT,EAAd,EAAkB;AAEjB,MAAIP,eAAeO,EAAf,KAAsB,MAA1B,EAAkC;AAElC,MAAIU,MAAMV,GAAGpB,YAAH,CAAgB,YAAhB,CAAV;AACAoB,KAAGpK,KAAH,CAASJ,OAAT,GAAmBkL,OAAO,EAA1B;;AAEA,MAAKjB,eAAeO,EAAf,MAAuB,MAA5B,EAAqC;AACpC,QAAIM,WAAWN,GAAGM,QAAlB;AAAA,QAA4BlO,OAAOgC,SAAShC,IAA5C;AAAA,QAAkDoD,OAAlD;;AAEA,QAAKyK,aAAaK,QAAb,CAAL,EAA8B;AAC7B9K,gBAAUyK,aAAaK,QAAb,CAAV;AACA,KAFD,MAEO;AACN,UAAIK,WAAWvM,SAASC,aAAT,CAAuBiM,QAAvB,CAAf;AACAlO,WAAKsC,WAAL,CAAiBiM,QAAjB;AACAnL,gBAAUiK,eAAekB,QAAf,CAAV;;AAEA,UAAInL,YAAY,MAAhB,EAAyB;AACxBA,kBAAU,OAAV;AACA;;AAEDpD,WAAKwO,WAAL,CAAiBD,QAAjB;AACAV,mBAAaK,QAAb,IAAyB9K,OAAzB;AACA;;AAEDwK,OAAGnK,YAAH,CAAgB,YAAhB,EAA8BL,OAA9B;AACAwK,OAAGpK,KAAH,CAASJ,OAAT,GAAmBA,OAAnB;AACA;AACD;;AAGD7E,KAAKK,EAAL,CAAQ,QAAR,EAAkB,UAAS6P,EAAT,EAAY;AAC7B,OAAKzP,IAAL,CAAUyP,EAAV,EAD6B,CAE7B;;AACAlQ,OAAKmQ,UAAL,GAAkB,IAAlB;AACK;;AACL,MAAG,KAAKA,UAAL,KAAmB,IAAtB,EAA2B;AACtBf,SAAK,KAAKe,UAAV;AACJ,GAP4B,CAS7B;AACA;AACA;AACA;;;AACAL,OAAKrM,SAAS2M,cAAT,CAAwBF,EAAxB,CAAL;AACA,CAdD;;;AC5EAlQ,KAAKK,EAAL,CAAQ,OAAR,EAAiB,UAASmC,IAAT,EAAc;AAC7B,MAAG,OAAOA,IAAP,KAAgB,QAAnB,EAA4B;AACvBxC,SAAKI,KAAL,CAAWoC,IAAX,EAAiB6N,IAAjB;AAEJ,GAHD,MAGM,IAAG,QAAO7N,IAAP,MAAgB,QAAnB,EAA4B;AAC9BxC,SAAKI,KAAL,CAAWoC,KAAK0N,EAAhB,EAAoB1N,KAAK8N,MAAzB,IAD8B,CAE/B;AACF,GAHK,MAGD;AACHnN,YAAQoN,KAAR,CAAc,oBAAd;AACD;AAGF,CAZD;ACDA;;;;;AAMAvQ,KAAKK,EAAL,CAAQ,MAAR,EAAgB,UAAS4B,MAAT,EAAgB;AAAA,MACtB9B,KADsB,GACN,IADM,CACtBA,KADsB;AAAA,MACfM,IADe,GACN,IADM,CACfA,IADe;AAIhC,MAAI+P,UAAU,MAAIvO,OAAO0D,MAAzB;AACA,MAAI8K,YAAY,CAAhB;AACA,MAAIC,IAAI,CAAR;;AANgC,6BAOxBC,KAPwB;AAS5BC,eAAW,CAAEF,KAAG,CAAL,EAAQ,GAAR,EAAazO,OAAO0D,MAApB,EAA6B+E,IAA7B,CAAkC,EAAlC,CATiB;AAWhC,QAAImG,WAAWC,KAAKC,KAAL,CAAWN,aAAWD,OAAtB,IAA+B,GAA9C;;AAGE,QAAGG,MAAMK,IAAN,KAAa,OAAhB,EAAwB;AACnB,UAAIC,MAAM,IAAIC,KAAJ,EAAV;AACID,UAAIE,GAAJ,GAAUR,MAAMpF,IAAhB;;AACA0F,UAAIG,MAAJ,GAAa,YAAU;AACjB3Q,aAAK,WAAL,EAAkBkQ,KAAlB;AACL,OAFD;AAGR,KAND,MAOK,IAAGA,MAAMK,IAAN,KAAa,OAAhB,EAAwB;AACxB,UAAI5Q,QAAQ,IAAIiR,KAAJ,EAAZ;AACIjR,YAAMgN,gBAAN,CAAuB,gBAAvB,EAAyC,YAAI;AACtC3M,aAAK,WAAL,EAAkBkQ,KAAlB;AACN,OAFD,EAEG,KAFH;AAGDvQ,YAAM+Q,GAAN,GAAYR,MAAMpF,IAAlB;AACFvL,WAAKI,KAAL,CAAWuQ,MAAMT,EAAjB,IAAuB9P,KAAvB;AACL,KAPI,MAQD;AACF+C,cAAQoN,KAAR,CAAc,qBAAd;AACA;AACD;;AACH,QAAI/N,OAAOZ,OAAOoD,MAAP,CAAc2L,KAAd,EAAqB;AAACE,wBAAD;AAAWD;AAAX,KAArB,CAAX;AACkBnQ,SAAK,OAAL,EAAc+B,IAAd;AAlCc;;AAAA;AAAA;AAAA;;AAAA;AAOhC,yBAAiBP,MAAjB,8HAAwB;AAAA,UAAhB0O,KAAgB;AAAA,UAEpBC,QAFoB;;AAAA,uBAAhBD,KAAgB;;AAAA,4BAwBpB;AAIH;AAnC+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmC/B;AAED;AACExQ,aAAOgD,QAAQmO,IAAR,CAAa,YAAb,CAAP;AACD;AAAA;AAGC7Q,OAAK,UAAL;AACD,CA3CD","file":"vnjson.js","sourcesContent":["\r\nvar vnjs = {\r\n  \r\n      plugins: {},\r\n      TREE: {},\r\n      DEBUG: false,\r\n      audio: {}\r\n\r\n};\r\n\r\nvnjs.on = function(event, handler){\r\n          if (!vnjs.plugins[event]) {\r\n              vnjs.plugins[event] = [];\r\n          };\r\n          vnjs.plugins[event].push(handler);\r\n};\r\n\r\nvnjs.emit = function (event, ...args) {\r\n         if (Array.isArray(vnjs.plugins[event])) {\r\n            vnjs.plugins[event].map(function(handler){\r\n                    handler.call(vnjs, ...args);\r\n            });\r\n         }\r\n         /*\r\n         else{\r\n          Выводятся системные слушатели\r\n          console.log(`Event [ ${event} ] not found`)\r\n         }\r\n         */\r\n};\r\nvnjs.off = function (event) {\r\n        delete vnjs.plugins[event];\r\n};\r\n\r\n/*\r\n * В {state} должно помещаться все то\r\n * что сохроняется в карту памяти\r\n * И что важно загрузить из нее без последствий.\r\n * В состоянии не должно быть мусора\r\n */\r\nvnjs.state = {\r\n  scene: 'scene',\r\n  label: 'label',\r\n  index: 0,\r\n  screens: []\r\n};\r\n/*\r\n * Получает текущее тела из состояние\r\n */\r\nvnjs.current = {\r\n  \r\n      scene: function (){\r\n        return vnjs.TREE[vnjs.state.scene];\r\n      },\r\n      label: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label];\r\n      },\r\n      object: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label][vnjs.state.index];\r\n     }\r\n};\r\n\r\n\r\nvnjs.setScene = function (name, body){\r\n  this.TREE[name] = body;\r\n  this.state.scene = name;\r\n\r\n  body.characters.map(character=>{\r\n    let aliase = Object.keys(character)[0];\r\n\r\n    vnjs.on(aliase, function(reply){\r\n          vnjs.emit('character', {aliase, param: character[aliase], reply } );\r\n\r\n    });\r\n\r\n});\r\n  this.emit('load', body.assets);\r\n // this.parse();//??? Возможно это будет вызываться не здесь\r\n};\r\n\r\n\r\n\r\n\r\nvnjs.parse = function (obj){\r\n  var ctx = null;\r\n  if(obj){\r\n    ctx = obj;\r\n  }else{\r\n    ctx = vnjs.current.object();\r\n  };\r\n\r\n  for(let event in ctx){\r\n\r\n        vnjs.emit(event, ctx[event]);\r\n\r\n  };\r\n\r\n};\r\n\r\n\r\nvnjs.next = function (){\r\n  this.parse();\r\n  this.state.index++;\r\n  return '-------------------------';\r\n};\r\n\r\nvnjs.init = function (conf){\r\n  vnjs.conf = conf;\r\n // this.parse({'jump': conf.entryScene});\r\n  vnjs.emit('getScreens');\r\n  return true;\r\n};\r\n","/**\r\n conf = /scenes/\r\n*/\r\n\r\nvnjs.on('getScene', function(data){\r\n\tconst { sceneName, labelName, index } = data;\r\n\tconst { DEBUG, conf, setScene, emit } = this;\r\n  let uri = `${conf.gameDir}/${conf.scenesDir}/${conf.local}/${sceneName}.json`;\r\n  emit('preload', data);\r\n  fetch(uri)\r\n\t.then(r=>r.json())\r\n\t.then(sceneBody=>{\r\n\r\n\t\tif(DEBUG){\r\n\t\t\tconsole.log(sceneName, sceneBody)\r\n\t\t//\tconsole.log(data);\r\n\t\t}\r\n\r\n\t\tvnjs.setScene(sceneName, sceneBody, labelName, index);\r\n\r\n\t})\r\n/*\r\n\r\nsetScene(\"*\", sceneBody);\r\n\r\nstate.label = \"mainMenu\";\r\n\r\nnext();\r\n*/\r\n\r\n});","vnjs.on('getScreens', function(){\r\n\r\nconst { conf, DEBUG, emit } = this;\r\n\r\nfunction fetchCss(filename) {\r\n    var l = document.createElement('link');\r\n    l.rel = 'stylesheet';\r\n    l.href = filename\r\n    var h = document.getElementsByTagName('head')[0];\r\n    h.appendChild(l);\r\n};\r\n\r\n\r\n\r\n\t\r\n\tlet uriHtml = `${conf.gameDir}/screens.html`;\r\n\tlet uriCss = `${conf.gameDir}/screens.css`;\r\n\tlet gameRoot = document.querySelector(conf.element);\r\n\tfetch(uriHtml)\r\n\t\t.then(r=>r.text())\r\n\t\t\r\n\t\t.then(screens=>{\r\n\t\t\tfetchCss(uriCss);\r\n\t\t\tgameRoot.innerHTML = screens;\r\n\t\t})\r\n\t\t.then(()=>{\r\n\t\t\tlet screensNodeList = document.querySelectorAll(conf.screenClass);\r\n            screensNodeList.forEach((screen)=>{\r\n\r\n             let styles = {\r\n                    display: 'none',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                  };\r\n             Object.assign(screen.style, styles);\r\n             /*Код кантораЮ необходимо для работы 'Правильлного show/hide'*/\r\n\t\t\tscreen.setAttribute(\"displayOld\", screen.style.display)\r\n             \r\n            DEBUG&&console.log(screen);\r\n            \r\n            });\r\n\r\n          emit('screensLoaded')\r\n\t\t})\r\n\t\t//.catch(function(error) { console.error(error); })\r\n\t\t\r\n})","vnjs.on('jump', function(pathname){\r\n\r\nconst { parse, state, emit, DEBUG } = this;\r\n\r\nconst pathArr = pathname.split('/');\r\n/*****\r\n#WARN\r\n> {jump: 'label/0'}\r\n< Object { labelName: \"0\", sceneName: \"label\", index: 0 }\r\n\r\n******/\r\nfunction getName(){\r\n  let sceneName = pathArr[0];\r\n  let labelName = pathArr[1];\r\n  let index = pathArr[2]||0;\r\n  return { labelName, sceneName, index: (+index) };\r\n};\r\n\r\nfunction isNum(num){\r\n  return /[0-9]/.test(+num)\r\n};\r\n\r\nfunction isScene(pathname){\r\n\r\n  if(pathArr.length===3){\r\n    return true;\r\n  }else if(pathArr.length===2){\r\n   \r\n    return !isNum(pathArr[1])\r\n  }\r\n};\r\n\r\n var pathObj = getName(pathname);\r\n\r\n{\r\n\tDEBUG&&console.log('jump: ', pathObj);\r\n};\r\n\r\n\r\n\r\n\r\n\r\nif(isScene(pathname)){\r\n    // set state\r\n    vnjs.state.scene = pathObj.sceneName;\r\n    vnjs.state.label = pathObj.labelName;\r\n    vnjs.state.index = pathObj.index;\r\n    emit('getScene', pathObj);\r\n}else{\r\n  const pathArr1 = pathname.split('/');\r\n\t // set state\r\n    vnjs.state.scene = vnjs.state.scene;\r\n    vnjs.state.label =  pathArr1[1]\r\n    vnjs.state.index = pathObj.index;\r\n\r\n   // setLabel(pathname, ctx.scene[pathname],  obj.num );\r\n   parse();\r\n}\r\n\r\n\r\n /*\r\n\tstate.index = 0;\r\n\tstate.label = \"chapter1\";\r\n\tstate.scene = \"scene2\";\r\n\tparse();*/\r\n\r\n});\r\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.Navigo = factory());\n}(this, (function () { 'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction isPushStateAvailable() {\n  return !!(typeof window !== 'undefined' && window.history && window.history.pushState);\n}\n\nfunction Navigo(r, useHash, hash) {\n  this.root = null;\n  this._routes = [];\n  this._useHash = useHash;\n  this._hash = typeof hash === 'undefined' ? '#' : hash;\n  this._paused = false;\n  this._destroyed = false;\n  this._lastRouteResolved = null;\n  this._notFoundHandler = null;\n  this._defaultHandler = null;\n  this._usePushState = !useHash && isPushStateAvailable();\n  this._onLocationChange = this._onLocationChange.bind(this);\n  this._genericHooks = null;\n  this._historyAPIUpdateMethod = 'pushState';\n\n  if (r) {\n    this.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\n  } else if (useHash) {\n    this.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\n  }\n\n  this._listen();\n  this.updatePageLinks();\n}\n\nfunction clean(s) {\n  if (s instanceof RegExp) return s;\n  return s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\n}\n\nfunction regExpResultToParams(match, names) {\n  if (names.length === 0) return null;\n  if (!match) return null;\n  return match.slice(1, match.length).reduce(function (params, value, index) {\n    if (params === null) params = {};\n    params[names[index]] = decodeURIComponent(value);\n    return params;\n  }, null);\n}\n\nfunction replaceDynamicURLParts(route) {\n  var paramNames = [],\n      regexp;\n\n  if (route instanceof RegExp) {\n    regexp = route;\n  } else {\n    regexp = new RegExp(route.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\n      paramNames.push(name);\n      return Navigo.REPLACE_VARIABLE_REGEXP;\n    }).replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP, Navigo.MATCH_REGEXP_FLAGS);\n  }\n  return { regexp: regexp, paramNames: paramNames };\n}\n\nfunction getUrlDepth(url) {\n  return url.replace(/\\/$/, '').split('/').length;\n}\n\nfunction compareUrlDepth(urlA, urlB) {\n  return getUrlDepth(urlB) - getUrlDepth(urlA);\n}\n\nfunction findMatchedRoutes(url) {\n  var routes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  return routes.map(function (route) {\n    var _replaceDynamicURLPar = replaceDynamicURLParts(clean(route.route)),\n        regexp = _replaceDynamicURLPar.regexp,\n        paramNames = _replaceDynamicURLPar.paramNames;\n\n    var match = url.replace(/^\\/+/, '/').match(regexp);\n    var params = regExpResultToParams(match, paramNames);\n\n    return match ? { match: match, route: route, params: params } : false;\n  }).filter(function (m) {\n    return m;\n  });\n}\n\nfunction match(url, routes) {\n  return findMatchedRoutes(url, routes)[0] || false;\n}\n\nfunction root(url, routes) {\n  var matched = routes.map(function (route) {\n    return route.route === '' || route.route === '*' ? url : url.split(new RegExp(route.route + '($|\\/)'))[0];\n  });\n  var fallbackURL = clean(url);\n\n  if (matched.length > 1) {\n    return matched.reduce(function (result, url) {\n      if (result.length > url.length) result = url;\n      return result;\n    }, matched[0]);\n  } else if (matched.length === 1) {\n    return matched[0];\n  }\n  return fallbackURL;\n}\n\nfunction isHashChangeAPIAvailable() {\n  return typeof window !== 'undefined' && 'onhashchange' in window;\n}\n\nfunction extractGETParameters(url) {\n  return url.split(/\\?(.*)?$/).slice(1).join('');\n}\n\nfunction getOnlyURL(url, useHash, hash) {\n  var onlyURL = url,\n      split;\n  var cleanGETParam = function cleanGETParam(str) {\n    return str.split(/\\?(.*)?$/)[0];\n  };\n\n  if (typeof hash === 'undefined') {\n    // To preserve BC\n    hash = '#';\n  }\n\n  if (isPushStateAvailable() && !useHash) {\n    onlyURL = cleanGETParam(url).split(hash)[0];\n  } else {\n    split = url.split(hash);\n    onlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\n  }\n\n  return onlyURL;\n}\n\nfunction manageHooks(handler, hooks, params) {\n  if (hooks && (typeof hooks === 'undefined' ? 'undefined' : _typeof(hooks)) === 'object') {\n    if (hooks.before) {\n      hooks.before(function () {\n        var shouldRoute = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n        if (!shouldRoute) return;\n        handler();\n        hooks.after && hooks.after(params);\n      }, params);\n      return;\n    } else if (hooks.after) {\n      handler();\n      hooks.after && hooks.after(params);\n      return;\n    }\n  }\n  handler();\n}\n\nfunction isHashedRoot(url, useHash, hash) {\n  if (isPushStateAvailable() && !useHash) {\n    return false;\n  }\n\n  if (!url.match(hash)) {\n    return false;\n  }\n\n  var split = url.split(hash);\n\n  return split.length < 2 || split[1] === '';\n}\n\nNavigo.prototype = {\n  helpers: {\n    match: match,\n    root: root,\n    clean: clean,\n    getOnlyURL: getOnlyURL\n  },\n  navigate: function navigate(path, absolute) {\n    var to;\n\n    path = path || '';\n    if (this._usePushState) {\n      to = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\n      to = to.replace(/([^:])(\\/{2,})/g, '$1/');\n      history[this._historyAPIUpdateMethod]({}, '', to);\n      this.resolve();\n    } else if (typeof window !== 'undefined') {\n      path = path.replace(new RegExp('^' + this._hash), '');\n      window.location.href = window.location.href.replace(/#$/, '').replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\n    }\n    return this;\n  },\n  on: function on() {\n    var _this = this;\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (typeof args[0] === 'function') {\n      this._defaultHandler = { handler: args[0], hooks: args[1] };\n    } else if (args.length >= 2) {\n      if (args[0] === '/') {\n        var func = args[1];\n\n        if (_typeof(args[1]) === 'object') {\n          func = args[1].uses;\n        }\n\n        this._defaultHandler = { handler: func, hooks: args[2] };\n      } else {\n        this._add(args[0], args[1], args[2]);\n      }\n    } else if (_typeof(args[0]) === 'object') {\n      var orderedRoutes = Object.keys(args[0]).sort(compareUrlDepth);\n\n      orderedRoutes.forEach(function (route) {\n        _this.on(route, args[0][route]);\n      });\n    }\n    return this;\n  },\n  off: function off(handler) {\n    if (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\n      this._defaultHandler = null;\n    } else if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\n      this._notFoundHandler = null;\n    }\n    this._routes = this._routes.reduce(function (result, r) {\n      if (r.handler !== handler) result.push(r);\n      return result;\n    }, []);\n    return this;\n  },\n  notFound: function notFound(handler, hooks) {\n    this._notFoundHandler = { handler: handler, hooks: hooks };\n    return this;\n  },\n  resolve: function resolve(current) {\n    var _this2 = this;\n\n    var handler, m;\n    var url = (current || this._cLoc()).replace(this._getRoot(), '');\n\n    if (this._useHash) {\n      url = url.replace(new RegExp('^\\/' + this._hash), '/');\n    }\n\n    var GETParameters = extractGETParameters(current || this._cLoc());\n    var onlyURL = getOnlyURL(url, this._useHash, this._hash);\n\n    if (this._paused) return false;\n\n    if (this._lastRouteResolved && onlyURL === this._lastRouteResolved.url && GETParameters === this._lastRouteResolved.query) {\n      if (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\n        this._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\n      }\n      return false;\n    }\n\n    m = match(onlyURL, this._routes);\n\n    if (m) {\n      this._callLeave();\n      this._lastRouteResolved = {\n        url: onlyURL,\n        query: GETParameters,\n        hooks: m.route.hooks,\n        params: m.params,\n        name: m.route.name\n      };\n      handler = m.route.handler;\n      manageHooks(function () {\n        manageHooks(function () {\n          m.route.route instanceof RegExp ? handler.apply(undefined, m.match.slice(1, m.match.length)) : handler(m.params, GETParameters);\n        }, m.route.hooks, m.params, _this2._genericHooks);\n      }, this._genericHooks, m.params);\n      return m;\n    } else if (this._defaultHandler && (onlyURL === '' || onlyURL === '/' || onlyURL === this._hash || isHashedRoot(onlyURL, this._useHash, this._hash))) {\n      manageHooks(function () {\n        manageHooks(function () {\n          _this2._callLeave();\n          _this2._lastRouteResolved = { url: onlyURL, query: GETParameters, hooks: _this2._defaultHandler.hooks };\n          _this2._defaultHandler.handler(GETParameters);\n        }, _this2._defaultHandler.hooks);\n      }, this._genericHooks);\n      return true;\n    } else if (this._notFoundHandler) {\n      manageHooks(function () {\n        manageHooks(function () {\n          _this2._callLeave();\n          _this2._lastRouteResolved = { url: onlyURL, query: GETParameters, hooks: _this2._notFoundHandler.hooks };\n          _this2._notFoundHandler.handler(GETParameters);\n        }, _this2._notFoundHandler.hooks);\n      }, this._genericHooks);\n    }\n    return false;\n  },\n  destroy: function destroy() {\n    this._routes = [];\n    this._destroyed = true;\n    this._lastRouteResolved = null;\n    this._genericHooks = null;\n    clearTimeout(this._listeningInterval);\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('popstate', this._onLocationChange);\n      window.removeEventListener('hashchange', this._onLocationChange);\n    }\n  },\n  updatePageLinks: function updatePageLinks() {\n    var self = this;\n\n    if (typeof document === 'undefined') return;\n\n    this._findLinks().forEach(function (link) {\n      if (!link.hasListenerAttached) {\n        link.addEventListener('click', function (e) {\n          var location = self.getLinkPath(link);\n\n          if (!self._destroyed) {\n            e.preventDefault();\n            self.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\n          }\n        });\n        link.hasListenerAttached = true;\n      }\n    });\n  },\n  generate: function generate(name) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var result = this._routes.reduce(function (result, route) {\n      var key;\n\n      if (route.name === name) {\n        result = route.route;\n        for (key in data) {\n          result = result.toString().replace(':' + key, data[key]);\n        }\n      }\n      return result;\n    }, '');\n\n    return this._useHash ? this._hash + result : result;\n  },\n  link: function link(path) {\n    return this._getRoot() + path;\n  },\n  pause: function pause() {\n    var status = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n    this._paused = status;\n    if (status) {\n      this._historyAPIUpdateMethod = 'replaceState';\n    } else {\n      this._historyAPIUpdateMethod = 'pushState';\n    }\n  },\n  resume: function resume() {\n    this.pause(false);\n  },\n  historyAPIUpdateMethod: function historyAPIUpdateMethod(value) {\n    if (typeof value === 'undefined') return this._historyAPIUpdateMethod;\n    this._historyAPIUpdateMethod = value;\n    return value;\n  },\n  disableIfAPINotAvailable: function disableIfAPINotAvailable() {\n    if (!isPushStateAvailable()) {\n      this.destroy();\n    }\n  },\n  lastRouteResolved: function lastRouteResolved() {\n    return this._lastRouteResolved;\n  },\n  getLinkPath: function getLinkPath(link) {\n    return link.getAttribute('href');\n  },\n  hooks: function hooks(_hooks) {\n    this._genericHooks = _hooks;\n  },\n\n  _add: function _add(route) {\n    var handler = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var hooks = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    if (typeof route === 'string') {\n      route = encodeURI(route);\n    }\n    this._routes.push((typeof handler === 'undefined' ? 'undefined' : _typeof(handler)) === 'object' ? {\n      route: route,\n      handler: handler.uses,\n      name: handler.as,\n      hooks: hooks || handler.hooks\n    } : { route: route, handler: handler, hooks: hooks });\n\n    return this._add;\n  },\n  _getRoot: function _getRoot() {\n    if (this.root !== null) return this.root;\n    this.root = root(this._cLoc().split('?')[0], this._routes);\n    return this.root;\n  },\n  _listen: function _listen() {\n    var _this3 = this;\n\n    if (this._usePushState) {\n      window.addEventListener('popstate', this._onLocationChange);\n    } else if (isHashChangeAPIAvailable()) {\n      window.addEventListener('hashchange', this._onLocationChange);\n    } else {\n      var cached = this._cLoc(),\n          current = void 0,\n          _check = void 0;\n\n      _check = function check() {\n        current = _this3._cLoc();\n        if (cached !== current) {\n          cached = current;\n          _this3.resolve();\n        }\n        _this3._listeningInterval = setTimeout(_check, 200);\n      };\n      _check();\n    }\n  },\n  _cLoc: function _cLoc() {\n    if (typeof window !== 'undefined') {\n      if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\n        return window.__NAVIGO_WINDOW_LOCATION_MOCK__;\n      }\n      return clean(window.location.href);\n    }\n    return '';\n  },\n  _findLinks: function _findLinks() {\n    return [].slice.call(document.querySelectorAll('[data-navigo]'));\n  },\n  _onLocationChange: function _onLocationChange() {\n    this.resolve();\n  },\n  _callLeave: function _callLeave() {\n    var lastRouteResolved = this._lastRouteResolved;\n\n    if (lastRouteResolved && lastRouteResolved.hooks && lastRouteResolved.hooks.leave) {\n      lastRouteResolved.hooks.leave(lastRouteResolved.params);\n    }\n  }\n};\n\nNavigo.PARAMETER_REGEXP = /([:*])(\\w+)/g;\nNavigo.WILDCARD_REGEXP = /\\*/g;\nNavigo.REPLACE_VARIABLE_REGEXP = '([^\\/]+)';\nNavigo.REPLACE_WILDCARD = '(?:.*)';\nNavigo.FOLLOWED_BY_SLASH_REGEXP = '(?:\\/$|$)';\nNavigo.MATCH_REGEXP_FLAGS = '';\n\nreturn Navigo;\n\n})));\n","{\r\n\tlet root = null;\r\n\tvnjs.router = new Navigo(root, true, '#!');\r\n};\r\n\r\nvnjs.router\r\n  .on(()=>console.log('############ vnjson.js #############'))\r\n\r\n  .on('/:scene', function(params){\r\n  \tlet { scene } = params;\r\n    console.warn([scene].join('|'))\r\n  })\r\n  .on('/:scene/:label', function(params){\r\n  \tlet { scene, label } = params;\r\n    console.warn([scene,label].join('|'))\r\n  })\r\n  .on('/:scene/:label/:index', function (params) {\r\n//router.navigate('/products/list');\r\n    let { scene, label, index } = params;\r\n    console.warn([scene,label, index].join('|'))\r\n  })\r\n  .notFound(function(){\r\n  \tconsole.warn('Маршрута не существует')\r\n  })\r\n  .resolve();\r\n\r\n\r\n","/**\r\n\r\n\r\n\r\nПлагины\r\nget-screens\r\n &\r\nscreen-show\r\nобъеденить в один ->screen\r\n\r\n* Так же можно было бы объеденить jump и getScenes\r\n*\r\n*/\r\nfunction getRealDisplay(elem) {\r\n\tif (elem.currentStyle) {\r\n\t\treturn elem.currentStyle.display\r\n\t} else if (window.getComputedStyle) {\r\n\t\tvar computedStyle = window.getComputedStyle(elem, null )\r\n\r\n\t\treturn computedStyle.getPropertyValue('display')\r\n\t}\r\n}\r\n\r\nfunction hide(el) {\r\n\tif (!el.getAttribute('displayOld')) {\r\n\t\tel.setAttribute(\"displayOld\", el.style.display)\r\n\t}\r\n\r\n\tel.style.display = \"none\"\r\n}\r\n\r\ndisplayCache = {}\r\n\r\nfunction isHidden(el) {\r\n\tvar width = el.offsetWidth, height = el.offsetHeight,\r\n\t\ttr = el.nodeName.toLowerCase() === \"tr\"\r\n\r\n\treturn width === 0 && height === 0 && !tr ?\r\n\t\ttrue : width > 0 && height > 0 && !tr ? false :\tgetRealDisplay(el)\r\n}\r\n\r\nfunction toggle(el) {\r\n\tisHidden(el) ? show(el) : hide(el)\r\n}\r\n\r\n\r\nfunction show(el) {\r\n\r\n\tif (getRealDisplay(el) != 'none') return\r\n\r\n\tvar old = el.getAttribute(\"displayOld\");\r\n\tel.style.display = old || \"\";\r\n\r\n\tif ( getRealDisplay(el) === \"none\" ) {\r\n\t\tvar nodeName = el.nodeName, body = document.body, display\r\n\r\n\t\tif ( displayCache[nodeName] ) {\r\n\t\t\tdisplay = displayCache[nodeName]\r\n\t\t} else {\r\n\t\t\tvar testElem = document.createElement(nodeName)\r\n\t\t\tbody.appendChild(testElem)\r\n\t\t\tdisplay = getRealDisplay(testElem)\r\n\r\n\t\t\tif (display === \"none\" ) {\r\n\t\t\t\tdisplay = \"block\"\r\n\t\t\t}\r\n\r\n\t\t\tbody.removeChild(testElem)\r\n\t\t\tdisplayCache[nodeName] = display\r\n\t\t}\r\n\r\n\t\tel.setAttribute('displayOld', display)\r\n\t\tel.style.display = display\r\n\t}\r\n}\r\n\r\n\r\nvnjs.on('screen', function(id){\r\n\tthis.emit(id);\r\n\t//console.log(id);\r\n vnjs.prevScreen = null;\r\n      /* Если если это первая сцена, то предыдущей нет*/\r\n if(this.prevScreen!== null){\r\n      hide(this.prevScreen)\r\n }\r\n\r\n\t//prefix\r\n\t//show.id\r\n\t//hide.pref.screen\r\n\t//push.state.screens\r\n\tshow(document.getElementById(id))\r\n})","\r\nvnjs.on('audio', function(data){\r\n  if(typeof data === 'string'){\r\n       vnjs.audio[data].play(); \r\n\r\n  }else if(typeof data === 'object'){\r\n      vnjs.audio[data.id][data.action]();\r\n     // vnjs.audio[data.id].loop = data.loop;\r\n  }else{\r\n    console.error('incorect data type');\r\n  }\r\n\r\n\r\n});","/* @events\r\n    * preload\r\n    * load\r\n    * postload\r\n */\r\n\r\nvnjs.on('load', function(assets){\r\n  const { DEBUG, emit } = this;\r\n\r\n\r\nvar persent = 100/assets.length;\r\nvar PROGREESS = 0;\r\nvar i = 0;\r\nfor(let asset of assets){\r\n \r\nvar position = [ i+=1, '/', assets.length ].join(\"\");\r\n\r\nlet progress = Math.round(PROGREESS+=persent)+\"%\";\r\n\r\n\r\n  if(asset.type===\"image\"){\r\n       let img = new Image();\r\n           img.src = asset.path;\r\n           img.onload = function(){\r\n                 emit('imageLoad', asset);\r\n           };\r\n  }\r\n  else if(asset.type===\"audio\"){\r\n       let audio = new Audio();\r\n           audio.addEventListener('canplaythrough', ()=>{\r\n                  emit('audioLoad', asset);\r\n           }, false);\r\n          audio.src = asset.path;\r\n        vnjs.audio[asset.id] = audio; \r\n  }\r\n  else{\r\n    console.error('asset type incorect');\r\n    break;\r\n  }\r\nlet data = Object.assign(asset, {progress, position});\r\n                  emit('asset', data);\r\n};\r\n\r\n{\r\n  DEBUG&&console.info('LOADING...');\r\n};\r\n\r\n\r\n  emit('postload');\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}