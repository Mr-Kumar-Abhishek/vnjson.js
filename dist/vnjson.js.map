{"version":3,"sources":["vnjson.js","plugins/get-screens.js","plugins/jump.js","plugins/screen-show.js","plugins/vnjson-audio.js","plugins/vnjson-preload.js"],"names":["vnjs","plugins","TREE","DEBUG","playList","prevAudio","prevScreen","screenList","conf","prefix","element","gameDir","scenesDir","local","entryPoint","screenClass","on","event","handler","push","emit","args","Array","isArray","map","call","off","state","scene","label","index","screen","data","current","object","document","getElementById","setScene","name","body","characters","aliase","Object","keys","character","reply","param","assets","parse","obj","ctx","next","init","assign","jump","progressSave","id","serialState","JSON","stringify","localStorage","setItem","progressLoad","getItem","join","progressDelete","log","error","console","msg","e","info","fetchCss","filename","l","createElement","rel","href","h","getElementsByTagName","appendChild","uriHtml","uriCss","gameRoot","querySelector","fetch","then","r","text","innerHTML","screens","screensNodeList","querySelectorAll","forEach","styles","display","width","height","style","setAttribute","pathname","getScene","sceneName","labelName","uri","json","sceneBody","isScene","pathName","arr","split","length","isNaN","warn","isLabel","getRealDisplay","elem","currentStyle","window","getComputedStyle","computedStyle","getPropertyValue","hide","el","getAttribute","displayCache","isHidden","offsetWidth","offsetHeight","tr","nodeName","toLowerCase","show","old","testElem","removeChild","pscreen","pause","play","action","persent","PROGREESS","i","asset","position","progress","Math","round","type","img","Image","src","path","onload","audio","Audio","addEventListener"],"mappings":"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","file":"vnjson.js","sourcesContent":["\r\nvar vnjs = {\r\n  \r\n      plugins: {},\r\n      TREE: {},\r\n      DEBUG: false,\r\n      playList: {},\r\n      prevAudio: \"\",\r\n      prevScreen: \"\",\r\n      screenList: {}\r\n};\r\n\r\nvnjs.conf = {\r\n      prefix: '',\r\n      element: '.gameElement',\r\n      gameDir: './game',\r\n      scenesDir: \"scenes\",\r\n      local: 'en-US',\r\n      entryPoint: 'entry/point',\r\n      screenClass: '.screen'\r\n};\r\n\r\nvnjs.on = function(event, handler){\r\n          if (!vnjs.plugins[event]) {\r\n              vnjs.plugins[event] = [];\r\n          };\r\n          vnjs.plugins[event].push(handler);\r\n};\r\n\r\nvnjs.emit = function (event, ...args) {\r\n         if (Array.isArray(vnjs.plugins[event])) {\r\n            vnjs.plugins[event].map(function(handler){\r\n                    handler.call(vnjs, ...args);\r\n            });\r\n         }\r\n         /*\r\n         else{\r\n          Выводятся системные слушатели\r\n          console.log(`Event [ ${event} ] not found`)\r\n         }\r\n         */\r\n};\r\nvnjs.off = function (event) {\r\n        delete vnjs.plugins[event];\r\n};\r\n\r\n/*\r\n * В {state} должно помещаться все то\r\n * что сохроняется в карту памяти\r\n * И что важно загрузить из нее без последствий.\r\n * В состоянии не должно быть мусора\r\n */\r\n\r\nvnjs.state = {\r\n  scene: 'scene',\r\n  label: 'label',\r\n  index: 0,\r\n  screen: \"\", //current screen\r\n  data: {}, //userData\r\n};\r\n\r\n\r\n/*\r\n * Получает текущее тела из состояние\r\n */\r\nvnjs.current = {\r\n  \r\n      scene: function (){\r\n        return vnjs.TREE[vnjs.state.scene];\r\n      },\r\n      label: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label];\r\n      },\r\n      object: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label][vnjs.state.index];\r\n      },\r\n      screen: function(){\r\n        //> DOM<\r\n        return document.getElementById(`${vnjs.conf.prefix}${vnjs.state.screen}`)\r\n      }\r\n};\r\n\r\n\r\nvnjs.setScene = function (name, body){\r\n  this.TREE[name] = body;\r\n  this.state.scene = name;\r\n\r\n  body.characters.map(character=>{\r\n    let aliase = Object.keys(character)[0];\r\n\r\n    vnjs.on(aliase, function(reply){\r\n          vnjs.emit('character', {aliase, param: character[aliase], reply } );\r\n\r\n    });\r\n\r\n});\r\n  this.emit('load', body.assets);\r\n \r\n};\r\n\r\n\r\n\r\n\r\nvnjs.parse = function (obj){\r\n  var ctx = null;\r\n  if(obj){\r\n    ctx = obj;\r\n  }else{\r\n    ctx = vnjs.current.object();\r\n  };\r\n\r\n  for(let event in ctx){\r\n\r\n        vnjs.emit(event, ctx[event]);\r\n\r\n  };\r\n  this.emit('parse', ctx)\r\n};\r\n\r\n\r\nvnjs.next = function (){\r\n  this.parse();\r\n  this.state.index++;\r\n  this.emit('next', this.state.index)\r\n  return '-------------------------';\r\n};\r\n\r\n\r\nvnjs.init = function (conf){\r\n  Object.assign(vnjs.conf, conf);\r\n  this.emit('getScreens')\r\n  this.on('screensLoaded', ()=>{\r\n   \r\n     this.parse( { jump: conf.entryPoint } )\r\n  })\r\n  this.emit('init')\r\n  return true;\r\n};\r\n\r\n\r\nvnjs.progressSave = function(id='default'){\r\n  let { conf } = this;\r\nlet serialState = JSON.stringify(this.state); \r\n    localStorage.setItem(conf.prefix+id, serialState); \r\n    this.emit('progressSave', { id })\r\n};\r\n\r\nvnjs.progressLoad = function(id='default'){\r\n  let { conf } = this;\r\n  let { screen, scene, label, index } = this.state;\r\n  vnjs.state = JSON.parse(localStorage.getItem(conf.prefix+id));\r\n\r\n  this.emit('progressLoad', { id });\r\n  this.parse({ screen })\r\n  this.parse({\r\n      jump: [ scene, label, index].join('/')\r\n    })\r\n}\r\n\r\nvnjs.progressDelete = function(id){\r\n  let { conf } = this;\r\n  delete localStorage[conf.prefix+id];\r\n  this.emit('progressDelete', { id });\r\n};\r\n\r\n\r\n\r\nvnjs.log = {\r\n  error: msg=>{\r\n    console.log(`%c Error %c ${msg}`, \"color: white; background: red; font-size:12px;\", \"color: red; font-size:12px;\");\r\n  },\r\n  /*\r\n  scene: (scene, label)=>{\r\n    console.log(`%c ${scene} %c ${label}`, \"color: #C9DAE4; background: #A0BACB; font-size:12px;\", \"background: #C9DAE4; color: #A0BACB; font-size:12px;\");\r\n  },*/\r\n  event: (e, msg=\"\")=>{\r\n    console.log(`%c ${e} %c ${msg} `, \"color: #C9DAE4; background: #A0BACB; font-size:12px;\", \"background: #C9DAE4; color: #A0BACB; font-size:12px;\");\r\n  },\r\n  //#A0BACB\r\n  index: _=>{\r\n    console.log(`%c vnjson.js %c v0.9.3`, \"color: #C9DAE4; background: #A0BACB; font-size:12px;\", \"background: #C9DAE4; color: #A0BACB; font-size:12px;\");\r\n  },\r\n  info: data=>{\r\n    console.log(`%c ${data}`, \"color: #A0BACB; background: #ffffff; font-size:12px;\")\r\n  }\r\n}\r\n\r\n\r\n\r\nvnjs.log.index();\r\n","vnjs.on('getScreens', function(){\r\n\r\nconst { conf, DEBUG, emit } = this;\r\n\r\nfunction fetchCss(filename) {\r\n    var l = document.createElement('link');\r\n    l.rel = 'stylesheet';\r\n    l.href = filename\r\n    var h = document.getElementsByTagName('head')[0];\r\n    h.appendChild(l);\r\n};\r\n\r\n\r\n\r\n\t\r\n\tlet uriHtml = `${conf.gameDir}/screens.html`;\r\n\tlet uriCss = `${conf.gameDir}/screens.css`;\r\n\tlet gameRoot = document.querySelector(conf.element);\r\n\tfetch(uriHtml)\r\n\t\t.then(r=>r.text())\r\n\t\t\r\n\t\t.then(screens=>{\r\n\t\t\tfetchCss(uriCss);\r\n\t\t\tgameRoot.innerHTML = screens;\r\n\t\t})\r\n\t\t.then(()=>{\r\n\t\t\tlet screensNodeList = document.querySelectorAll(conf.screenClass);\r\n            screensNodeList.forEach((screen)=>{\r\n\r\n             let styles = {\r\n                    display: 'none',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                  };\r\n             Object.assign(screen.style, styles);\r\n\r\n             /*Код кантораЮ необходимо для работы 'Правильлного show/hide'*/\r\n\t\t\tscreen.setAttribute(\"displayOld\", screen.style.display)\r\n             \r\n\r\n            vnjs.screenList[screen.id] = screen;\r\n            \r\n         //   DEBUG&&console.log(screen);\r\n            \r\n            });\r\n\r\n          emit('screensLoaded')\r\n\t\t})\r\n\t\t//.catch(function(error) { console.error(error); })\r\n\t\t\r\n})","vnjs.on('jump', function(pathname){\r\n\r\n\r\n\r\nconst { parse,  emit, DEBUG, conf, setScene } = this;\r\n\r\nfunction getScene(sceneName, labelName){\r\n\r\n\r\n  let uri = `${conf.gameDir}/${conf.scenesDir}/${conf.local}/${sceneName}.json`;\r\n  emit('preload', { sceneName, labelName });\r\n  fetch(uri)\r\n  .then(r=>r.json())\r\n  .then(sceneBody=>{\r\n\r\n\r\n    vnjs.setScene(sceneName, sceneBody);\r\n\r\n  });\r\n/*\r\n\r\nsetScene(\"*\", sceneBody);\r\n\r\nstate.label = \"mainMenu\";\r\n\r\nnext();\r\n*/\r\n\r\n}\r\n\r\n\r\nfunction isScene(pathName){\r\n  var arr = pathName.split('/');\r\n  /*\r\n      scene/label/index\r\n  */\r\n  if(arr.length===3){\r\n    if( isNaN(+arr[2]) ){\r\n      console.warn('scene/label/index')\r\n      console.warn('Index should be a Number');\r\n      vnjs.state.index = 0;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n  /*\r\n      scene/label\r\n  */\r\n  else if(arr.length===2){\r\n    var isLabel = false;\r\n     /*  scene/label  */\r\n    if( isNaN(+arr[1]) ){\r\n      isLabel = true;\r\n    }\r\n    /*  label/index  */\r\n    else {\r\n      isLabel = false;\r\n    }\r\n   \r\n    return isLabel;\r\n  }\r\n \r\n};\r\n\r\n  var arr = pathname.split('/');\r\n\r\nif(isScene(pathname)){\r\n\r\n\r\n    // set state\r\n    vnjs.state.scene = arr[0];\r\n    vnjs.state.label = arr[1];\r\n    vnjs.state.index = arr[2]||0;\r\n   getScene(vnjs.state.scene, vnjs.state.label);\r\n\r\n\r\n\r\n}else{\r\n \r\n\t // set state\r\n   // vnjs.state.scene = vnjs.state.scene;\r\n    vnjs.state.label = arr[0];\r\n    vnjs.state.index = arr[1]||0;\r\n\r\n   parse();\r\n}\r\n\r\n\r\n\r\n});\r\n\r\n\r\n","/**\r\n\r\n\r\n\r\nПлагины\r\nget-screens\r\n &\r\nscreen-show\r\nобъеденить в один ->screen\r\n\r\n* Так же можно было бы объеденить jump и getScenes\r\n*\r\n*/\r\nfunction getRealDisplay(elem) {\r\n\tif (elem.currentStyle) {\r\n\t\treturn elem.currentStyle.display\r\n\t} else if (window.getComputedStyle) {\r\n\t\tvar computedStyle = window.getComputedStyle(elem, null )\r\n\r\n\t\treturn computedStyle.getPropertyValue('display')\r\n\t}\r\n}\r\n\r\nfunction hide(el) {\r\n\tif (!el.getAttribute('displayOld')) {\r\n\t\tel.setAttribute(\"displayOld\", el.style.display)\r\n\t}\r\n\r\n\tel.style.display = \"none\"\r\n}\r\n\r\ndisplayCache = {}\r\n\r\nfunction isHidden(el) {\r\n\tvar width = el.offsetWidth, height = el.offsetHeight,\r\n\t\ttr = el.nodeName.toLowerCase() === \"tr\"\r\n\r\n\treturn width === 0 && height === 0 && !tr ?\r\n\t\ttrue : width > 0 && height > 0 && !tr ? false :\tgetRealDisplay(el)\r\n}\r\n\r\n\r\n\r\nfunction show(el) {\r\n\r\n\tif (getRealDisplay(el) != 'none') return\r\n\r\n\tvar old = el.getAttribute(\"displayOld\");\r\n\tel.style.display = old || \"\";\r\n\r\n\tif ( getRealDisplay(el) === \"none\" ) {\r\n\t\tvar nodeName = el.nodeName, body = document.body, display\r\n\r\n\t\tif ( displayCache[nodeName] ) {\r\n\t\t\tdisplay = displayCache[nodeName]\r\n\t\t} else {\r\n\t\t\tvar testElem = document.createElement(nodeName)\r\n\t\t\tbody.appendChild(testElem)\r\n\t\t\tdisplay = getRealDisplay(testElem)\r\n\r\n\t\t\tif (display === \"none\" ) {\r\n\t\t\t\tdisplay = \"block\"\r\n\t\t\t}\r\n\r\n\t\t\tbody.removeChild(testElem)\r\n\t\t\tdisplayCache[nodeName] = display\r\n\t\t}\r\n\r\n\t\tel.setAttribute('displayOld', display)\r\n\t\tel.style.display = display\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\nvnjs.on('screen', function(id){\r\n\tthis.emit(id, vnjs.screenList[id]);\r\n\r\n\r\n if(vnjs.prevScreen!=\"\"){\r\n \t\t\t\tlet pscreen = vnjs.screenList[vnjs.prevScreen];\r\n         hide(pscreen);\r\n        \r\n }\r\n\r\n vnjs.prevScreen = id;\r\n\t//prefix\r\n\t//show.id\r\n\t//hide.pref.screen\r\n\t//push.state.screens\r\nvnjs.state.screen = id;\r\n\tshow(vnjs.screenList[id])\r\n})","\r\n\r\nvnjs.on('audio', function(data){\r\n\r\n\r\n\r\n  if(typeof data === 'string'){\r\n      \r\n       if(vnjs.prevAudio!=\"\"){\r\n         vnjs.playList[vnjs.prevAudio].pause();\r\n       }\r\n       vnjs.playList[data].play(); \r\n       vnjs.prevAudio = data;\r\n\r\n  }else if(typeof data === 'object'){\r\n\r\n      if(vnjs.prevAudio!=\"\"){\r\n          vnjs.playList[vnjs.prevAudio].pause();\r\n       }\r\n\r\n      vnjs.playList[data.id][data.action]();\r\n    \r\n       vnjs.prevAudio = data.id;\r\n     // vnjs.audio[data.id].loop = data.loop;\r\n  }else{\r\n    console.error('incorect data type');\r\n  }\r\n//var sound = self.playlist[self.index].howl;\r\n\r\n});","/* @events\r\n    * preload\r\n    * load\r\n    * postload\r\n */\r\n\r\nvnjs.on('load', function(assets){\r\n  const { DEBUG, emit } = this;\r\n\r\n\r\nvar persent = 100/assets.length;\r\nvar PROGREESS = 0;\r\nvar i = 0;\r\nfor(let asset of assets){\r\n \r\nvar position = [ i+=1, '/', assets.length ].join(\"\");\r\n\r\nlet progress = Math.round(PROGREESS+=persent)+\"%\";\r\n\r\n\r\n  if(asset.type===\"image\"){\r\n       let img = new Image();\r\n           img.src = asset.path;\r\n           img.onload = function(){\r\n                 emit('imageLoad', asset);\r\n           };\r\n  }\r\n  else if(asset.type===\"audio\"){\r\n       let audio = new Audio();\r\n           audio.addEventListener('canplaythrough', ()=>{\r\n                  emit('audioLoad', asset);\r\n           }, false);\r\n          audio.src = asset.path;\r\n        vnjs.playList[asset.id] = audio; \r\n  }\r\n  else{\r\n    console.error('Incorect asset type');\r\n    break;\r\n  }\r\nlet data = Object.assign(asset, {progress, position});\r\n                  emit('asset', data);\r\n};\r\n\r\n  emit('postload');\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}