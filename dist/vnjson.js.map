{"version":3,"sources":["webpack:///webpack/bootstrap ff34fe17ab05fc5640f7?553d","webpack:///./src/vnjson.js?caa5"],"names":["game","init","scenes","characters","ctx","scene","label","arr","obj","num","config","ev","Events","emit","param","call","vnjs","getScreen","fileName","callback","marmottajax","success","html","on","event","handler","getScene","pathToScene","local","name","msg","url","json","data","_SCENE","Object","assign","labels","parse","_obj","key","length","character","reply","aliase","next","prev"],"mappings":"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","file":"dist/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap ff34fe17ab05fc5640f7\n **/","/**\r\n * @deps [ marmottajax.js]\r\n *       [ minivents.js]\r\n         [ smart-observer.js]\r\n */\r\nvar game = {\r\n    init: {},\r\n    scenes: {},\r\n    characters: {},\r\n    //choices: {},\r\n};\r\n\r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  scene:'scene',\r\n  label:'label',\r\n  arr: [],\r\n  obj: null,\r\n  num: 0,\r\n};\r\n/*\r\n * \r\n */\r\n\r\nvar config = {};\r\n\r\nvar ev = new Events();//EventEmitter\r\nvar { emit } = ev;\r\n/**\r\n * init\r\n */\r\nfunction init(param){\r\n  \r\n  config = param;\r\n  emit.call(vnjs, 'init');\r\n\r\n \r\n};\r\n\r\nfunction getScreen(fileName, callback){\r\n    marmottajax(`/game/screens/${fileName}`).success(function(html) {\r\n      callback(html);\r\n  })\r\n}\r\n\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\n\r\n\r\n\r\nfunction on(event, handler){\r\n\r\n  if(typeof event===\"function\"){\r\n      ev.on('autorun', event, vnjs);\r\n  }else if(typeof event===\"string\"){\r\n      ev.on(event, handler, vnjs);\r\n  }\r\n\r\n};\r\n\r\n\r\n\r\n\r\n/*\r\n * getScene\r\n */\r\n\r\nfunction getScene(scene){\r\n//window.location.href = config.basename;\r\nconst pathToScene = `/game/${config.scenes}/${config.local}/${scene}.json`;\r\n/*\r\n * Излучаю событие preload что бы было можно повесить\r\n * идикатор загрузки на css\r\n */\r\nemit('preload', {name:'preload', msg:'${scene} start loading!'})\r\nmarmottajax({\r\n    url: pathToScene,\r\n    json: true\r\n}).success(function(data) {\r\n    /*\r\n     * Назначаем полученные данные сцены в\r\n     * игровые объекты.\r\n     * А так же объекты внутреннего назначения\r\n     */\r\n    game.scenes[ctx.scene] = data;\r\n\r\n    const _SCENE = game.scenes[ctx.scene];\r\n    /*\r\n     * Добавляю персонажей в каждой загруженной сцены\r\n     * в общий пулл.\r\n     */\r\n    game.characters = Object.assign(game.characters, _SCENE.characters);\r\n    /*\r\n     * Дублирую текущие значения в контекст\r\n     */\r\n    ctx.arr = _SCENE.labels[ctx.label];\r\n    //ctx.assets = game.scenes[ctx.scene].assets;\r\n\r\n    emit('loaded', {name:'load', msg:'${scene} is loaded!'})\r\n });\r\n\r\n};\r\n\r\nfunction parse(_obj){\r\n\r\n  if(_obj){\r\n      ctx.obj = _obj;\r\n  }else{\r\n     ctx.obj = ctx.arr[ctx.num];\r\n  }\r\n  /** Текущий объект */\r\n    //ctx.obj = ctx.arr[ctx.num];\r\n  /*if(ctx.arr.length===ctx.num){\r\n    ctx.num===ctx.num;\r\n      ev.emit('complete');\r\n  }*/\r\n\r\n  for(let key in ctx.obj){\r\n      /*\r\n       * Алиас персонажа содержит не больше трех (3)\r\n       * символов. \r\n       */\r\n      if(key.length<=3){\r\n             let character = game.characters[key];\r\n            \r\n              let reply = ctx.obj[key]; \r\n              emit('alias', {\r\n                   character,\r\n                   reply,\r\n                   aliase: key\r\n                 });\r\n             \r\n\r\n      }else{\r\n        /*\r\n         * vnjs.on('alert')\r\n         * Подписывает пользовательские плагины\r\n         * \r\n         */\r\n        ev.emit(key, ctx.obj[key]);\r\n      }\r\n  }\r\n  emit('parse', ctx.obj);\r\n};\r\n\r\n\r\n\r\nfunction next(){\r\n  \r\n  parse();\r\n  ctx.num+=1;\r\n  emit('next', {name: 'next'});\r\n};\r\nfunction prev(){\r\n \r\n  parse();\r\n  ctx.num-=1;\r\n  emit('prev', {name: 'prev'});\r\n};\r\n\r\n\r\n/*\r\n * @api\r\n * @version 0.5.7\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  init,\r\n  game,\r\n  getScene,\r\n  getScreen,\r\n  config,\r\n  next,\r\n  prev,\r\n  parse,\r\n  emit\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/"],"sourceRoot":""}