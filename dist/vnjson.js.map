{"version":3,"sources":["webpack:///webpack/bootstrap 98975f13af5dfd138a1f?59e1","webpack:///./src/vnjson.js?caa5"],"names":["game","init","scenes","characters","ctx","scene","label","arr","obj","num","utils","config","ev","Events","param","marmottajax","success","body","document","getElementById","innerHTML","emit","name","call","vnjs","entry","on","event","handler","getScene","pathToScene","local","msg","url","json","data","_SCENE","Object","assign","labels","parse","key","length","character","reply","aliase","next","prev"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;ACtCA;;;;;AAKA,KAAIA,OAAO;AACPC,SAAM,EADC;AAEPC,WAAQ,EAFD;AAGPC,eAAY;AAHL,EAAX;;AAMA;;;;AAIA,KAAIC,MAAM;AACRC,UAAM,OADE;AAERC,UAAM,OAFE;AAGRC,QAAK,EAHG;AAIRC,QAAK,IAJG;AAKRC,QAAK;AALG,EAAV;AAOA;;;AAGA,KAAIC,QAAQ,EAAZ;AACA,KAAIC,SAAS,EAAb;AACA,KAAIC,KAAK,IAAIC,MAAJ,EAAT,C,CAAsB;AACtB;;;AAGA,UAASZ,IAAT,CAAca,KAAd,EAAoB;;AAElB,WA6IAH,MA7IA,YAASG,KAAT;AACF;;;AAGAC,eAAY,mBAAZ,EAAiCC,OAAjC,CAAyC,UAASC,IAAT,EAAe;AACpDC,cAASC,cAAT,CAAwB,MAAxB,EAAgCC,SAAhC,GAA4CH,IAA5C;AACA;;;AAGAL,QAAGS,IAAH,CAAQ,SAAR,EAAmB,EAACC,MAAM,SAAP,EAAnB;AACA;;;;;;AAMAV,QAAGS,IAAH,CAAQE,IAAR,CAAaC,IAAb,EAAmB,MAAnB,EAA2Bb,OAAOc,KAAlC;AACH,IAbD;AAeC;;AAID;;;;;AAOA,UAASC,EAAT,CAAYC,KAAZ,EAAmBC,OAAnB,EAA2B;;AAEzB,OAAG,OAAOD,KAAP,KAAe,UAAlB,EAA6B;AACzBf,QAAGc,EAAH,CAAM,SAAN,EAAiBC,KAAjB,EAAwBH,IAAxB;AACH,IAFD,MAEM,IAAG,OAAOG,KAAP,KAAe,QAAlB,EAA2B;AAC7Bf,QAAGc,EAAH,CAAMC,KAAN,EAAaC,OAAb,EAAsBJ,IAAtB;AACH;AAEF;;AAKD;;;;AAIA,UAASK,QAAT,CAAkBxB,KAAlB,EAAwB;;AAExB,OAAMyB,wBAAsBnB,OAAOT,MAA7B,SAAuCS,OAAOoB,KAA9C,SAAuD1B,KAAvD,UAAN;AACA;;;;AAIAO,MAAGS,IAAH,CAAQ,SAAR,EAAmB,EAACC,MAAK,SAAN,EAAiBU,KAAI,yBAArB,EAAnB;AACAjB,eAAY;AACRkB,UAAKH,WADG;AAERI,WAAM;AAFE,IAAZ,EAGGlB,OAHH,CAGW,UAASmB,IAAT,EAAe;AACtB;;;;;AAKAnC,UAAKE,MAAL,CAAYE,IAAIC,KAAhB,IAAyB8B,IAAzB;;AAEA,SAAMC,SAASpC,KAAKE,MAAL,CAAYE,IAAIC,KAAhB,CAAf;AACA;;;;AAIAL,UAAKG,UAAL,GAAkBkC,OAAOC,MAAP,CAActC,KAAKG,UAAnB,EAA+BiC,OAAOjC,UAAtC,CAAlB;AACA;;;AAGAC,SAAIG,GAAJ,GAAU6B,OAAOG,MAAP,CAAcnC,IAAIE,KAAlB,CAAV;AACA;;AAEAM,QAAGS,IAAH,CAAQ,QAAR,EAAkB,EAACC,MAAK,MAAN,EAAcU,KAAI,qBAAlB,EAAlB;AACF,IAxBF;AA0BC;;AAED,UAASQ,KAAT,GAAgB;AACb;AACDpC,OAAII,GAAJ,GAAUJ,IAAIG,GAAJ,CAAQH,IAAIK,GAAZ,CAAV;;AAEA;;;;;;;AAQA,QAAI,IAAIgC,GAAR,IAAerC,IAAII,GAAnB,EAAuB;;AAEnB,SAAGiC,IAAIC,MAAJ,IAAY,CAAf,EAAiB;AACV,WAAIC,YAAY3C,KAAKG,UAAL,CAAgBsC,GAAhB,CAAhB;;AAEC,WAAIG,QAAQxC,IAAII,GAAJ,CAAQiC,GAAR,CAAZ;AACA7B,UAAGS,IAAH,CAAQ,OAAR,EAAiB;AACZsB,6BADY;AAEZC,qBAFY;AAGZC,iBAAQJ;AAHI,QAAjB;AAOP,MAXD,MAWK;AACH7B,UAAGS,IAAH,CAAQoB,GAAR,EAAarC,IAAII,GAAJ,CAAQiC,GAAR,CAAb;AACD;AACJ;AAEF;;AAID,UAASK,IAAT,GAAe;;AAEbN;AACApC,OAAIK,GAAJ,IAAS,CAAT;AACAG,MAAGS,IAAH,CAAQ,MAAR,EAAgB,EAACC,MAAM,MAAP,EAAhB;AACD;AACD,UAASyB,IAAT,GAAe;;AAEbP;AACApC,OAAIK,GAAJ,IAAS,CAAT;AACAG,MAAGS,IAAH,CAAQ,MAAR,EAAgB,EAACC,MAAM,MAAP,EAAhB;AACD;;AAGD;;;;SAKEI,E,GAAAA,E;SACAtB,G,GAAAA,G;SACAH,I,GAAAA,I;SACAD,I,GAAAA,I;SACA6B,Q,GAAAA,Q;SACAlB,M,GAAAA,M;SACAD,K,GAAAA,K;SACAoC,I,GAAAA,I;SACAC,I,GAAAA,I;SACAP,K,GAAAA,K","file":"dist/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 98975f13af5dfd138a1f\n **/","/**\r\n * @deps [ marmottajax.js]\r\n *       [ minivents.js]\r\n         [ smart-observer.js]\r\n */\r\nvar game = {\r\n    init: {},\r\n    scenes: {},\r\n    characters: {}\r\n};\r\n\r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  scene:'scene',\r\n  label:'label',\r\n  arr: [],\r\n  obj: null,\r\n  num: 0,\r\n};\r\n/*\r\n * \r\n */\r\nvar utils = {};\r\nvar config = {};\r\nvar ev = new Events();//EventEmitter\r\n/**\r\n * init\r\n */\r\nfunction init(param){\r\n  \r\n  config = param;\r\n/*\r\n * Загружаю слои в главный файл\r\n */\r\nmarmottajax('/game/layers.html').success(function(body) {\r\n    document.getElementById('game').innerHTML = body;\r\n    /*\r\n     * Здесь срабатывает autorun\r\n     */\r\n    ev.emit('autorun', {name: 'autorun'});\r\n    /*\r\n     * Во время первого запуска нужно\r\n     * запустить точку входа.\r\n     * Здесь это и присходит. Ставлю обработчик\r\n     * события (jump) и передаю контекст\r\n     */\r\n    ev.emit.call(vnjs, 'jump', config.entry);\r\n});\r\n \r\n};\r\n\r\n\r\n\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\n\r\n\r\n\r\nfunction on(event, handler){\r\n\r\n  if(typeof event===\"function\"){\r\n      ev.on('autorun', event, vnjs);\r\n  }else if(typeof event===\"string\"){\r\n      ev.on(event, handler, vnjs);\r\n  }\r\n\r\n};\r\n\r\n\r\n\r\n\r\n/*\r\n * getScene\r\n */\r\n\r\nfunction getScene(scene){\r\n\r\nconst pathToScene = `game/${config.scenes}/${config.local}/${scene}.json`;\r\n/*\r\n * Излучаю событие preload что бы было можно повесить\r\n * идикатор загрузки на css\r\n */\r\nev.emit('preload', {name:'preload', msg:'${scene} start loading!'})\r\nmarmottajax({\r\n    url: pathToScene,\r\n    json: true\r\n}).success(function(data) {\r\n    /*\r\n     * Назначаем полученные данные сцены в\r\n     * игровые объекты.\r\n     * А так же объекты внутреннего назначения\r\n     */\r\n    game.scenes[ctx.scene] = data;\r\n\r\n    const _SCENE = game.scenes[ctx.scene];\r\n    /*\r\n     * Добавляю персонажей в каждой загруженной сцены\r\n     * в общий пулл.\r\n     */\r\n    game.characters = Object.assign(game.characters, _SCENE.characters);\r\n    /*\r\n     * Дублирую текущие значения в контекст\r\n     */\r\n    ctx.arr = _SCENE.labels[ctx.label];\r\n    //ctx.assets = game.scenes[ctx.scene].assets;\r\n\r\n    ev.emit('loaded', {name:'load', msg:'${scene} is loaded!'})\r\n });\r\n\r\n};\r\n\r\nfunction parse(){\r\n   /** Текущий объект */\r\n  ctx.obj = ctx.arr[ctx.num];\r\n\r\n  /*if(ctx.arr.length-1>=ctx.num){\r\n    console.log(ctx.obj)\r\n  }else{\r\n    console.log('Массив окончен')\r\n  }\r\n  */\r\n\r\n\r\n  for(let key in ctx.obj){\r\n\r\n      if(key.length<=2){\r\n             let character = game.characters[key];\r\n            \r\n              let reply = ctx.obj[key]; \r\n              ev.emit('alias', {\r\n                   character,\r\n                   reply,\r\n                   aliase: key\r\n                 });\r\n             \r\n\r\n      }else{\r\n        ev.emit(key, ctx.obj[key]);\r\n      }\r\n  }\r\n\r\n};\r\n\r\n\r\n\r\nfunction next(){\r\n  \r\n  parse();\r\n  ctx.num+=1;\r\n  ev.emit('next', {name: 'next'});\r\n};\r\nfunction prev(){\r\n \r\n  parse();\r\n  ctx.num-=1;\r\n  ev.emit('prev', {name: 'prev'});\r\n};\r\n\r\n\r\n/*\r\n * @api\r\n * @version 0.5.7\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  init,\r\n  game,\r\n  getScene,\r\n  config,\r\n  utils,\r\n  next,\r\n  prev,\r\n  parse\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/"],"sourceRoot":""}