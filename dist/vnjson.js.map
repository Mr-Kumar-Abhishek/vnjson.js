{"version":3,"sources":["webpack:///webpack/bootstrap 3735bfb8f2271b3e7fce?04ec","webpack:///./src/vnjson.js?caa5","webpack:///./src/minivents.js?f536"],"names":["ctx","sceneName","labelName","scene","label","obj","num","screen","jumps","data","ev","emit","off","plugin","Object","config","init","_config","game","scenes","on","event","handler","vnjs","setScene","sceneObject","setLabel","assets","err","Error","labelArray","parse","length","_obj","replace","split","ob","key","next","console","log","labelname","len","push","prev","indexOf","pop","jumpTo","join","fn","Events","target","events","empty","type","func","list","i","splice","e","slice","j","apply","call","arguments"],"mappings":"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","file":"dist/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 3735bfb8f2271b3e7fce\n **/","\r\nimport Events from './minivents'; \r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  sceneName:'scene',\r\n  labelName:'label',\r\n  scene: {},\r\n  label: [],\r\n  obj: null,\r\n  num: 0,\r\n  screen: '',\r\n  jumps: [\r\n\r\n  ],\r\n  data: {} //userData\r\n};\r\n\r\n\r\nvar ev = new Events();//EventEmitter\r\nvar { emit, off } = ev;\r\n\r\nconst plugin = new Object();\r\n\r\n//конфигурацию тоже сохранять в memory-card\r\nvar config = {};\r\n\r\nfunction init(_config){\r\n config = _config||config;\r\n emit('getscreens');\r\n return this;\r\n};\r\n\r\nvar game = {\r\n    scenes: {},\r\n\r\n};\r\n\r\n\r\n\r\n\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\n/*\r\n * Объект plugin нужен для тестирования\r\n * что бы можно было вызывать плагин из\r\n * текущего окружения, а не плодить глобальные\r\n * методы.\r\n */ \r\n\r\nfunction on(event, handler){\r\n      plugin[event] = handler;\r\n      ev.on(event, handler, vnjs);\r\n      return this;\r\n};\r\n\r\n\r\n\r\n\r\n/*\r\n * setScene\r\n * @Функция принимает объект сцены\r\n */\r\nfunction setScene(sceneName, sceneObject, labelName, num) {\r\n  try{\r\n   \r\n    /*\r\n     * Назначаем полученные данные сцены в\r\n     * игровые объекты.\r\n     * А так же объекты внутреннего назначения\r\n     */\r\n    game.scenes[sceneName] = sceneObject;\r\n    ctx.scene = sceneObject;\r\n    ctx.sceneName = sceneName;\r\n\r\n    /*\r\n     * Переопределяю методы текущего label'a\r\n     */\r\n\r\n     \r\n    setLabel(labelName, sceneObject[labelName], num);\r\n\r\n    emit('load', sceneObject.assets, sceneName);\r\n    \r\n   \r\n    return this;\r\n  }\r\n  catch (err){\r\n    throw new Error('Ошибка объявления сцены ', err);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\nfunction setLabel(labelName, labelArray, num){\r\n            ctx.labelName = labelName;\r\n            ctx.label = labelArray;\r\n            ctx.num = num;\r\n            parse();\r\n            emit('setlabel', labelName, labelArray.length);\r\n            return this;\r\n};\r\n\r\nfunction parse(_obj){\r\n/** Текущий объект */\r\nif(_obj){\r\n    if(typeof _obj==='object'){\r\n          /*parse({jump: 'scene/label'})*/\r\n          ctx.obj = _obj;\r\n    }\r\n    else if(typeof _obj==='string'){\r\n      /* parse('jump: string/string') */\r\n      /* Убираю пробелы из строки и разбиваю на массив*/\r\n      let data = _obj.replace(/\\s/g, \"\").split(':');\r\n   \r\n        var ob = {\r\n            [data[0]]: data[1] \r\n          };\r\n        ctx.obj = ob;\r\n    }\r\n    \r\n}else{\r\n    /* parse() without args */\r\n    ctx.obj = ctx.label[ctx.num];\r\n}  \r\n  \r\n\r\n  for(let key in ctx.obj){\r\n  /*\r\n         * vnjs.on('alert')\r\n         * Подписывает пользовательские плагины\r\n         * \r\n         */\r\n        ev.emit(key, ctx.obj[key]);\r\n  }\r\n  emit('parse', ctx.obj);\r\n  return this;;\r\n};\r\n\r\n\r\n\r\nfunction next(){\r\n  let { label, num } = ctx;\r\n  \r\nif(num>=label.length){\r\n  console.log('Конец метки');\r\n  ctx.num = 0;\r\n}\r\n  ctx.num++;\r\n  parse();\r\n  emit('next');\r\n  return ctx.num;\r\n};\r\n\r\non('setlabel', function(labelname, len){\r\n let { sceneName, labelName } = vnjs.ctx;\r\n    \r\n     ctx.jumps.push({sceneName, labelName, len});\r\n});\r\n/*\r\n * Должна показывать предыдущие экраны\r\n * А так же все движения между метками и сценами\r\n *\r\n */\r\nfunction prev(){\r\n\r\n let { jumps, label } = ctx;\r\n  if(label.indexOf(-1)){\r\n    if(jumps.indexOf(0)){\r\n       // parse(`screen: ${fn.prevScreen}`)//preloader??\r\n       console.log('Начало игры');\r\n       ctx.num = 0;\r\n       /*fn.prevScreen it should to be array*/\r\n    }else{\r\n      let { sceneName, labelName, len } = jumps.pop();\r\n      let jumpTo = [ sceneName, labelName, len ].join(\"/\");\r\n      parse('jump: '+jumpTo)\r\n    }\r\n  }else{\r\n      ctx.num--;\r\n      parse();\r\n  }\r\n\r\n  emit('prev');\r\n  return ctx.num;\r\n};\r\n\r\nvar fn = {};\r\n\r\n\r\n/*\r\n * @api\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  game,\r\n  setScene,\r\n  setLabel,\r\n  config,\r\n  plugin,\r\n  next,\r\n  prev,\r\n  parse,\r\n  emit,\r\n  off,\r\n  init,\r\n  fn\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/","function Events(target){\r\n  var events = {}, empty = [];\r\n  target = target || this;\r\n  /**\r\n   *  On: listen to events\r\n   */\r\n  target.on = function(type, func, ctx){\r\n    (events[type] = events[type] || []).push([func, ctx]);\r\n  };\r\n  /**\r\n   *  Off: stop listening to event / specific callback\r\n   */\r\n  target.off = function(type, func){\r\n    type || (events = {});\r\n    var list = events[type] || empty,\r\n        i = list.length = func ? list.length : 0;\r\n    while(i--) func == list[i][0] && list.splice(i,1);\r\n  };\r\n  /** \r\n   * Emit: send event, callbacks will be triggered\r\n   */\r\n  target.emit = function(type){\r\n    var e = events[type] || empty, list = e.length > 0 ? e.slice(0, e.length) : e, i=0, j;\r\n    while(j=list[i++]) j[0].apply(j[1], empty.slice.call(arguments, 1));\r\n  };\r\n};\r\n\r\nexport default Events;\n\n\n/** WEBPACK FOOTER **\n ** ./src/minivents.js\n **/"],"sourceRoot":""}