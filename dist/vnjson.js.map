{"version":3,"sources":["vnjson.js","plugins/get-scene.js","plugins/get-screens.js","plugins/jump.js","plugins/navigo.js","plugins/router.js","plugins/screen-show.js","plugins/vnjson-audio.js","plugins/vnjson-preload.js"],"names":["vnjs","plugins","TREE","DEBUG","playList","prevAudio","prevScreen","screenList","on","event","handler","push","emit","args","Array","isArray","map","call","off","state","scene","label","index","screens","current","object","setScene","name","body","characters","aliase","Object","keys","character","reply","param","assets","parse","obj","ctx","next","init","conf","data","sceneName","labelName","uri","gameDir","scenesDir","local","fetch","then","r","json","console","log","sceneBody","fetchCss","filename","l","document","createElement","rel","href","h","getElementsByTagName","appendChild","uriHtml","uriCss","gameRoot","querySelector","element","text","innerHTML","screensNodeList","querySelectorAll","screenClass","forEach","screen","styles","display","width","height","assign","style","setAttribute","id","pathname","isScene","pathArr","length","split","global","factory","exports","module","define","amd","Navigo","_typeof","Symbol","iterator","constructor","prototype","isPushStateAvailable","window","history","pushState","useHash","hash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_onLocationChange","bind","_genericHooks","_historyAPIUpdateMethod","replace","_cLoc","_listen","updatePageLinks","clean","s","RegExp","regExpResultToParams","match","names","slice","reduce","params","value","decodeURIComponent","replaceDynamicURLParts","route","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","getUrlDepth","url","compareUrlDepth","urlA","urlB","findMatchedRoutes","routes","arguments","undefined","_replaceDynamicURLPar","filter","m","matched","fallbackURL","result","isHashChangeAPIAvailable","extractGETParameters","join","getOnlyURL","onlyURL","cleanGETParam","str","manageHooks","hooks","before","shouldRoute","after","isHashedRoot","helpers","navigate","path","absolute","to","_getRoot","resolve","location","_this","_len","_key","func","uses","_add","orderedRoutes","sort","notFound","_this2","GETParameters","query","already","_callLeave","apply","destroy","clearTimeout","_listeningInterval","removeEventListener","self","_findLinks","link","hasListenerAttached","addEventListener","e","getLinkPath","preventDefault","generate","key","toString","pause","status","resume","historyAPIUpdateMethod","disableIfAPINotAvailable","lastRouteResolved","getAttribute","_hooks","encodeURI","as","_this3","cached","_check","check","setTimeout","__NAVIGO_WINDOW_LOCATION_MOCK__","leave","router","info","warn","getRealDisplay","elem","currentStyle","getComputedStyle","computedStyle","getPropertyValue","hide","el","displayCache","isHidden","offsetWidth","offsetHeight","tr","nodeName","toLowerCase","show","old","testElem","removeChild","pscreen","play","action","error","persent","PROGREESS","i","asset","position","progress","Math","round","type","img","Image","src","onload","audio","Audio"],"mappings":"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","file":"vnjson.js","sourcesContent":["\r\nvar vnjs = {\r\n  \r\n      plugins: {},\r\n      TREE: {},\r\n      DEBUG: false,\r\n      playList: {},\r\n      prevAudio: \"\",\r\n      prevScreen: \"\",\r\n      screenList: {}\r\n};\r\n\r\nvnjs.on = function(event, handler){\r\n          if (!vnjs.plugins[event]) {\r\n              vnjs.plugins[event] = [];\r\n          };\r\n          vnjs.plugins[event].push(handler);\r\n};\r\n\r\nvnjs.emit = function (event, ...args) {\r\n         if (Array.isArray(vnjs.plugins[event])) {\r\n            vnjs.plugins[event].map(function(handler){\r\n                    handler.call(vnjs, ...args);\r\n            });\r\n         }\r\n         /*\r\n         else{\r\n          Выводятся системные слушатели\r\n          console.log(`Event [ ${event} ] not found`)\r\n         }\r\n         */\r\n};\r\nvnjs.off = function (event) {\r\n        delete vnjs.plugins[event];\r\n};\r\n\r\n/*\r\n * В {state} должно помещаться все то\r\n * что сохроняется в карту памяти\r\n * И что важно загрузить из нее без последствий.\r\n * В состоянии не должно быть мусора\r\n */\r\nvnjs.state = {\r\n  scene: 'scene',\r\n  label: 'label',\r\n  index: 0,\r\n  screens: []\r\n};\r\n/*\r\n * Получает текущее тела из состояние\r\n */\r\nvnjs.current = {\r\n  \r\n      scene: function (){\r\n        return vnjs.TREE[vnjs.state.scene];\r\n      },\r\n      label: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label];\r\n      },\r\n      object: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label][vnjs.state.index];\r\n     }\r\n};\r\n\r\n\r\nvnjs.setScene = function (name, body){\r\n  this.TREE[name] = body;\r\n  this.state.scene = name;\r\n\r\n  body.characters.map(character=>{\r\n    let aliase = Object.keys(character)[0];\r\n\r\n    vnjs.on(aliase, function(reply){\r\n          vnjs.emit('character', {aliase, param: character[aliase], reply } );\r\n\r\n    });\r\n\r\n});\r\n  this.emit('load', body.assets);\r\n // this.parse();//??? Возможно это будет вызываться не здесь\r\n};\r\n\r\n\r\n\r\n\r\nvnjs.parse = function (obj){\r\n  var ctx = null;\r\n  if(obj){\r\n    ctx = obj;\r\n  }else{\r\n    ctx = vnjs.current.object();\r\n  };\r\n\r\n  for(let event in ctx){\r\n\r\n        vnjs.emit(event, ctx[event]);\r\n\r\n  };\r\n\r\n};\r\n\r\n\r\nvnjs.next = function (){\r\n  this.parse();\r\n  this.state.index++;\r\n  return '-------------------------';\r\n};\r\n\r\nvnjs.init = function (conf){\r\n  vnjs.conf = conf;\r\n // this.parse({'jump': conf.entryScene});\r\n  vnjs.emit('getScreens');\r\n  return true;\r\n};\r\n","/**\r\n conf = /scenes/\r\n*/\r\n\r\nvnjs.on('getScene', function(data){\r\n\tconst { sceneName, labelName, index } = data;\r\n\tconst { DEBUG, conf, setScene, emit } = this;\r\n  let uri = `${conf.gameDir}/${conf.scenesDir}/${conf.local}/${sceneName}.json`;\r\n  emit('preload', data);\r\n  fetch(uri)\r\n\t.then(r=>r.json())\r\n\t.then(sceneBody=>{\r\n\r\n\t\tif(DEBUG){\r\n\t\t\tconsole.log(sceneName, sceneBody)\r\n\t\t//\tconsole.log(data);\r\n\t\t}\r\n\r\n\t\tvnjs.setScene(sceneName, sceneBody, labelName, index);\r\n\r\n\t})\r\n/*\r\n\r\nsetScene(\"*\", sceneBody);\r\n\r\nstate.label = \"mainMenu\";\r\n\r\nnext();\r\n*/\r\n\r\n});","vnjs.on('getScreens', function(){\r\n\r\nconst { conf, DEBUG, emit } = this;\r\n\r\nfunction fetchCss(filename) {\r\n    var l = document.createElement('link');\r\n    l.rel = 'stylesheet';\r\n    l.href = filename\r\n    var h = document.getElementsByTagName('head')[0];\r\n    h.appendChild(l);\r\n};\r\n\r\n\r\n\r\n\t\r\n\tlet uriHtml = `${conf.gameDir}/screens.html`;\r\n\tlet uriCss = `${conf.gameDir}/screens.css`;\r\n\tlet gameRoot = document.querySelector(conf.element);\r\n\tfetch(uriHtml)\r\n\t\t.then(r=>r.text())\r\n\t\t\r\n\t\t.then(screens=>{\r\n\t\t\tfetchCss(uriCss);\r\n\t\t\tgameRoot.innerHTML = screens;\r\n\t\t})\r\n\t\t.then(()=>{\r\n\t\t\tlet screensNodeList = document.querySelectorAll(conf.screenClass);\r\n            screensNodeList.forEach((screen)=>{\r\n\r\n             let styles = {\r\n                    display: 'none',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                  };\r\n             Object.assign(screen.style, styles);\r\n\r\n             /*Код кантораЮ необходимо для работы 'Правильлного show/hide'*/\r\n\t\t\tscreen.setAttribute(\"displayOld\", screen.style.display)\r\n             \r\n\r\n            vnjs.screenList[screen.id] = screen;\r\n            \r\n            DEBUG&&console.log(screen);\r\n            \r\n            });\r\n\r\n          emit('screensLoaded')\r\n\t\t})\r\n\t\t//.catch(function(error) { console.error(error); })\r\n\t\t\r\n})","vnjs.on('jump', function(pathname){\r\n\r\nconst { parse, state, emit, DEBUG } = this;\r\n\r\n\r\n/*****\r\n#WARN\r\n> {jump: 'label/0'}\r\n< Object { labelName: \"0\", sceneName: \"label\", index: 0 }\r\n\r\n\r\nfunction getName(){\r\n  let sceneName = pathArr[0];\r\n  let labelName = pathArr[1];\r\n  let index = pathArr[2]||0;\r\n  return { labelName, sceneName, index: (+index) };\r\n};\r\n\r\nfunction isNum(num){\r\n  return /[0-9]/.test(+num)\r\n};\r\n******/\r\nfunction isScene(pathname){\r\n\r\n  if(pathArr.length===2){\r\n    return true;\r\n  }else{\r\n   \r\n    return false;\r\n  }\r\n};\r\n/*\r\n var pathObj = getName(pathname);\r\n\r\n{\r\n\tDEBUG&&console.log('jump: ', pathObj);\r\n};\r\n\r\n*/\r\n\r\nconst pathArr = pathname.split('/');\r\n\r\nif(isScene(pathname)){\r\n    // set state\r\n    vnjs.state.scene = pathArr[0];\r\n    vnjs.state.label = pathArr[1];\r\n    vnjs.state.index = 0;//pathObj.index;\r\n    emit('getScene',{ sceneName:pathArr[0], labelName:pathArr[1], index: 0 });\r\n}else{\r\n\r\n\t // set state\r\n   // vnjs.state.scene = vnjs.state.scene;\r\n    vnjs.state.label =  pathArr[0];\r\n    vnjs.state.index = 0;//pathObj.index;\r\n\r\n   // setLabel(pathname, ctx.scene[pathname],  obj.num );\r\n   parse();\r\n}\r\n\r\n\r\n\r\n});\r\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.Navigo = factory());\n}(this, (function () { 'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction isPushStateAvailable() {\n  return !!(typeof window !== 'undefined' && window.history && window.history.pushState);\n}\n\nfunction Navigo(r, useHash, hash) {\n  this.root = null;\n  this._routes = [];\n  this._useHash = useHash;\n  this._hash = typeof hash === 'undefined' ? '#' : hash;\n  this._paused = false;\n  this._destroyed = false;\n  this._lastRouteResolved = null;\n  this._notFoundHandler = null;\n  this._defaultHandler = null;\n  this._usePushState = !useHash && isPushStateAvailable();\n  this._onLocationChange = this._onLocationChange.bind(this);\n  this._genericHooks = null;\n  this._historyAPIUpdateMethod = 'pushState';\n\n  if (r) {\n    this.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\n  } else if (useHash) {\n    this.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\n  }\n\n  this._listen();\n  this.updatePageLinks();\n}\n\nfunction clean(s) {\n  if (s instanceof RegExp) return s;\n  return s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\n}\n\nfunction regExpResultToParams(match, names) {\n  if (names.length === 0) return null;\n  if (!match) return null;\n  return match.slice(1, match.length).reduce(function (params, value, index) {\n    if (params === null) params = {};\n    params[names[index]] = decodeURIComponent(value);\n    return params;\n  }, null);\n}\n\nfunction replaceDynamicURLParts(route) {\n  var paramNames = [],\n      regexp;\n\n  if (route instanceof RegExp) {\n    regexp = route;\n  } else {\n    regexp = new RegExp(route.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\n      paramNames.push(name);\n      return Navigo.REPLACE_VARIABLE_REGEXP;\n    }).replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP, Navigo.MATCH_REGEXP_FLAGS);\n  }\n  return { regexp: regexp, paramNames: paramNames };\n}\n\nfunction getUrlDepth(url) {\n  return url.replace(/\\/$/, '').split('/').length;\n}\n\nfunction compareUrlDepth(urlA, urlB) {\n  return getUrlDepth(urlB) - getUrlDepth(urlA);\n}\n\nfunction findMatchedRoutes(url) {\n  var routes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  return routes.map(function (route) {\n    var _replaceDynamicURLPar = replaceDynamicURLParts(clean(route.route)),\n        regexp = _replaceDynamicURLPar.regexp,\n        paramNames = _replaceDynamicURLPar.paramNames;\n\n    var match = url.replace(/^\\/+/, '/').match(regexp);\n    var params = regExpResultToParams(match, paramNames);\n\n    return match ? { match: match, route: route, params: params } : false;\n  }).filter(function (m) {\n    return m;\n  });\n}\n\nfunction match(url, routes) {\n  return findMatchedRoutes(url, routes)[0] || false;\n}\n\nfunction root(url, routes) {\n  var matched = routes.map(function (route) {\n    return route.route === '' || route.route === '*' ? url : url.split(new RegExp(route.route + '($|\\/)'))[0];\n  });\n  var fallbackURL = clean(url);\n\n  if (matched.length > 1) {\n    return matched.reduce(function (result, url) {\n      if (result.length > url.length) result = url;\n      return result;\n    }, matched[0]);\n  } else if (matched.length === 1) {\n    return matched[0];\n  }\n  return fallbackURL;\n}\n\nfunction isHashChangeAPIAvailable() {\n  return typeof window !== 'undefined' && 'onhashchange' in window;\n}\n\nfunction extractGETParameters(url) {\n  return url.split(/\\?(.*)?$/).slice(1).join('');\n}\n\nfunction getOnlyURL(url, useHash, hash) {\n  var onlyURL = url,\n      split;\n  var cleanGETParam = function cleanGETParam(str) {\n    return str.split(/\\?(.*)?$/)[0];\n  };\n\n  if (typeof hash === 'undefined') {\n    // To preserve BC\n    hash = '#';\n  }\n\n  if (isPushStateAvailable() && !useHash) {\n    onlyURL = cleanGETParam(url).split(hash)[0];\n  } else {\n    split = url.split(hash);\n    onlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\n  }\n\n  return onlyURL;\n}\n\nfunction manageHooks(handler, hooks, params) {\n  if (hooks && (typeof hooks === 'undefined' ? 'undefined' : _typeof(hooks)) === 'object') {\n    if (hooks.before) {\n      hooks.before(function () {\n        var shouldRoute = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n        if (!shouldRoute) return;\n        handler();\n        hooks.after && hooks.after(params);\n      }, params);\n      return;\n    } else if (hooks.after) {\n      handler();\n      hooks.after && hooks.after(params);\n      return;\n    }\n  }\n  handler();\n}\n\nfunction isHashedRoot(url, useHash, hash) {\n  if (isPushStateAvailable() && !useHash) {\n    return false;\n  }\n\n  if (!url.match(hash)) {\n    return false;\n  }\n\n  var split = url.split(hash);\n\n  return split.length < 2 || split[1] === '';\n}\n\nNavigo.prototype = {\n  helpers: {\n    match: match,\n    root: root,\n    clean: clean,\n    getOnlyURL: getOnlyURL\n  },\n  navigate: function navigate(path, absolute) {\n    var to;\n\n    path = path || '';\n    if (this._usePushState) {\n      to = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\n      to = to.replace(/([^:])(\\/{2,})/g, '$1/');\n      history[this._historyAPIUpdateMethod]({}, '', to);\n      this.resolve();\n    } else if (typeof window !== 'undefined') {\n      path = path.replace(new RegExp('^' + this._hash), '');\n      window.location.href = window.location.href.replace(/#$/, '').replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\n    }\n    return this;\n  },\n  on: function on() {\n    var _this = this;\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (typeof args[0] === 'function') {\n      this._defaultHandler = { handler: args[0], hooks: args[1] };\n    } else if (args.length >= 2) {\n      if (args[0] === '/') {\n        var func = args[1];\n\n        if (_typeof(args[1]) === 'object') {\n          func = args[1].uses;\n        }\n\n        this._defaultHandler = { handler: func, hooks: args[2] };\n      } else {\n        this._add(args[0], args[1], args[2]);\n      }\n    } else if (_typeof(args[0]) === 'object') {\n      var orderedRoutes = Object.keys(args[0]).sort(compareUrlDepth);\n\n      orderedRoutes.forEach(function (route) {\n        _this.on(route, args[0][route]);\n      });\n    }\n    return this;\n  },\n  off: function off(handler) {\n    if (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\n      this._defaultHandler = null;\n    } else if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\n      this._notFoundHandler = null;\n    }\n    this._routes = this._routes.reduce(function (result, r) {\n      if (r.handler !== handler) result.push(r);\n      return result;\n    }, []);\n    return this;\n  },\n  notFound: function notFound(handler, hooks) {\n    this._notFoundHandler = { handler: handler, hooks: hooks };\n    return this;\n  },\n  resolve: function resolve(current) {\n    var _this2 = this;\n\n    var handler, m;\n    var url = (current || this._cLoc()).replace(this._getRoot(), '');\n\n    if (this._useHash) {\n      url = url.replace(new RegExp('^\\/' + this._hash), '/');\n    }\n\n    var GETParameters = extractGETParameters(current || this._cLoc());\n    var onlyURL = getOnlyURL(url, this._useHash, this._hash);\n\n    if (this._paused) return false;\n\n    if (this._lastRouteResolved && onlyURL === this._lastRouteResolved.url && GETParameters === this._lastRouteResolved.query) {\n      if (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\n        this._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\n      }\n      return false;\n    }\n\n    m = match(onlyURL, this._routes);\n\n    if (m) {\n      this._callLeave();\n      this._lastRouteResolved = {\n        url: onlyURL,\n        query: GETParameters,\n        hooks: m.route.hooks,\n        params: m.params,\n        name: m.route.name\n      };\n      handler = m.route.handler;\n      manageHooks(function () {\n        manageHooks(function () {\n          m.route.route instanceof RegExp ? handler.apply(undefined, m.match.slice(1, m.match.length)) : handler(m.params, GETParameters);\n        }, m.route.hooks, m.params, _this2._genericHooks);\n      }, this._genericHooks, m.params);\n      return m;\n    } else if (this._defaultHandler && (onlyURL === '' || onlyURL === '/' || onlyURL === this._hash || isHashedRoot(onlyURL, this._useHash, this._hash))) {\n      manageHooks(function () {\n        manageHooks(function () {\n          _this2._callLeave();\n          _this2._lastRouteResolved = { url: onlyURL, query: GETParameters, hooks: _this2._defaultHandler.hooks };\n          _this2._defaultHandler.handler(GETParameters);\n        }, _this2._defaultHandler.hooks);\n      }, this._genericHooks);\n      return true;\n    } else if (this._notFoundHandler) {\n      manageHooks(function () {\n        manageHooks(function () {\n          _this2._callLeave();\n          _this2._lastRouteResolved = { url: onlyURL, query: GETParameters, hooks: _this2._notFoundHandler.hooks };\n          _this2._notFoundHandler.handler(GETParameters);\n        }, _this2._notFoundHandler.hooks);\n      }, this._genericHooks);\n    }\n    return false;\n  },\n  destroy: function destroy() {\n    this._routes = [];\n    this._destroyed = true;\n    this._lastRouteResolved = null;\n    this._genericHooks = null;\n    clearTimeout(this._listeningInterval);\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('popstate', this._onLocationChange);\n      window.removeEventListener('hashchange', this._onLocationChange);\n    }\n  },\n  updatePageLinks: function updatePageLinks() {\n    var self = this;\n\n    if (typeof document === 'undefined') return;\n\n    this._findLinks().forEach(function (link) {\n      if (!link.hasListenerAttached) {\n        link.addEventListener('click', function (e) {\n          var location = self.getLinkPath(link);\n\n          if (!self._destroyed) {\n            e.preventDefault();\n            self.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\n          }\n        });\n        link.hasListenerAttached = true;\n      }\n    });\n  },\n  generate: function generate(name) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var result = this._routes.reduce(function (result, route) {\n      var key;\n\n      if (route.name === name) {\n        result = route.route;\n        for (key in data) {\n          result = result.toString().replace(':' + key, data[key]);\n        }\n      }\n      return result;\n    }, '');\n\n    return this._useHash ? this._hash + result : result;\n  },\n  link: function link(path) {\n    return this._getRoot() + path;\n  },\n  pause: function pause() {\n    var status = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n    this._paused = status;\n    if (status) {\n      this._historyAPIUpdateMethod = 'replaceState';\n    } else {\n      this._historyAPIUpdateMethod = 'pushState';\n    }\n  },\n  resume: function resume() {\n    this.pause(false);\n  },\n  historyAPIUpdateMethod: function historyAPIUpdateMethod(value) {\n    if (typeof value === 'undefined') return this._historyAPIUpdateMethod;\n    this._historyAPIUpdateMethod = value;\n    return value;\n  },\n  disableIfAPINotAvailable: function disableIfAPINotAvailable() {\n    if (!isPushStateAvailable()) {\n      this.destroy();\n    }\n  },\n  lastRouteResolved: function lastRouteResolved() {\n    return this._lastRouteResolved;\n  },\n  getLinkPath: function getLinkPath(link) {\n    return link.getAttribute('href');\n  },\n  hooks: function hooks(_hooks) {\n    this._genericHooks = _hooks;\n  },\n\n  _add: function _add(route) {\n    var handler = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var hooks = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    if (typeof route === 'string') {\n      route = encodeURI(route);\n    }\n    this._routes.push((typeof handler === 'undefined' ? 'undefined' : _typeof(handler)) === 'object' ? {\n      route: route,\n      handler: handler.uses,\n      name: handler.as,\n      hooks: hooks || handler.hooks\n    } : { route: route, handler: handler, hooks: hooks });\n\n    return this._add;\n  },\n  _getRoot: function _getRoot() {\n    if (this.root !== null) return this.root;\n    this.root = root(this._cLoc().split('?')[0], this._routes);\n    return this.root;\n  },\n  _listen: function _listen() {\n    var _this3 = this;\n\n    if (this._usePushState) {\n      window.addEventListener('popstate', this._onLocationChange);\n    } else if (isHashChangeAPIAvailable()) {\n      window.addEventListener('hashchange', this._onLocationChange);\n    } else {\n      var cached = this._cLoc(),\n          current = void 0,\n          _check = void 0;\n\n      _check = function check() {\n        current = _this3._cLoc();\n        if (cached !== current) {\n          cached = current;\n          _this3.resolve();\n        }\n        _this3._listeningInterval = setTimeout(_check, 200);\n      };\n      _check();\n    }\n  },\n  _cLoc: function _cLoc() {\n    if (typeof window !== 'undefined') {\n      if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\n        return window.__NAVIGO_WINDOW_LOCATION_MOCK__;\n      }\n      return clean(window.location.href);\n    }\n    return '';\n  },\n  _findLinks: function _findLinks() {\n    return [].slice.call(document.querySelectorAll('[data-navigo]'));\n  },\n  _onLocationChange: function _onLocationChange() {\n    this.resolve();\n  },\n  _callLeave: function _callLeave() {\n    var lastRouteResolved = this._lastRouteResolved;\n\n    if (lastRouteResolved && lastRouteResolved.hooks && lastRouteResolved.hooks.leave) {\n      lastRouteResolved.hooks.leave(lastRouteResolved.params);\n    }\n  }\n};\n\nNavigo.PARAMETER_REGEXP = /([:*])(\\w+)/g;\nNavigo.WILDCARD_REGEXP = /\\*/g;\nNavigo.REPLACE_VARIABLE_REGEXP = '([^\\/]+)';\nNavigo.REPLACE_WILDCARD = '(?:.*)';\nNavigo.FOLLOWED_BY_SLASH_REGEXP = '(?:\\/$|$)';\nNavigo.MATCH_REGEXP_FLAGS = '';\n\nreturn Navigo;\n\n})));\n","{\r\n\tlet root = null;\r\n\tvnjs.router = new Navigo(root, true, '#!');\r\n};\r\n\r\nvnjs.router\r\n  .on(function(){\r\n    console.info('############ vnjson.js #############');\r\n    vnjs.parse({screen: 'main-menu'})\r\n  })\r\n  .on('/about', function(){\r\n    vnjs.parse({screen: 'about'})\r\n  })\r\n  .on('/settings', function(){\r\n    vnjs.parse({screen: 'settings'})\r\n  })\r\n\r\n  .on('/game/:scene', function(params){\r\n  \tlet { scene } = params;\r\n    console.warn([scene].join('|'))\r\n  })\r\n  .on('/game/:scene/:label', function(params){\r\n  \tlet { scene, label } = params;\r\n    console.warn([scene,label].join('|'))\r\n  })\r\n  .on('/game/:scene/:label/:index', function (params) {\r\n//router.navigate('/products/list');\r\n    let { scene, label, index } = params;\r\n    console.warn([scene,label, index].join('|'))\r\n  })\r\n  .notFound(function(){\r\n  \tconsole.warn('Маршрута не существует')\r\n  })\r\n  .resolve();\r\n\r\n\r\n","/**\r\n\r\n\r\n\r\nПлагины\r\nget-screens\r\n &\r\nscreen-show\r\nобъеденить в один ->screen\r\n\r\n* Так же можно было бы объеденить jump и getScenes\r\n*\r\n*/\r\nfunction getRealDisplay(elem) {\r\n\tif (elem.currentStyle) {\r\n\t\treturn elem.currentStyle.display\r\n\t} else if (window.getComputedStyle) {\r\n\t\tvar computedStyle = window.getComputedStyle(elem, null )\r\n\r\n\t\treturn computedStyle.getPropertyValue('display')\r\n\t}\r\n}\r\n\r\nfunction hide(el) {\r\n\tif (!el.getAttribute('displayOld')) {\r\n\t\tel.setAttribute(\"displayOld\", el.style.display)\r\n\t}\r\n\r\n\tel.style.display = \"none\"\r\n}\r\n\r\ndisplayCache = {}\r\n\r\nfunction isHidden(el) {\r\n\tvar width = el.offsetWidth, height = el.offsetHeight,\r\n\t\ttr = el.nodeName.toLowerCase() === \"tr\"\r\n\r\n\treturn width === 0 && height === 0 && !tr ?\r\n\t\ttrue : width > 0 && height > 0 && !tr ? false :\tgetRealDisplay(el)\r\n}\r\n\r\n\r\n\r\nfunction show(el) {\r\n\r\n\tif (getRealDisplay(el) != 'none') return\r\n\r\n\tvar old = el.getAttribute(\"displayOld\");\r\n\tel.style.display = old || \"\";\r\n\r\n\tif ( getRealDisplay(el) === \"none\" ) {\r\n\t\tvar nodeName = el.nodeName, body = document.body, display\r\n\r\n\t\tif ( displayCache[nodeName] ) {\r\n\t\t\tdisplay = displayCache[nodeName]\r\n\t\t} else {\r\n\t\t\tvar testElem = document.createElement(nodeName)\r\n\t\t\tbody.appendChild(testElem)\r\n\t\t\tdisplay = getRealDisplay(testElem)\r\n\r\n\t\t\tif (display === \"none\" ) {\r\n\t\t\t\tdisplay = \"block\"\r\n\t\t\t}\r\n\r\n\t\t\tbody.removeChild(testElem)\r\n\t\t\tdisplayCache[nodeName] = display\r\n\t\t}\r\n\r\n\t\tel.setAttribute('displayOld', display)\r\n\t\tel.style.display = display\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\nvnjs.on('screen', function(id){\r\n\tthis.emit(id, vnjs.screenList[id]);\r\n\r\n\r\n if(vnjs.prevScreen!=\"\"){\r\n \t\t\t\tlet pscreen = vnjs.screenList[vnjs.prevScreen];\r\n         hide(pscreen);\r\n        \r\n }\r\n\r\n vnjs.prevScreen = id;\r\n\t//prefix\r\n\t//show.id\r\n\t//hide.pref.screen\r\n\t//push.state.screens\r\n\tshow(vnjs.screenList[id])\r\n})","\r\n\r\nvnjs.on('audio', function(data){\r\n\r\n\r\n\r\n  if(typeof data === 'string'){\r\n      \r\n       if(vnjs.prevAudio!=\"\"){\r\n         vnjs.playList[vnjs.prevAudio].pause();\r\n       }\r\n       vnjs.playList[data].play(); \r\n       vnjs.prevAudio = data;\r\n\r\n  }else if(typeof data === 'object'){\r\n\r\n      if(vnjs.prevAudio!=\"\"){\r\n          vnjs.playList[vnjs.prevAudio].pause();\r\n       }\r\n\r\n      vnjs.playList[data.id][data.action]();\r\n    \r\n       vnjs.prevAudio = data.id;\r\n     // vnjs.audio[data.id].loop = data.loop;\r\n  }else{\r\n    console.error('incorect data type');\r\n  }\r\n//var sound = self.playlist[self.index].howl;\r\n\r\n});","/* @events\r\n    * preload\r\n    * load\r\n    * postload\r\n */\r\n\r\nvnjs.on('load', function(assets){\r\n  const { DEBUG, emit } = this;\r\n\r\n\r\nvar persent = 100/assets.length;\r\nvar PROGREESS = 0;\r\nvar i = 0;\r\nfor(let asset of assets){\r\n \r\nvar position = [ i+=1, '/', assets.length ].join(\"\");\r\n\r\nlet progress = Math.round(PROGREESS+=persent)+\"%\";\r\n\r\n\r\n  if(asset.type===\"image\"){\r\n       let img = new Image();\r\n           img.src = asset.path;\r\n           img.onload = function(){\r\n                 emit('imageLoad', asset);\r\n           };\r\n  }\r\n  else if(asset.type===\"audio\"){\r\n       let audio = new Audio();\r\n           audio.addEventListener('canplaythrough', ()=>{\r\n                  emit('audioLoad', asset);\r\n           }, false);\r\n          audio.src = asset.path;\r\n        vnjs.playList[asset.id] = audio; \r\n  }\r\n  else{\r\n    console.error('asset type incorect');\r\n    break;\r\n  }\r\nlet data = Object.assign(asset, {progress, position});\r\n                  emit('asset', data);\r\n};\r\n\r\n{\r\n  DEBUG&&console.info('LOADING...');\r\n};\r\n\r\n\r\n  emit('postload');\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}