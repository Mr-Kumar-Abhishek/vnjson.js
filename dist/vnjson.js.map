{"version":3,"sources":["vnjson.js","plugins/jump.js","plugins/screen-show.js","plugins/vnjson-audio.js","plugins/vnjson-preload.js"],"names":["vnjs","plugins","TREE","DEBUG","playList","prevAudio","prevScreen","screenList","conf","prefix","element","gameDir","scenesDir","local","entryPoint","screenClass","on","event","handler","push","emit","args","Array","isArray","map","call","off","state","scene","label","index","screen","data","current","object","document","getElementById","setScene","name","body","characters","aliase","Object","keys","character","reply","param","assets","parse","obj","ctx","next","getScreens","callback","fetchCss","filename","l","createElement","rel","href","h","getElementsByTagName","appendChild","uriHtml","uriCss","gameRoot","querySelector","fetch","then","r","text","innerHTML","screens","screensNodeList","querySelectorAll","forEach","styles","display","width","height","assign","style","setAttribute","id","catch","console","error","init","jump","progressSave","serialState","JSON","stringify","localStorage","setItem","progressLoad","getItem","join","progressDelete","log","msg","e","info","pathname","getScene","sceneName","labelName","uri","json","sceneBody","isScene","pathName","arr","split","length","isNaN","warn","isLabel","getRealDisplay","elem","currentStyle","window","getComputedStyle","computedStyle","getPropertyValue","hide","el","getAttribute","displayCache","isHidden","offsetWidth","offsetHeight","tr","nodeName","toLowerCase","show","old","testElem","removeChild","pscreen","pause","play","action","persent","PROGREESS","i","asset","position","progress","Math","round","type","img","Image","src","path","onload","audio","Audio","addEventListener"],"mappings":"AACA,IAAIA,OAAO;AAELC,WAAS,EAFJ;AAGLC,QAAM,EAHD;AAILC,SAAO,KAJF;AAKLC,YAAU,EALL;AAMLC,aAAW,EANN;AAOLC,cAAY,EAPP;AAQLC,cAAY;AARP,CAAX;AAWAP,KAAKQ,IAAL,GAAY;AACNC,UAAQ,EADF;AAENC,WAAS,cAFH;AAGNC,WAAS,QAHH;AAINC,aAAW,QAJL;AAKNC,SAAO,OALD;AAMNC,cAAY,aANN;AAONC,eAAa;AAPP,CAAZ;;AAUAf,KAAKgB,EAAL,GAAU,UAASC,KAAT,EAAgBC,OAAhB,EAAwB;AACxB,MAAI,CAAClB,KAAKC,OAAL,CAAagB,KAAb,CAAL,EAA0B;AACtBjB,SAAKC,OAAL,CAAagB,KAAb,IAAsB,EAAtB;AACH;;AAAA;AACDjB,OAAKC,OAAL,CAAagB,KAAb,EAAoBE,IAApB,CAAyBD,OAAzB;AACT,CALD;;AAOAlB,KAAKoB,IAAL,GAAY,UAAUH,KAAV,EAA0B;AAAA,oCAANI,IAAM;AAANA,QAAM;AAAA;;AAC7B,MAAIC,MAAMC,OAAN,CAAcvB,KAAKC,OAAL,CAAagB,KAAb,CAAd,CAAJ,EAAwC;AACrCjB,SAAKC,OAAL,CAAagB,KAAb,EAAoBO,GAApB,CAAwB,UAASN,OAAT,EAAiB;AACjCA,cAAQO,IAAR,iBAAazB,IAAb,SAAsBqB,IAAtB;AACP,KAFD;AAGF;AACD;;;;;;;AAMR,CAZD;;AAaArB,KAAK0B,GAAL,GAAW,UAAUT,KAAV,EAAiB;AACpB,SAAOjB,KAAKC,OAAL,CAAagB,KAAb,CAAP;AACP,CAFD;AAIA;;;;;;;;AAOAjB,KAAK2B,KAAL,GAAa;AACXC,SAAO,OADI;AAEXC,SAAO,OAFI;AAGXC,SAAO,CAHI;AAIXC,UAAQ,EAJG;AAIC;AACZC,QAAM,EALK,CAKD;;AALC,CAAb;AASA;;;;AAGAhC,KAAKiC,OAAL,GAAe;AAETL,SAAO,iBAAW;AAChB,WAAO5B,KAAKE,IAAL,CAAUF,KAAK2B,KAAL,CAAWC,KAArB,CAAP;AACD,GAJQ;AAKTC,SAAO,iBAAW;AAChB,WAAO7B,KAAKE,IAAL,CAAUF,KAAK2B,KAAL,CAAWC,KAArB,EAA4B5B,KAAK2B,KAAL,CAAWE,KAAvC,CAAP;AACD,GAPQ;AAQTK,UAAQ,kBAAW;AACjB,WAAOlC,KAAKE,IAAL,CAAUF,KAAK2B,KAAL,CAAWC,KAArB,EAA4B5B,KAAK2B,KAAL,CAAWE,KAAvC,EAA8C7B,KAAK2B,KAAL,CAAWG,KAAzD,CAAP;AACD,GAVQ;AAWTC,UAAQ,kBAAU;AAChB;AACA,WAAOI,SAASC,cAAT,WAA2BpC,KAAKQ,IAAL,CAAUC,MAArC,SAA8CT,KAAK2B,KAAL,CAAWI,MAAzD,EAAP;AACD;AAdQ,CAAf;;AAkBA/B,KAAKqC,QAAL,GAAgB,UAAUC,IAAV,EAAgBC,IAAhB,EAAqB;AACnC,OAAKrC,IAAL,CAAUoC,IAAV,IAAkBC,IAAlB;AACA,OAAKZ,KAAL,CAAWC,KAAX,GAAmBU,IAAnB;AAEAC,OAAKC,UAAL,CAAgBhB,GAAhB,CAAoB,qBAAW;AAC7B,QAAIiB,SAASC,OAAOC,IAAP,CAAYC,SAAZ,EAAuB,CAAvB,CAAb;AAEA5C,SAAKgB,EAAL,CAAQyB,MAAR,EAAgB,UAASI,KAAT,EAAe;AACzB7C,WAAKoB,IAAL,CAAU,WAAV,EAAuB;AAACqB,sBAAD;AAASK,eAAOF,UAAUH,MAAV,CAAhB;AAAmCI;AAAnC,OAAvB;AAEL,KAHD;AAKH,GARC;AASA,OAAKzB,IAAL,CAAU,MAAV,EAAkBmB,KAAKQ,MAAvB;AAED,CAfD;;AAoBA/C,KAAKgD,KAAL,GAAa,UAAUC,GAAV,EAAc;AACzB,MAAIC,MAAM,IAAV;;AACA,MAAGD,GAAH,EAAO;AACLC,UAAMD,GAAN;AACD,GAFD,MAEK;AACHC,UAAMlD,KAAKiC,OAAL,CAAaC,MAAb,EAAN;AACD;;AAAA;;AAED,OAAI,IAAIjB,KAAR,IAAiBiC,GAAjB,EAAqB;AAEflD,SAAKoB,IAAL,CAAUH,KAAV,EAAiBiC,IAAIjC,KAAJ,CAAjB;AAEL;;AAAA;AACD,OAAKG,IAAL,CAAU,OAAV,EAAmB8B,GAAnB;AACD,CAdD;;AAiBAlD,KAAKmD,IAAL,GAAY,YAAW;AAErB,OAAKxB,KAAL,CAAWG,KAAX;AACA,OAAKkB,KAAL;AAED,CALD;;AAOAhD,KAAKoD,UAAL,GAAkB,YAA8B;AAAA,MAArBN,KAAqB,uEAAf,IAAe;AAAA,MAATO,QAAS;AAAA,MACxC7C,IADwC,GAClB,IADkB,CACxCA,IADwC;AAAA,MAClCL,KADkC,GAClB,IADkB,CAClCA,KADkC;AAAA,MAC3BiB,IAD2B,GAClB,IADkB,CAC3BA,IAD2B;;AAGhD,WAASkC,QAAT,CAAkBC,QAAlB,EAA4B;AACxB,QAAIC,IAAIrB,SAASsB,aAAT,CAAuB,MAAvB,CAAR;AACAD,MAAEE,GAAF,GAAQ,YAAR;AACAF,MAAEG,IAAF,GAASJ,QAAT;AACA,QAAIK,IAAIzB,SAAS0B,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,CAAR;AACAD,MAAEE,WAAF,CAAcN,CAAd;AACH;;AAAA;AAKC,MAAIO,oBAAavD,KAAKG,OAAlB,kBAAJ;AACA,MAAIqD,mBAAYxD,KAAKG,OAAjB,iBAAJ;AACA,MAAIsD,WAAW9B,SAAS+B,aAAT,CAAuB1D,KAAKE,OAA5B,CAAf;AACAyD,QAAMJ,OAAN,EACGK,IADH,CACQ;AAAA,WAAGC,EAAEC,IAAF,EAAH;AAAA,GADR,EAGGF,IAHH,CAGQ,mBAAS;AACbd,aAASU,MAAT;AACAC,aAASM,SAAT,GAAqBC,OAArB;AACD,GANH,EAOGJ,IAPH,CAOQ,YAAI;AACR,QAAIK,kBAAkBtC,SAASuC,gBAAT,CAA0BlE,KAAKO,WAA/B,CAAtB;AACM0D,oBAAgBE,OAAhB,CAAwB,UAAC5C,MAAD,EAAU;AAEjC,UAAI6C,SAAS;AACNC,iBAAS,MADH;AAENC,eAAO,MAFD;AAGNC,gBAAQ;AAHF,OAAb;AAKArC,aAAOsC,MAAP,CAAcjD,OAAOkD,KAArB,EAA4BL,MAA5B;AAEA;;AACP7C,aAAOmD,YAAP,CAAoB,YAApB,EAAkCnD,OAAOkD,KAAP,CAAaJ,OAA/C;AAGM7E,WAAKO,UAAL,CAAgBwB,OAAOoD,EAAvB,IAA6BpD,MAA7B;AAGC,KAhBD;AAkBFsB;AACL,GA5BH,EA6BE+B,KA7BF,CA6BQ;AAAA,WAAOC,QAAQC,KAAR,CAAcA,KAAd,CAAP;AAAA,GA7BR;AA+BD,CAhDD;;AAmDAtF,KAAKuF,IAAL,GAAY,UAAU/E,IAAV,EAAe;AAAA;;AACzBkC,SAAOsC,MAAP,CAAchF,KAAKQ,IAAnB,EAAyBA,IAAzB;AACA,OAAK4C,UAAL,CAAgB,IAAhB,EAAsB,YAAI;AACvB,UAAKJ,KAAL,CAAY;AAAEwC,YAAMhF,KAAKM;AAAb,KAAZ;;AACA,UAAKM,IAAL,CAAU,MAAV;AACF,GAHD;AAMA,SAAO,IAAP;AACD,CATD;;AAYApB,KAAKyF,YAAL,GAAoB,YAAsB;AAAA,MAAbN,EAAa,uEAAV,SAAU;AAAA,MAClC3E,IADkC,GACzB,IADyB,CAClCA,IADkC;AAE1C,MAAIkF,cAAcC,KAAKC,SAAL,CAAe,KAAKjE,KAApB,CAAlB;AACIkE,eAAaC,OAAb,CAAqBtF,KAAKC,MAAL,GAAY0E,EAAjC,EAAqCO,WAArC;AACA,OAAKtE,IAAL,CAAU,cAAV,EAA0B;AAAE+D;AAAF,GAA1B;AACH,CALD;;AAOAnF,KAAK+F,YAAL,GAAoB,YAAsB;AAAA,MAAbZ,EAAa,uEAAV,SAAU;AAAA,MAClC3E,IADkC,GACzB,IADyB,CAClCA,IADkC;AAAA,eAEF,KAAKmB,KAFH;AAAA,MAElCI,MAFkC,UAElCA,MAFkC;AAAA,MAE1BH,KAF0B,UAE1BA,KAF0B;AAAA,MAEnBC,KAFmB,UAEnBA,KAFmB;AAAA,MAEZC,KAFY,UAEZA,KAFY;AAGxC9B,OAAK2B,KAAL,GAAagE,KAAK3C,KAAL,CAAW6C,aAAaG,OAAb,CAAqBxF,KAAKC,MAAL,GAAY0E,EAAjC,CAAX,CAAb;AAEA,OAAK/D,IAAL,CAAU,cAAV,EAA0B;AAAE+D;AAAF,GAA1B;AACA,OAAKnC,KAAL,CAAW;AAAEjB;AAAF,GAAX;AACA,OAAKiB,KAAL,CAAW;AACPwC,UAAM,CAAE5D,KAAF,EAASC,KAAT,EAAgBC,KAAhB,EAAuBmE,IAAvB,CAA4B,GAA5B;AADC,GAAX;AAGD,CAVD;;AAYAjG,KAAKkG,cAAL,GAAsB,UAASf,EAAT,EAAY;AAAA,MAC1B3E,IAD0B,GACjB,IADiB,CAC1BA,IAD0B;AAEhC,SAAOqF,aAAarF,KAAKC,MAAL,GAAY0E,EAAzB,CAAP;AACA,OAAK/D,IAAL,CAAU,gBAAV,EAA4B;AAAE+D;AAAF,GAA5B;AACD,CAJD;;AAQAnF,KAAKmG,GAAL,GAAW;AACTb,SAAO,oBAAK;AACVD,YAAQc,GAAR,uBAA2BC,GAA3B,GAAkC,gDAAlC,EAAoF,6BAApF;AACD,GAHQ;;AAIT;;;;AAIAnF,SAAO,eAACoF,CAAD,EAAa;AAAA,QAATD,GAAS,uEAAL,EAAK;AAClBf,YAAQc,GAAR,cAAkBE,CAAlB,iBAA0BD,GAA1B,QAAkC,sDAAlC,EAA0F,sDAA1F;AACD,GAVQ;AAWT;AACAtE,SAAO,kBAAG;AACRuD,YAAQc,GAAR,2BAAsC,sDAAtC,EAA8F,sDAA9F;AACD,GAdQ;AAeTG,QAAM,oBAAM;AACVjB,YAAQc,GAAR,cAAkBnE,IAAlB,GAA0B,sDAA1B;AACD;AAjBQ,CAAX;AAsBAhC,KAAKmG,GAAL,CAASrE,KAAT;AC/OA9B,KAAKgB,EAAL,CAAQ,MAAR,EAAgB,UAASuF,QAAT,EAAkB;AAAA,MAI1BvD,KAJ0B,GAIc,IAJd,CAI1BA,KAJ0B;AAAA,MAIlB5B,IAJkB,GAIc,IAJd,CAIlBA,IAJkB;AAAA,MAIZjB,KAJY,GAIc,IAJd,CAIZA,KAJY;AAAA,MAILK,IAJK,GAIc,IAJd,CAILA,IAJK;AAAA,MAIC6B,QAJD,GAIc,IAJd,CAICA,QAJD;;AAMlC,WAASmE,QAAT,CAAkBC,SAAlB,EAA6BC,SAA7B,EAAuC;AAGrC,QAAIC,gBAASnG,KAAKG,OAAd,cAAyBH,KAAKI,SAA9B,cAA2CJ,KAAKK,KAAhD,cAAyD4F,SAAzD,UAAJ;AACArF,SAAK,SAAL,EAAgB;AAAEqF,0BAAF;AAAaC;AAAb,KAAhB;AACAvC,UAAMwC,GAAN,EACCvC,IADD,CACM;AAAA,aAAGC,EAAEuC,IAAF,EAAH;AAAA,KADN,EAECxC,IAFD,CAEM,qBAAW;AAGfpE,WAAKqC,QAAL,CAAcoE,SAAd,EAAyBI,SAAzB;AAED,KAPD;AAQF;;;;;;;;AASC;;AAGD,WAASC,OAAT,CAAiBC,QAAjB,EAA0B;AACxB,QAAIC,MAAMD,SAASE,KAAT,CAAe,GAAf,CAAV;AACA;;;;AAGA,QAAGD,IAAIE,MAAJ,KAAa,CAAhB,EAAkB;AAChB,UAAIC,MAAM,CAACH,IAAI,CAAJ,CAAP,CAAJ,EAAoB;AAClB3B,gBAAQ+B,IAAR,CAAa,mBAAb;AACA/B,gBAAQ+B,IAAR,CAAa,0BAAb;AACApH,aAAK2B,KAAL,CAAWG,KAAX,GAAmB,CAAnB;AACD;;AAED,aAAO,IAAP;AACD;AACD;;;AATA,SAYK,IAAGkF,IAAIE,MAAJ,KAAa,CAAhB,EAAkB;AACrB,YAAIG,UAAU,KAAd;AACC;;AACD,YAAIF,MAAM,CAACH,IAAI,CAAJ,CAAP,CAAJ,EAAoB;AAClBK,oBAAU,IAAV;AACD;AACD;AAHA,aAIK;AACHA,sBAAU,KAAV;AACD;;AAED,eAAOA,OAAP;AACD;AAEF;;AAAA;AAEC,MAAIL,MAAMT,SAASU,KAAT,CAAe,GAAf,CAAV;;AAEF,MAAGH,QAAQP,QAAR,CAAH,EAAqB;AAGjB;AACAvG,SAAK2B,KAAL,CAAWC,KAAX,GAAmBoF,IAAI,CAAJ,CAAnB;AACAhH,SAAK2B,KAAL,CAAWE,KAAX,GAAmBmF,IAAI,CAAJ,CAAnB;AACAhH,SAAK2B,KAAL,CAAWG,KAAX,GAAmBkF,IAAI,CAAJ,KAAQ,CAA3B;AACDR,aAASxG,KAAK2B,KAAL,CAAWC,KAApB,EAA2B5B,KAAK2B,KAAL,CAAWE,KAAtC;AAIF,GAXD,MAWK;AAEH;AACC;AACC7B,SAAK2B,KAAL,CAAWE,KAAX,GAAmBmF,IAAI,CAAJ,CAAnB;AACAhH,SAAK2B,KAAL,CAAWG,KAAX,GAAmBkF,IAAI,CAAJ,KAAQ,CAA3B;AAEDhE;AACF;AAIA,CAzFD;ACAA;;;;;;;;;;;;;AAaA,SAASsE,cAAT,CAAwBC,IAAxB,EAA8B;AAC7B,MAAIA,KAAKC,YAAT,EAAuB;AACtB,WAAOD,KAAKC,YAAL,CAAkB3C,OAAzB;AACA,GAFD,MAEO,IAAI4C,OAAOC,gBAAX,EAA6B;AACnC,QAAIC,gBAAgBF,OAAOC,gBAAP,CAAwBH,IAAxB,EAA8B,IAA9B,CAApB;AAEA,WAAOI,cAAcC,gBAAd,CAA+B,SAA/B,CAAP;AACA;AACD;;AAED,SAASC,IAAT,CAAcC,EAAd,EAAkB;AACjB,MAAI,CAACA,GAAGC,YAAH,CAAgB,YAAhB,CAAL,EAAoC;AACnCD,OAAG5C,YAAH,CAAgB,YAAhB,EAA8B4C,GAAG7C,KAAH,CAASJ,OAAvC;AACA;;AAEDiD,KAAG7C,KAAH,CAASJ,OAAT,GAAmB,MAAnB;AACA;;AAEDmD,eAAe,EAAf;;AAEA,SAASC,QAAT,CAAkBH,EAAlB,EAAsB;AACrB,MAAIhD,QAAQgD,GAAGI,WAAf;AAAA,MAA4BnD,SAAS+C,GAAGK,YAAxC;AAAA,MACCC,KAAKN,GAAGO,QAAH,CAAYC,WAAZ,OAA8B,IADpC;AAGA,SAAOxD,UAAU,CAAV,IAAeC,WAAW,CAA1B,IAA+B,CAACqD,EAAhC,GACN,IADM,GACCtD,QAAQ,CAAR,IAAaC,SAAS,CAAtB,IAA2B,CAACqD,EAA5B,GAAiC,KAAjC,GAAyCd,eAAeQ,EAAf,CADjD;AAEA;;AAID,SAASS,IAAT,CAAcT,EAAd,EAAkB;AAEjB,MAAIR,eAAeQ,EAAf,KAAsB,MAA1B,EAAkC;AAElC,MAAIU,MAAMV,GAAGC,YAAH,CAAgB,YAAhB,CAAV;AACAD,KAAG7C,KAAH,CAASJ,OAAT,GAAmB2D,OAAO,EAA1B;;AAEA,MAAKlB,eAAeQ,EAAf,MAAuB,MAA5B,EAAqC;AACpC,QAAIO,WAAWP,GAAGO,QAAlB;AAAA,QAA4B9F,OAAOJ,SAASI,IAA5C;AAAA,QAAkDsC,OAAlD;;AAEA,QAAKmD,aAAaK,QAAb,CAAL,EAA8B;AAC7BxD,gBAAUmD,aAAaK,QAAb,CAAV;AACA,KAFD,MAEO;AACN,UAAII,WAAWtG,SAASsB,aAAT,CAAuB4E,QAAvB,CAAf;AACA9F,WAAKuB,WAAL,CAAiB2E,QAAjB;AACA5D,gBAAUyC,eAAemB,QAAf,CAAV;;AAEA,UAAI5D,YAAY,MAAhB,EAAyB;AACxBA,kBAAU,OAAV;AACA;;AAEDtC,WAAKmG,WAAL,CAAiBD,QAAjB;AACAT,mBAAaK,QAAb,IAAyBxD,OAAzB;AACA;;AAEDiD,OAAG5C,YAAH,CAAgB,YAAhB,EAA8BL,OAA9B;AACAiD,OAAG7C,KAAH,CAASJ,OAAT,GAAmBA,OAAnB;AACA;AACD;;AAKD7E,KAAKgB,EAAL,CAAQ,QAAR,EAAkB,UAASmE,EAAT,EAAY;AAC7B,OAAK/D,IAAL,CAAU+D,EAAV,EAAcnF,KAAKO,UAAL,CAAgB4E,EAAhB,CAAd;;AAGA,MAAGnF,KAAKM,UAAL,IAAiB,EAApB,EAAuB;AACnB,QAAIqI,UAAU3I,KAAKO,UAAL,CAAgBP,KAAKM,UAArB,CAAd;AACIuH,SAAKc,OAAL;AAEP;;AAED3I,OAAKM,UAAL,GAAkB6E,EAAlB,CAV6B,CAW7B;AACA;AACA;AACA;;AACDnF,OAAK2B,KAAL,CAAWI,MAAX,GAAoBoD,EAApB;AACCoD,OAAKvI,KAAKO,UAAL,CAAgB4E,EAAhB,CAAL;AACA,CAjBD;;;AC1EAnF,KAAKgB,EAAL,CAAQ,OAAR,EAAiB,UAASgB,IAAT,EAAc;AAI7B,MAAG,OAAOA,IAAP,KAAgB,QAAnB,EAA4B;AAEvB,QAAGhC,KAAKK,SAAL,IAAgB,EAAnB,EAAsB;AACpBL,WAAKI,QAAL,CAAcJ,KAAKK,SAAnB,EAA8BuI,KAA9B;AACD;;AACD5I,SAAKI,QAAL,CAAc4B,IAAd,EAAoB6G,IAApB;AACA7I,SAAKK,SAAL,GAAiB2B,IAAjB;AAEJ,GARD,MAQM,IAAG,QAAOA,IAAP,MAAgB,QAAnB,EAA4B;AAE9B,QAAGhC,KAAKK,SAAL,IAAgB,EAAnB,EAAsB;AAClBL,WAAKI,QAAL,CAAcJ,KAAKK,SAAnB,EAA8BuI,KAA9B;AACF;;AAEF5I,SAAKI,QAAL,CAAc4B,KAAKmD,EAAnB,EAAuBnD,KAAK8G,MAA5B;AAEC9I,SAAKK,SAAL,GAAiB2B,KAAKmD,EAAtB,CAR6B,CAS/B;AACF,GAVK,MAUD;AACHE,YAAQC,KAAR,CAAc,oBAAd;AACD,GAxB4B,CAyB/B;;AAEC,CA3BD;ACFA;;;;;AAMAtF,KAAKgB,EAAL,CAAQ,MAAR,EAAgB,UAAS+B,MAAT,EAAgB;AAAA,MACtB5C,KADsB,GACN,IADM,CACtBA,KADsB;AAAA,MACfiB,IADe,GACN,IADM,CACfA,IADe;AAIhC,MAAI2H,UAAU,MAAIhG,OAAOmE,MAAzB;AACA,MAAI8B,YAAY,CAAhB;AACA,MAAIC,IAAI,CAAR;;AANgC,6BAOxBC,KAPwB;AAS5BC,eAAW,CAAEF,KAAG,CAAL,EAAQ,GAAR,EAAalG,OAAOmE,MAApB,EAA6BjB,IAA7B,CAAkC,EAAlC,CATiB;AAWhC,QAAImD,WAAWC,KAAKC,KAAL,CAAWN,aAAWD,OAAtB,IAA+B,GAA9C;;AAGE,QAAGG,MAAMK,IAAN,KAAa,OAAhB,EAAwB;AACnB,UAAIC,MAAM,IAAIC,KAAJ,EAAV;AACID,UAAIE,GAAJ,GAAUR,MAAMS,IAAhB;;AACAH,UAAII,MAAJ,GAAa,YAAU;AACjBxI,aAAK,WAAL,EAAkB8H,KAAlB;AACL,OAFD;AAGR,KAND,MAOK,IAAGA,MAAMK,IAAN,KAAa,OAAhB,EAAwB;AACxB,UAAIM,QAAQ,IAAIC,KAAJ,EAAZ;AACID,YAAME,gBAAN,CAAuB,gBAAvB,EAAyC,YAAI;AACtC3I,aAAK,WAAL,EAAkB8H,KAAlB;AACN,OAFD,EAEG,KAFH;AAGDW,YAAMH,GAAN,GAAYR,MAAMS,IAAlB;AACF3J,WAAKI,QAAL,CAAc8I,MAAM/D,EAApB,IAA0B0E,KAA1B;AACL,KAPI,MAQD;AACFxE,cAAQC,KAAR,CAAc,qBAAd;AACA;AACD;;AACH,QAAItD,OAAOU,OAAOsC,MAAP,CAAckE,KAAd,EAAqB;AAACE,wBAAD;AAAWD;AAAX,KAArB,CAAX;AACkB/H,SAAK,OAAL,EAAcY,IAAd;AAlCc;;AAAA;AAAA;AAAA;;AAAA;AAOhC,yBAAiBe,MAAjB,8HAAwB;AAAA,UAAhBmG,KAAgB;AAAA,UAEpBC,QAFoB;;AAAA,uBAAhBD,KAAgB;;AAAA,4BAwBpB;AAIH;AAnC+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmC/B;AAEC9H,OAAK,UAAL;AACD,CAtCD","file":"vnjson.js","sourcesContent":["\r\nvar vnjs = {\r\n  \r\n      plugins: {},\r\n      TREE: {},\r\n      DEBUG: false,\r\n      playList: {},\r\n      prevAudio: \"\",\r\n      prevScreen: \"\",\r\n      screenList: {}\r\n};\r\n\r\nvnjs.conf = {\r\n      prefix: '',\r\n      element: '.gameElement',\r\n      gameDir: './game',\r\n      scenesDir: \"scenes\",\r\n      local: 'en-US',\r\n      entryPoint: 'entry/point',\r\n      screenClass: '.screen'\r\n};\r\n\r\nvnjs.on = function(event, handler){\r\n          if (!vnjs.plugins[event]) {\r\n              vnjs.plugins[event] = [];\r\n          };\r\n          vnjs.plugins[event].push(handler);\r\n};\r\n\r\nvnjs.emit = function (event, ...args) {\r\n         if (Array.isArray(vnjs.plugins[event])) {\r\n            vnjs.plugins[event].map(function(handler){\r\n                    handler.call(vnjs, ...args);\r\n            });\r\n         }\r\n         /*\r\n         else{\r\n          Выводятся системные слушатели\r\n          console.log(`Event [ ${event} ] not found`)\r\n         }\r\n         */\r\n};\r\nvnjs.off = function (event) {\r\n        delete vnjs.plugins[event];\r\n};\r\n\r\n/*\r\n * В {state} должно помещаться все то\r\n * что сохроняется в карту памяти\r\n * И что важно загрузить из нее без последствий.\r\n * В состоянии не должно быть мусора\r\n */\r\n\r\nvnjs.state = {\r\n  scene: 'scene',\r\n  label: 'label',\r\n  index: 0,\r\n  screen: \"\", //current screen\r\n  data: {}, //userData\r\n};\r\n\r\n\r\n/*\r\n * Получает текущее тела из состояние\r\n */\r\nvnjs.current = {\r\n  \r\n      scene: function (){\r\n        return vnjs.TREE[vnjs.state.scene];\r\n      },\r\n      label: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label];\r\n      },\r\n      object: function (){\r\n        return vnjs.TREE[vnjs.state.scene][vnjs.state.label][vnjs.state.index];\r\n      },\r\n      screen: function(){\r\n        //> DOM<\r\n        return document.getElementById(`${vnjs.conf.prefix}${vnjs.state.screen}`)\r\n      }\r\n};\r\n\r\n\r\nvnjs.setScene = function (name, body){\r\n  this.TREE[name] = body;\r\n  this.state.scene = name;\r\n\r\n  body.characters.map(character=>{\r\n    let aliase = Object.keys(character)[0];\r\n\r\n    vnjs.on(aliase, function(reply){\r\n          vnjs.emit('character', {aliase, param: character[aliase], reply } );\r\n\r\n    });\r\n\r\n});\r\n  this.emit('load', body.assets);\r\n \r\n};\r\n\r\n\r\n\r\n\r\nvnjs.parse = function (obj){\r\n  var ctx = null;\r\n  if(obj){\r\n    ctx = obj;\r\n  }else{\r\n    ctx = vnjs.current.object();\r\n  };\r\n\r\n  for(let event in ctx){\r\n\r\n        vnjs.emit(event, ctx[event]);\r\n\r\n  };\r\n  this.emit('parse', ctx)\r\n};\r\n\r\n\r\nvnjs.next = function (){\r\n \r\n  this.state.index++;\r\n  this.parse();\r\n\r\n};\r\n\r\nvnjs.getScreens = function(param=null, callback){\r\nconst { conf, DEBUG, emit } = this;\r\n\r\nfunction fetchCss(filename) {\r\n    var l = document.createElement('link');\r\n    l.rel = 'stylesheet';\r\n    l.href = filename\r\n    var h = document.getElementsByTagName('head')[0];\r\n    h.appendChild(l);\r\n};\r\n\r\n\r\n\r\n  \r\n  let uriHtml = `${conf.gameDir}/screens.html`;\r\n  let uriCss = `${conf.gameDir}/screens.css`;\r\n  let gameRoot = document.querySelector(conf.element);\r\n  fetch(uriHtml)\r\n    .then(r=>r.text())\r\n    \r\n    .then(screens=>{\r\n      fetchCss(uriCss);\r\n      gameRoot.innerHTML = screens;\r\n    })\r\n    .then(()=>{\r\n      let screensNodeList = document.querySelectorAll(conf.screenClass);\r\n            screensNodeList.forEach((screen)=>{\r\n\r\n             let styles = {\r\n                    display: 'none',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                  };\r\n             Object.assign(screen.style, styles);\r\n\r\n             /*Код кантораЮ необходимо для работы 'Правильлного show/hide'*/\r\n      screen.setAttribute(\"displayOld\", screen.style.display)\r\n             \r\n\r\n            vnjs.screenList[screen.id] = screen;\r\n\r\n            \r\n            });\r\n\r\n          callback()\r\n    })\r\n   .catch(error=>console.error(error))\r\n\r\n};\r\n\r\n\r\nvnjs.init = function (conf){\r\n  Object.assign(vnjs.conf, conf);\r\n  this.getScreens(null, ()=>{\r\n     this.parse( { jump: conf.entryPoint } )\r\n     this.emit('init')\r\n  })\r\n\r\n \r\n  return true;\r\n};\r\n\r\n\r\nvnjs.progressSave = function(id='default'){\r\n  let { conf } = this;\r\nlet serialState = JSON.stringify(this.state); \r\n    localStorage.setItem(conf.prefix+id, serialState); \r\n    this.emit('progressSave', { id })\r\n};\r\n\r\nvnjs.progressLoad = function(id='default'){\r\n  let { conf } = this;\r\n  let { screen, scene, label, index } = this.state;\r\n  vnjs.state = JSON.parse(localStorage.getItem(conf.prefix+id));\r\n\r\n  this.emit('progressLoad', { id });\r\n  this.parse({ screen })\r\n  this.parse({\r\n      jump: [ scene, label, index].join('/')\r\n    })\r\n}\r\n\r\nvnjs.progressDelete = function(id){\r\n  let { conf } = this;\r\n  delete localStorage[conf.prefix+id];\r\n  this.emit('progressDelete', { id });\r\n};\r\n\r\n\r\n\r\nvnjs.log = {\r\n  error: msg=>{\r\n    console.log(`%c Error %c ${msg}`, \"color: white; background: red; font-size:12px;\", \"color: red; font-size:12px;\");\r\n  },\r\n  /*\r\n  scene: (scene, label)=>{\r\n    console.log(`%c ${scene} %c ${label}`, \"color: #C9DAE4; background: #A0BACB; font-size:12px;\", \"background: #C9DAE4; color: #A0BACB; font-size:12px;\");\r\n  },*/\r\n  event: (e, msg=\"\")=>{\r\n    console.log(`%c ${e} %c ${msg} `, \"color: #C9DAE4; background: #A0BACB; font-size:12px;\", \"background: #C9DAE4; color: #A0BACB; font-size:12px;\");\r\n  },\r\n  //#A0BACB\r\n  index: _=>{\r\n    console.log(`%c vnjson.js %c v0.9.3`, \"color: #C9DAE4; background: #A0BACB; font-size:12px;\", \"background: #C9DAE4; color: #A0BACB; font-size:12px;\");\r\n  },\r\n  info: data=>{\r\n    console.log(`%c ${data}`, \"color: #A0BACB; background: #ffffff; font-size:12px;\")\r\n  }\r\n}\r\n\r\n\r\n\r\nvnjs.log.index();\r\n","vnjs.on('jump', function(pathname){\r\n\r\n\r\n\r\nconst { parse,  emit, DEBUG, conf, setScene } = this;\r\n\r\nfunction getScene(sceneName, labelName){\r\n\r\n\r\n  let uri = `${conf.gameDir}/${conf.scenesDir}/${conf.local}/${sceneName}.json`;\r\n  emit('preload', { sceneName, labelName });\r\n  fetch(uri)\r\n  .then(r=>r.json())\r\n  .then(sceneBody=>{\r\n\r\n\r\n    vnjs.setScene(sceneName, sceneBody);\r\n\r\n  });\r\n/*\r\n\r\nsetScene(\"*\", sceneBody);\r\n\r\nstate.label = \"mainMenu\";\r\n\r\nnext();\r\n*/\r\n\r\n}\r\n\r\n\r\nfunction isScene(pathName){\r\n  var arr = pathName.split('/');\r\n  /*\r\n      scene/label/index\r\n  */\r\n  if(arr.length===3){\r\n    if( isNaN(+arr[2]) ){\r\n      console.warn('scene/label/index')\r\n      console.warn('Index should be a Number');\r\n      vnjs.state.index = 0;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n  /*\r\n      scene/label\r\n  */\r\n  else if(arr.length===2){\r\n    var isLabel = false;\r\n     /*  scene/label  */\r\n    if( isNaN(+arr[1]) ){\r\n      isLabel = true;\r\n    }\r\n    /*  label/index  */\r\n    else {\r\n      isLabel = false;\r\n    }\r\n   \r\n    return isLabel;\r\n  }\r\n \r\n};\r\n\r\n  var arr = pathname.split('/');\r\n\r\nif(isScene(pathname)){\r\n\r\n\r\n    // set state\r\n    vnjs.state.scene = arr[0];\r\n    vnjs.state.label = arr[1];\r\n    vnjs.state.index = arr[2]||0;\r\n   getScene(vnjs.state.scene, vnjs.state.label);\r\n\r\n\r\n\r\n}else{\r\n \r\n\t // set state\r\n   // vnjs.state.scene = vnjs.state.scene;\r\n    vnjs.state.label = arr[0];\r\n    vnjs.state.index = arr[1]||0;\r\n\r\n   parse();\r\n}\r\n\r\n\r\n\r\n});\r\n\r\n\r\n","/**\r\n\r\n\r\n\r\nПлагины\r\nget-screens\r\n &\r\nscreen-show\r\nобъеденить в один ->screen\r\n\r\n* Так же можно было бы объеденить jump и getScenes\r\n*\r\n*/\r\nfunction getRealDisplay(elem) {\r\n\tif (elem.currentStyle) {\r\n\t\treturn elem.currentStyle.display\r\n\t} else if (window.getComputedStyle) {\r\n\t\tvar computedStyle = window.getComputedStyle(elem, null )\r\n\r\n\t\treturn computedStyle.getPropertyValue('display')\r\n\t}\r\n}\r\n\r\nfunction hide(el) {\r\n\tif (!el.getAttribute('displayOld')) {\r\n\t\tel.setAttribute(\"displayOld\", el.style.display)\r\n\t}\r\n\r\n\tel.style.display = \"none\"\r\n}\r\n\r\ndisplayCache = {}\r\n\r\nfunction isHidden(el) {\r\n\tvar width = el.offsetWidth, height = el.offsetHeight,\r\n\t\ttr = el.nodeName.toLowerCase() === \"tr\"\r\n\r\n\treturn width === 0 && height === 0 && !tr ?\r\n\t\ttrue : width > 0 && height > 0 && !tr ? false :\tgetRealDisplay(el)\r\n}\r\n\r\n\r\n\r\nfunction show(el) {\r\n\r\n\tif (getRealDisplay(el) != 'none') return\r\n\r\n\tvar old = el.getAttribute(\"displayOld\");\r\n\tel.style.display = old || \"\";\r\n\r\n\tif ( getRealDisplay(el) === \"none\" ) {\r\n\t\tvar nodeName = el.nodeName, body = document.body, display\r\n\r\n\t\tif ( displayCache[nodeName] ) {\r\n\t\t\tdisplay = displayCache[nodeName]\r\n\t\t} else {\r\n\t\t\tvar testElem = document.createElement(nodeName)\r\n\t\t\tbody.appendChild(testElem)\r\n\t\t\tdisplay = getRealDisplay(testElem)\r\n\r\n\t\t\tif (display === \"none\" ) {\r\n\t\t\t\tdisplay = \"block\"\r\n\t\t\t}\r\n\r\n\t\t\tbody.removeChild(testElem)\r\n\t\t\tdisplayCache[nodeName] = display\r\n\t\t}\r\n\r\n\t\tel.setAttribute('displayOld', display)\r\n\t\tel.style.display = display\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\nvnjs.on('screen', function(id){\r\n\tthis.emit(id, vnjs.screenList[id]);\r\n\r\n\r\n if(vnjs.prevScreen!=\"\"){\r\n \t\t\t\tlet pscreen = vnjs.screenList[vnjs.prevScreen];\r\n         hide(pscreen);\r\n        \r\n }\r\n\r\n vnjs.prevScreen = id;\r\n\t//prefix\r\n\t//show.id\r\n\t//hide.pref.screen\r\n\t//push.state.screens\r\nvnjs.state.screen = id;\r\n\tshow(vnjs.screenList[id])\r\n})","\r\n\r\nvnjs.on('audio', function(data){\r\n\r\n\r\n\r\n  if(typeof data === 'string'){\r\n      \r\n       if(vnjs.prevAudio!=\"\"){\r\n         vnjs.playList[vnjs.prevAudio].pause();\r\n       }\r\n       vnjs.playList[data].play(); \r\n       vnjs.prevAudio = data;\r\n\r\n  }else if(typeof data === 'object'){\r\n\r\n      if(vnjs.prevAudio!=\"\"){\r\n          vnjs.playList[vnjs.prevAudio].pause();\r\n       }\r\n\r\n      vnjs.playList[data.id][data.action]();\r\n    \r\n       vnjs.prevAudio = data.id;\r\n     // vnjs.audio[data.id].loop = data.loop;\r\n  }else{\r\n    console.error('incorect data type');\r\n  }\r\n//var sound = self.playlist[self.index].howl;\r\n\r\n});","/* @events\r\n    * preload\r\n    * load\r\n    * postload\r\n */\r\n\r\nvnjs.on('load', function(assets){\r\n  const { DEBUG, emit } = this;\r\n\r\n\r\nvar persent = 100/assets.length;\r\nvar PROGREESS = 0;\r\nvar i = 0;\r\nfor(let asset of assets){\r\n \r\nvar position = [ i+=1, '/', assets.length ].join(\"\");\r\n\r\nlet progress = Math.round(PROGREESS+=persent)+\"%\";\r\n\r\n\r\n  if(asset.type===\"image\"){\r\n       let img = new Image();\r\n           img.src = asset.path;\r\n           img.onload = function(){\r\n                 emit('imageLoad', asset);\r\n           };\r\n  }\r\n  else if(asset.type===\"audio\"){\r\n       let audio = new Audio();\r\n           audio.addEventListener('canplaythrough', ()=>{\r\n                  emit('audioLoad', asset);\r\n           }, false);\r\n          audio.src = asset.path;\r\n        vnjs.playList[asset.id] = audio; \r\n  }\r\n  else{\r\n    console.error('Incorect asset type');\r\n    break;\r\n  }\r\nlet data = Object.assign(asset, {progress, position});\r\n                  emit('asset', data);\r\n};\r\n\r\n  emit('postload');\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}