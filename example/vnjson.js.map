{"version":3,"sources":["webpack:///webpack/bootstrap e6e9fb55a207a7f3619e?04d2*","webpack:///./src/vnjson.js?caa5*","webpack:///./src/minivents.js?f536*"],"names":["ctx","sceneName","label","scene","arr","obj","num","plugin","Object","config","startLabel","local","init","_config","splitPathName","setLabel","parse","jump","game","scenes","characters","util","ev","emit","off","pathname","pathArr","split","on","event","handler","vnjs","setScene","sceneObject","setCharacters","labels","err","Error","sceneCharacters","assign","labelName","labelArray","_obj","key","length","character","reply","aliase","next","prev","Events","target","events","empty","type","func","push","list","i","splice","e","slice","j","apply","call","arguments"],"mappings":"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","file":"example/vnjson.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap e6e9fb55a207a7f3619e\n **/","\r\nimport Events from './minivents'; \r\n/*\r\n * context\r\n * Значение объекта равно состоянию приложения.\r\n */\r\nvar ctx = {\r\n  sceneName:'scene',\r\n  label:'label',\r\n  scene: {},\r\n  arr: [],\r\n  obj: null,\r\n  num: 0,\r\n};\r\n\r\nconst plugin = new Object();\r\n\r\n//конфигурацию тоже сохранять в memory-card\r\nvar config = {\r\n  startLabel: 'start/start',\r\n  local: 'ru-RU',\r\n\r\n};\r\n\r\nfunction init(_config){\r\n config = _config||config;\r\n let label = splitPathName(config.startLabel).label;\r\n setLabel(label, []);\r\n parse({jump: config.startLabel});\r\n return this;\r\n};\r\n/*\r\nconfig.get('param')\r\nconfig.set('param')\r\n\r\n*/\r\nvar game = {\r\n    init: {},\r\n    scenes: {},\r\n    characters: {},\r\n    //choices: {},\r\n};\r\n\r\nconst util = {\r\n  splitPathName\r\n}\r\n\r\n\r\n/*\r\n * \r\n */\r\n\r\n\r\n\r\nvar ev = new Events();//EventEmitter\r\nvar { emit, off } = ev;\r\n\r\n/*\r\n *\r\n */\r\nfunction splitPathName(pathname){\r\n  let pathArr = pathname.split('/');\r\n  let scene = pathArr[0];\r\n  let label = pathArr[1];\r\n  return {label, scene};\r\n}\r\n/**\r\n * @plugins\r\n * Регистратор пользовательских событий\r\n */\r\n/*\r\n * Объект plugin нужен для тестирования\r\n * что бы можно было вызывать плагин из\r\n * текущего окружения, а не плодить глобальные\r\n * методы.\r\n */ \r\n\r\nfunction on(event, handler){\r\n  /*\r\n   * Если функция vnjs.on(function(){})\r\n   * содержит callback без объявления\r\n   * имени события, то функция запускается\r\n   * в резиме autorun;\r\n   */\r\n  if(typeof event===\"function\"){\r\n      ev.on('autorun', event, vnjs);\r\n  }else if(typeof event===\"string\"){\r\n      plugin[event] = handler;\r\n      ev.on(event, handler, vnjs);\r\n      \r\n  }\r\n\r\n};\r\n\r\n\r\n\r\n\r\n/*\r\n * setScene\r\n */\r\n\r\n/*\r\n * @Функция принимает объект сцены\r\n *  {\r\n *    characters: {},\r\n *    assets: [{}]\r\n *    labels: {\r\n *         start: [{},{},{},{},{},{},{}],\r\n *    }\r\n *  }\r\n */\r\nfunction setScene(sceneName, sceneObject) {\r\n  try{\r\n  \r\n    /*\r\n     * Назначаем полученные данные сцены в\r\n     * игровые объекты.\r\n     * А так же объекты внутреннего назначения\r\n     */\r\n    game.scenes[sceneName] = sceneObject;\r\n    ctx.scene = sceneObject;\r\n    /*\r\n     * Добавляю персонажей в каждой загруженной сцены\r\n     * в общий пулл.\r\n     */\r\n    setCharacters(sceneObject.characters);\r\n    /*\r\n     * Переопределяю методы текущего label'a\r\n     */\r\n    setLabel(ctx.label, sceneObject.labels[ctx.label])\r\n    emit('setscene');\r\n    parse();\r\n    \r\n    return this;\r\n  }\r\n  catch (err){\r\n    throw new Error('Ошибка объявления сцены ', err);\r\n    return false;\r\n  }\r\n};\r\n\r\nfunction setCharacters(sceneCharacters){\r\n  game.characters = Object.assign(game.characters, sceneCharacters);\r\n  return this;\r\n};\r\nfunction setLabel(labelName, labelArray){\r\n            ctx.label = labelName;\r\n            ctx.arr = labelArray;\r\n            return true;\r\n};\r\n\r\nfunction parse(_obj){\r\n\r\n  if(_obj){\r\n      ctx.obj = _obj;\r\n  }else{\r\n     ctx.obj = ctx.arr[ctx.num];\r\n  }\r\n  /** Текущий объект */\r\n    //ctx.obj = ctx.arr[ctx.num];\r\n\r\n\r\n  for(let key in ctx.obj){\r\n      /*\r\n       * Алиас персонажа содержит не больше трех (2)\r\n       * символов. \r\n       */\r\n      if(key.length<=2){\r\n             let character = game.characters[key];\r\n            \r\n              let reply = ctx.obj[key]; \r\n              emit('alias', {\r\n                   character,\r\n                   reply,\r\n                   aliase: key\r\n                 });\r\n             \r\n\r\n      }else{\r\n        /*\r\n         * vnjs.on('alert')\r\n         * Подписывает пользовательские плагины\r\n         * \r\n         */\r\n        ev.emit(key, ctx.obj[key]);\r\n      }\r\n  }\r\n  emit('parse', ctx.obj);\r\n\r\n   return ctx.num;\r\n};\r\n\r\n\r\n\r\nfunction next(num){\r\n  \r\n  \r\n  ctx.num+=num||1;\r\n  parse();\r\n  emit('next');\r\n  return ctx.num;\r\n};\r\nfunction prev(num){\r\n \r\n  \r\n  ctx.num-=num||1;\r\n  parse();\r\n  emit('prev');\r\n  return ctx.num;\r\n};\r\n\r\n\r\n/*\r\n * @api\r\n */\r\nexport {\r\n  on,\r\n  ctx,\r\n  game,\r\n  setScene,\r\n  setLabel,\r\n  setCharacters,\r\n  config,\r\n  plugin,\r\n  util,\r\n  next,\r\n  prev,\r\n  parse,\r\n  emit,\r\n  off,\r\n  init\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/vnjson.js\n **/","function Events(target){\r\n  var events = {}, empty = [];\r\n  target = target || this;\r\n  /**\r\n   *  On: listen to events\r\n   */\r\n  target.on = function(type, func, ctx){\r\n    (events[type] = events[type] || []).push([func, ctx]);\r\n  };\r\n  /**\r\n   *  Off: stop listening to event / specific callback\r\n   */\r\n  target.off = function(type, func){\r\n    type || (events = {});\r\n    var list = events[type] || empty,\r\n        i = list.length = func ? list.length : 0;\r\n    while(i--) func == list[i][0] && list.splice(i,1);\r\n  };\r\n  /** \r\n   * Emit: send event, callbacks will be triggered\r\n   */\r\n  target.emit = function(type){\r\n    var e = events[type] || empty, list = e.length > 0 ? e.slice(0, e.length) : e, i=0, j;\r\n    while(j=list[i++]) j[0].apply(j[1], empty.slice.call(arguments, 1));\r\n  };\r\n};\r\n\r\nexport default Events;\n\n\n/** WEBPACK FOOTER **\n ** ./src/minivents.js\n **/"],"sourceRoot":""}